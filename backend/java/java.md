
# Java-review
Java-review-for-audition

<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚

- [Java-review](#java-review)
- [ç¬¬ä¸€ç«  Java](#ç¬¬ä¸€ç« -java)
  - [Java åŸºç¡€](#java-åŸºç¡€)
    - [åŸºç¡€ç±»å‹](#åŸºç¡€ç±»å‹)
    - [è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦](#è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦)
    - [é™æ€ä¸Šä¸‹æ–‡ä¸éé™æ€å†…éƒ¨ç±»](#é™æ€ä¸Šä¸‹æ–‡ä¸éé™æ€å†…éƒ¨ç±»)
      - [ä¸ºä»€ä¹ˆå¦‚æœæ‚¨éœ€è¦åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºéé™æ€å†…éƒ¨ç±»çš„å®ä¾‹ï¼Œæ‚¨éœ€è¦å°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€çš„](#ä¸ºä»€ä¹ˆå¦‚æœæ‚¨éœ€è¦åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºéé™æ€å†…éƒ¨ç±»çš„å®ä¾‹æ‚¨éœ€è¦å°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€çš„)
      - [é™æ€ä¸Šä¸‹æ–‡](#é™æ€ä¸Šä¸‹æ–‡)
    - [Javaä½¿ç”¨thiså…³é”®å­—è°ƒç”¨æœ¬ç±»é‡è½½æ„é€ å™¨](#javaä½¿ç”¨thiså…³é”®å­—è°ƒç”¨æœ¬ç±»é‡è½½æ„é€ å™¨)
    - [æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æœ‰å“ªäº›](#æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æœ‰å“ªäº›)
    - [FastJson](#fastjson)
    - [Java é˜Ÿåˆ—](#java-é˜Ÿåˆ—)
    - [swagger](#swagger)
    - [Javaä½¿ç”¨HMAC-SHA256ç®—æ³•å®ç°æ¥å£è®¤è¯](#javaä½¿ç”¨hmac-sha256ç®—æ³•å®ç°æ¥å£è®¤è¯)
    - [Java å‘½åè§„èŒƒ](#java-å‘½åè§„èŒƒ)
    - [åˆ†å¸ƒå¼é” redission](#åˆ†å¸ƒå¼é”-redission)
    - [Java å®ç°å›è°ƒ](#java-å®ç°å›è°ƒ)
  - [1.3 Map](#13-map)
    - [1.3.1 Mapçš„å®ç°ç±»](#131-mapçš„å®ç°ç±»)
  - [1.4 Iterator](#14-iterator)
    - [1.4.1 Set](#141-set)
    - [1.4.2 List](#142-list)
      - [1.4.2.1 å®ç°ç±»](#1421-å®ç°ç±»)
      - [list set array äº’è½¬](#list-set-array-äº’è½¬)
        - [Listè½¬æ•°ç»„](#listè½¬æ•°ç»„)
        - [æ•°ç»„è½¬List](#æ•°ç»„è½¬list)
        - [Setè½¬æ•°ç»„](#setè½¬æ•°ç»„)
        - [Setè½¬List](#setè½¬list)
        - [Listè½¬Set](#listè½¬set)
      - [1.4.2.2 ç§»é™¤å…ƒç´ ](#1422-ç§»é™¤å…ƒç´ )
      - [1.4.2.3 å»é‡](#1423-å»é‡)
  - [1.5 çº¿ç¨‹æ± ](#15-çº¿ç¨‹æ± )
    - [åŸç†](#åŸç†)
      - [ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± ](#ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± )
      - [ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©](#ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©)
      - [çº¿ç¨‹æ± ç»„æˆ](#çº¿ç¨‹æ± ç»„æˆ)
      - [Java çº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹](#java-çº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹)
      - [æ‹’ç»ç­–ç•¥](#æ‹’ç»ç­–ç•¥)
    - [SpringBoot å®ç°](#springboot-å®ç°)
      - [çº¿ç¨‹æ± æ„é€ æ–¹æ³•](#çº¿ç¨‹æ± æ„é€ æ–¹æ³•)
      - [å¼‚æ­¥çº¿ç¨‹æ± è°ƒç”¨ @Async](#å¼‚æ­¥çº¿ç¨‹æ± è°ƒç”¨-async)
      - [çº¿ç¨‹æ± ä¸šåŠ¡éš”ç¦», çŠ¶æ€ç›‘æ§ä¸çŠ¶æ€è°ƒä¼˜](#çº¿ç¨‹æ± ä¸šåŠ¡éš”ç¦»-çŠ¶æ€ç›‘æ§ä¸çŠ¶æ€è°ƒä¼˜)
        - [ä¸šåŠ¡éš”ç¦»](#ä¸šåŠ¡éš”ç¦»)
        - [çŠ¶æ€ç›‘æ§](#çŠ¶æ€ç›‘æ§)
      - [ç»“æŸåå‘å¸ƒäº‹ä»¶, æ¯”å¦‚é€šçŸ¥](#ç»“æŸåå‘å¸ƒäº‹ä»¶-æ¯”å¦‚é€šçŸ¥)
      - [1. åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ ThreadPoolExecutor, é‡å†™ afterExecute()](#1-åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„-threadpoolexecutor-é‡å†™-afterexecute)
        - [2.ä½¿ç”¨ `CompletableFuture`ï¼ˆæ¨èï¼‰](#2ä½¿ç”¨-completablefutureæ¨è)
        - [3. ç»Ÿä¸€ç›‘å¬ï¼šè‡ªå®šä¹‰ AsyncUncaughtExceptionHandler](#3-ç»Ÿä¸€ç›‘å¬è‡ªå®šä¹‰-asyncuncaughtexceptionhandler)
        - [4. äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼ˆæ¨èï¼‰](#4-äº‹ä»¶é©±åŠ¨çš„æ–¹å¼æ¨è)
        - [5. æ€»ç»“å¯¹æ¯”](#5-æ€»ç»“å¯¹æ¯”)
    - [JDK å®ç°](#jdk-å®ç°)
        - [è°ƒç”¨é»˜è®¤æ„é€ å™¨(cache, fixed, single, schedule)](#è°ƒç”¨é»˜è®¤æ„é€ å™¨cache-fixed-single-schedule)
      - [çº¿ç¨‹æ± é˜»å¡é˜Ÿåˆ—](#çº¿ç¨‹æ± é˜»å¡é˜Ÿåˆ—)
    - [Tomcat, WSGI, ASGI, çº¿ç¨‹æ± çš„å…³ç³»](#tomcat-wsgi-asgi-çº¿ç¨‹æ± çš„å…³ç³»)
      - [Tomcat çš„åŸºæœ¬å¹¶å‘æ¨¡å‹](#tomcat-çš„åŸºæœ¬å¹¶å‘æ¨¡å‹)
      - [WSGI + uvicore](#wsgi--uvicore)
      - [2) ASGIï¼ˆFastAPIï¼‰åç¨‹å¹¶å‘ï¼šç­‰å¾…ä¸å çº¿ç¨‹](#2-asgifastapiåç¨‹å¹¶å‘ç­‰å¾…ä¸å çº¿ç¨‹)
      - [æ€»ç»“](#æ€»ç»“)
  - [1.6 å¯¹è±¡, åå°„, æ³›å‹](#16-å¯¹è±¡-åå°„-æ³›å‹)
  - [1.7 stream æµå¼æ“ä½œ](#17-stream-æµå¼æ“ä½œ)
    - [flatmap](#flatmap)
  - [1.8 å‡½æ•°å¼ç¼–ç¨‹](#18-å‡½æ•°å¼ç¼–ç¨‹)
  - [1.9 Predicate æ–­è¨€](#19-predicate-æ–­è¨€)
  - [Java å®šæ—¶å™¨](#java-å®šæ—¶å™¨)
  - [Java Localdate -\> String](#java-localdate---string)
    - [String ç±»å‹è½¬localDate](#string-ç±»å‹è½¬localdate)
    - [dateç±»å‹è½¬localDate](#dateç±»å‹è½¬localdate)
  - [Javaç»éªŒ](#javaç»éªŒ)
- [ç¬¬äºŒç«  Mysql](#ç¬¬äºŒç« -mysql)
  - [2.1 åŸºç¡€ç±»å‹](#21-åŸºç¡€ç±»å‹)
  - [2.2 çº¦æŸ](#22-çº¦æŸ)
  - [2.3 mysqlä¼˜åŒ–](#23-mysqlä¼˜åŒ–)
    - [mysql æœ‰å“ªäº›ç´¢å¼•   ä»¥åŠå¦‚ä½•ä¼˜åŒ–å‘½ä¸­](#mysql-æœ‰å“ªäº›ç´¢å¼•---ä»¥åŠå¦‚ä½•ä¼˜åŒ–å‘½ä¸­)
      - [1. MySQL å¸¸è§ç´¢å¼•ç±»å‹](#1-mysql-å¸¸è§ç´¢å¼•ç±»å‹)
        - [ğŸ”¹ 1.1 B-Tree ç´¢å¼•ï¼ˆæœ€å¸¸ç”¨ï¼‰](#-11-b-tree-ç´¢å¼•æœ€å¸¸ç”¨)
        - [ğŸ”¹ 1.2 Hash ç´¢å¼•](#-12-hash-ç´¢å¼•)
        - [ğŸ”¹ 1.3 å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰](#-13-å…¨æ–‡ç´¢å¼•fulltext)
        - [ğŸ”¹ 1.4 ç©ºé—´ç´¢å¼•ï¼ˆSPATIALï¼‰](#-14-ç©ºé—´ç´¢å¼•spatial)
        - [ğŸ”¹ 1.5 ä¸»é”®ç´¢å¼•ï¼ˆPrimary Keyï¼‰](#-15-ä¸»é”®ç´¢å¼•primary-key)
        - [ğŸ”¹ 1.6 å”¯ä¸€ç´¢å¼•ï¼ˆUNIQUEï¼‰](#-16-å”¯ä¸€ç´¢å¼•unique)
        - [ğŸ”¹ 1.7 ç»„åˆç´¢å¼•ï¼ˆComposite Indexï¼‰](#-17-ç»„åˆç´¢å¼•composite-index)
      - [2. å·¥å…·ä¸è¯Šæ–­](#2-å·¥å…·ä¸è¯Šæ–­)
          - [](#)
  - [2.4 mysqlé”](#24-mysqlé”)
    - [2.4.1 åŠ é”æœºåˆ¶](#241-åŠ é”æœºåˆ¶)
    - [2.4.2 mysqlé”åˆ†ç±»](#242-mysqlé”åˆ†ç±»)
    - [2.4.3 mysql-Innodbé”ä»‹ç»](#243-mysql-innodbé”ä»‹ç»)
    - [2.4.4 mysql-Innodbé”å®ç°](#244-mysql-innodbé”å®ç°)
  - [2.5 äº‹åŠ¡éš”ç¦»](#25-äº‹åŠ¡éš”ç¦»)
    - [2.5.1 æ•°æ®åº“äº‹åŠ¡ç‰¹å¾](#251-æ•°æ®åº“äº‹åŠ¡ç‰¹å¾)
    - [2.5.2 MySQL æ•°æ®éš”ç¦»çº§åˆ«](#252-mysql-æ•°æ®éš”ç¦»çº§åˆ«)
    - [2.5.3 è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»çš„æ¦‚å¿µ](#253-è„è¯»å¹»è¯»ä¸å¯é‡å¤è¯»çš„æ¦‚å¿µ)
  - [2.6 èŒƒå¼](#26-èŒƒå¼)
  - [2.7 Mysqlç»éªŒ](#27-mysqlç»éªŒ)
- [ç¬¬ä¸‰ç«  ä¸­é—´ä»¶](#ç¬¬ä¸‰ç« -ä¸­é—´ä»¶)
  - [3.1 redis](#31-redis)
    - [3.1.1 å¸¸ç”¨çš„æ•°æ®ç±»å‹](#311-å¸¸ç”¨çš„æ•°æ®ç±»å‹)
    - [3.1.2 æœåŠ¡é›ªå´©ä¸å‡»ç©¿](#312-æœåŠ¡é›ªå´©ä¸å‡»ç©¿)
    - [3.1.3 å“¨å…µ](#313-å“¨å…µ)
    - [3.1.4 æ¶ˆæ¯è®¢é˜…](#314-æ¶ˆæ¯è®¢é˜…)
  - [3.x ä¸­é—´ä»¶ç»éªŒ](#3x-ä¸­é—´ä»¶ç»éªŒ)
- [ç¬¬å››ç«  Linux](#ç¬¬å››ç« -linux)
  - [4.x Linuxç»éªŒ](#4x-linuxç»éªŒ)
- [ç¬¬äº”ç«  Spring-Boot](#ç¬¬äº”ç« -spring-boot)
  - [5.1 Spring-Bootç»éªŒ](#51-spring-bootç»éªŒ)
  - [5.2 Spring ä¸­çš„ maven å†²çªä¸ç®¡ç†](#52-spring-ä¸­çš„-maven-å†²çªä¸ç®¡ç†)
    - [5.2.1 SpringBoot ä¸­çš„ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨ä»²è£æœºåˆ¶](#521-springboot-ä¸­çš„ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨ä»²è£æœºåˆ¶)
  - [Spring yml](#spring-yml)
  - [Spring åŠ¨æ€ä»£ç†](#spring-åŠ¨æ€ä»£ç†)
      - [1. ä»€ä¹ˆæ˜¯ Spring åŠ¨æ€ä»£ç†](#1-ä»€ä¹ˆæ˜¯-spring-åŠ¨æ€ä»£ç†)
      - [2. Spring åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼](#2-spring-åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼)
        - [2.1 JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰](#21-jdk-åŠ¨æ€ä»£ç†åŸºäºæ¥å£)
        - [2.2 CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºç»§æ‰¿ï¼‰](#22-cglib-åŠ¨æ€ä»£ç†åŸºäºç»§æ‰¿)
      - [3. Spring å¦‚ä½•é€‰æ‹© JDK / CGLIB](#3-spring-å¦‚ä½•é€‰æ‹©-jdk--cglib)
      - [4. Spring åŠ¨æ€ä»£ç†çš„åº”ç”¨](#4-spring-åŠ¨æ€ä»£ç†çš„åº”ç”¨)
      - [5. åŠ¨æ€ä»£ç† vs é™æ€ä»£ç†](#5-åŠ¨æ€ä»£ç†-vs-é™æ€ä»£ç†)
      - [6. æ€»ç»“](#6-æ€»ç»“)
  - [Spring AOP ä¸ AspectJ åŒºåˆ«](#spring-aop-ä¸-aspectj-åŒºåˆ«)
      - [ğŸŒ± ä¾‹å­ 1ï¼šæ‹¦æˆª **æ™®é€šå¯¹è±¡**ï¼ˆé Spring Beanï¼‰](#-ä¾‹å­-1æ‹¦æˆª-æ™®é€šå¯¹è±¡é-spring-bean)
      - [ğŸŒ± ä¾‹å­ 2ï¼šæ‹¦æˆª **æ„é€ å‡½æ•°**](#-ä¾‹å­-2æ‹¦æˆª-æ„é€ å‡½æ•°)
      - [ğŸŒ± ä¾‹å­ 3ï¼šæ‹¦æˆª **å­—æ®µè®¿é—®**](#-ä¾‹å­-3æ‹¦æˆª-å­—æ®µè®¿é—®)
      - [ğŸŒ± æ€»ç»“å·®å¼‚ï¼ˆç»“åˆä¾‹å­ï¼‰](#-æ€»ç»“å·®å¼‚ç»“åˆä¾‹å­)
  - [åŠ¨æ€æ–¹è¨€: å†™ä¸€ä¸ªâ€œåŠ¨æ€æ–¹è¨€â€ï¼Œè®©ä¸€ä¸ªåˆ†é¡µæ’ä»¶é€‚é… Oracle + Postgres](#åŠ¨æ€æ–¹è¨€-å†™ä¸€ä¸ªåŠ¨æ€æ–¹è¨€è®©ä¸€ä¸ªåˆ†é¡µæ’ä»¶é€‚é…-oracle--postgres)
    - [1. è‡ªå®šä¹‰ä¸€ä¸ªåŠ¨æ€æ–¹è¨€ `DynamicRoutingDialect`](#1-è‡ªå®šä¹‰ä¸€ä¸ªåŠ¨æ€æ–¹è¨€-dynamicroutingdialect)
    - [2. å…¨å±€åªä¿ç•™ä¸€ä¸ª MybatisPlusInterceptorï¼ˆä¸è¦å†åˆ† Pg / Oracle ä¸¤ä¸ª Beanï¼‰](#2-å…¨å±€åªä¿ç•™ä¸€ä¸ª-mybatisplusinterceptorä¸è¦å†åˆ†-pg--oracle-ä¸¤ä¸ª-bean)
    - [3. ç»§ç»­ç”¨ @DSï¼Œä¸€åˆ‡ç…§æ—§](#3-ç»§ç»­ç”¨-dsä¸€åˆ‡ç…§æ—§)
  - [é™æµç®¡ç†å™¨](#é™æµç®¡ç†å™¨)
    - [ä¸€ã€æœ€ç®€å•ï¼šåŸºäºæ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨ + Guava RateLimiterï¼ˆå•æœºé™æµï¼‰](#ä¸€æœ€ç®€å•åŸºäºæ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨--guava-ratelimiterå•æœºé™æµ)
      - [1. å¼•å…¥ä¾èµ–](#1-å¼•å…¥ä¾èµ–)
      - [2. å†™ä¸€ä¸ªé™æµç®¡ç†å™¨ï¼ˆæ ¹æ®æ¥å£ç»´åº¦é™æµï¼‰](#2-å†™ä¸€ä¸ªé™æµç®¡ç†å™¨æ ¹æ®æ¥å£ç»´åº¦é™æµ)
      - [3. åœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆå§‹åŒ–å„æ¥å£é™æµè§„åˆ™](#3-åœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆå§‹åŒ–å„æ¥å£é™æµè§„åˆ™)
      - [4. ç”¨æ‹¦æˆªå™¨å¯¹æ¯æ¬¡è¯·æ±‚åšé™æµåˆ¤æ–­](#4-ç”¨æ‹¦æˆªå™¨å¯¹æ¯æ¬¡è¯·æ±‚åšé™æµåˆ¤æ–­)
      - [5. æ³¨å†Œæ‹¦æˆªå™¨](#5-æ³¨å†Œæ‹¦æˆªå™¨)
    - [äºŒã€æŒ‰ IP / ç”¨æˆ·ç»´åº¦çš„æ¥å£é™æµ](#äºŒæŒ‰-ip--ç”¨æˆ·ç»´åº¦çš„æ¥å£é™æµ)
    - [ä¸‰ã€ç”¨æ³¨è§£ + AOP åšæ›´ä¼˜é›…çš„æ¥å£é™æµ](#ä¸‰ç”¨æ³¨è§£--aop-åšæ›´ä¼˜é›…çš„æ¥å£é™æµ)
    - [å››ã€åˆ†å¸ƒå¼é™æµï¼šRedis + Luaï¼ˆå¤šå®ä¾‹éƒ¨ç½²å¿…çœ‹ï¼‰](#å››åˆ†å¸ƒå¼é™æµredis--luaå¤šå®ä¾‹éƒ¨ç½²å¿…çœ‹)
    - [ç®€å•æ€è·¯ï¼š](#ç®€å•æ€è·¯)
    - [äº”ã€ä½¿ç”¨æˆç†Ÿæ¡†æ¶ï¼šBucket4j / Resilience4j / Spring Cloud Gateway](#äº”ä½¿ç”¨æˆç†Ÿæ¡†æ¶bucket4j--resilience4j--spring-cloud-gateway)
- [ç¬¬å…­ç«  Spring-cloud-alibaba](#ç¬¬å…­ç« -spring-cloud-alibaba)
- [ç¬¬ä¸ƒç«  æ•°æ®ç»“æ„ä¸ç®—æ³•](#ç¬¬ä¸ƒç« -æ•°æ®ç»“æ„ä¸ç®—æ³•)
- [ç¬¬å…«ç«  å¸¸è§çš„é”åŠå…¶å®ç°](#ç¬¬å…«ç« -å¸¸è§çš„é”åŠå…¶å®ç°)
- [ç¬¬ä¹ç«  ç¨‹åºè®¾è®¡](#ç¬¬ä¹ç« -ç¨‹åºè®¾è®¡)
  - [9.1 é¢å‘å¯¹è±¡è®¾è®¡](#91-é¢å‘å¯¹è±¡è®¾è®¡)
  - [9.2 è®¾è®¡æ€æƒ³](#92-è®¾è®¡æ€æƒ³)
    - [9.2.1 è‡ªé¡¶å‘ä¸‹](#921-è‡ªé¡¶å‘ä¸‹)
    - [9.2.2 æ•æ·å¼€å‘](#922-æ•æ·å¼€å‘)
    - [9.2.3 é¢†åŸŸé©±åŠ¨](#923-é¢†åŸŸé©±åŠ¨)
  - [9.3 è®¾è®¡æ¨¡å¼](#93-è®¾è®¡æ¨¡å¼)
  - [å¹‚ç­‰\&ä¸€è‡´æ€§\&ACID\&SOLID](#å¹‚ç­‰ä¸€è‡´æ€§acidsolid)
    - [æ¨¡å¼é€‰æ‹©](#æ¨¡å¼é€‰æ‹©)
    - [å¹‚ç­‰è®¾è®¡](#å¹‚ç­‰è®¾è®¡)
    - [æ•°æ®ä¸€è‡´æ€§](#æ•°æ®ä¸€è‡´æ€§)
    - [ACID](#acid)
    - [SOLID](#solid)
- [ç¬¬åç«  DevOps](#ç¬¬åç« -devops)
  - [10.1 Jenkins](#101-jenkins)
  - [10.2 Docker](#102-docker)
  - [10.3 k8s](#103-k8s)
- [ç¬¬åä¸€ç«  Android](#ç¬¬åä¸€ç« -android)
- [ç¬¬åäºŒç«  Vue](#ç¬¬åäºŒç« -vue)
  - [12.1 Vueç”Ÿå‘½å‘¨æœŸ](#121-vueç”Ÿå‘½å‘¨æœŸ)
  - [12.x Vueç»éªŒ](#12x-vueç»éªŒ)
- [ç¬¬åä¸‰ç«  å¸¸ç”¨å·¥å…·](#ç¬¬åä¸‰ç« -å¸¸ç”¨å·¥å…·)
- [ç¬¬åå››ç«  ç½‘ç»œå¼€å‘](#ç¬¬åå››ç« -ç½‘ç»œå¼€å‘)
  - [14.1 OSIä¸ƒå±‚æ¨¡å‹](#141-osiä¸ƒå±‚æ¨¡å‹)
  - [14.2 ç½‘ç»œåè®®](#142-ç½‘ç»œåè®®)
  - [æ’åº/æŸ¥æ‰¾ç®—æ³•](#æ’åºæŸ¥æ‰¾ç®—æ³•)
  - [é›¶æ‹·è´/DMA](#é›¶æ‹·è´dma)
- [](#-1)
  - [ä¿æŒå¥½çš„å¯¹æ¥ä¹ æƒ¯](#ä¿æŒå¥½çš„å¯¹æ¥ä¹ æƒ¯)
- [é«˜å¹¶å‘](#é«˜å¹¶å‘)
  - [å¹¶å‘åŸç†](#å¹¶å‘åŸç†)
    - [tomcat çš„å¹¶å‘  æœ¬è´¨æ˜¯å¤šçº¿ç¨‹å—](#tomcat-çš„å¹¶å‘--æœ¬è´¨æ˜¯å¤šçº¿ç¨‹å—)
      - [1. Tomcat çš„æ ¸å¿ƒå¹¶å‘æ¨¡å‹](#1-tomcat-çš„æ ¸å¿ƒå¹¶å‘æ¨¡å‹)
      - [2. Tomcat çš„ä¸åŒ I/O æ¨¡å¼](#2-tomcat-çš„ä¸åŒ-io-æ¨¡å¼)
      - [3. ä¸ `@Async` / Servlet 3.0+ Async çš„å…³ç³»](#3-ä¸-async--servlet-30-async-çš„å…³ç³»)
      - [4. å¯¹æ¯” Python WSGI / ASGI](#4-å¯¹æ¯”-python-wsgi--asgi)
  - [åç«¯æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡](#åç«¯æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡)
  - [**åå°æœåŠ¡å™¨å¸¸ç”¨çš„ä¼˜åŒ–æ–¹å¼**](#åå°æœåŠ¡å™¨å¸¸ç”¨çš„ä¼˜åŒ–æ–¹å¼)
  - [ç¼“å­˜](#ç¼“å­˜)
      - [**ç¼“å­˜çš„æœ¬è´¨**](#ç¼“å­˜çš„æœ¬è´¨)
        - [**åˆç†çš„ä½¿ç”¨ç¼“å­˜**](#åˆç†çš„ä½¿ç”¨ç¼“å­˜)
        - [**é¢‘ç¹ä¿®æ”¹çš„æ•°æ®** â€ƒâ€ƒ](#é¢‘ç¹ä¿®æ”¹çš„æ•°æ®-)
        - [**æ²¡æœ‰çƒ­ç‚¹çš„è®¿é—®** â€ƒâ€ƒ](#æ²¡æœ‰çƒ­ç‚¹çš„è®¿é—®-)
        - [**æ•°æ®çš„ä¸ä¸€è‡´ä¸è„è¯»** â€ƒâ€ƒ](#æ•°æ®çš„ä¸ä¸€è‡´ä¸è„è¯»-)
      - [ç¼“å­˜çš„å¸¸è§é—®é¢˜ä¼˜åŒ–æ‰‹æ®µ](#ç¼“å­˜çš„å¸¸è§é—®é¢˜ä¼˜åŒ–æ‰‹æ®µ)
        - [ç¼“å­˜é›ªå´©](#ç¼“å­˜é›ªå´©)
        - [ç¼“å­˜ç©¿é€](#ç¼“å­˜ç©¿é€)
        - [ç¼“å­˜é¢„çƒ­](#ç¼“å­˜é¢„çƒ­)
      - [**åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„**](#åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„)
    - [å›è¡¨](#å›è¡¨)
  - [å¼‚æ­¥](#å¼‚æ­¥)
  - [é›†ç¾¤](#é›†ç¾¤)
  - [ä»£ç ä¼˜åŒ–](#ä»£ç ä¼˜åŒ–)
  - [å­˜å‚¨ä¼˜åŒ–](#å­˜å‚¨ä¼˜åŒ–)
- [æ»¤æ³¢å™¨](#æ»¤æ³¢å™¨)
- [æ–°ç‰¹æ€§](#æ–°ç‰¹æ€§)
  - [JDK 21](#jdk-21)
    - [è™šæ‹Ÿçº¿ç¨‹](#è™šæ‹Ÿçº¿ç¨‹)

+ Object & class
+ Encapsulation
+ Abstraction 
+ Inheritance
+ Polymorphism
+ Generic

# ç¬¬ä¸€ç«  Java

## Java åŸºç¡€

### åŸºç¡€ç±»å‹
äºŒè¿›åˆ¶åŸç†, è®¡ç®—æœºä¸­ç¬¬ä¸€ä½ä¸ºç¬¦å·ä½, æ‰€ä»¥å–å€¼èŒƒå›´æ­£æ•°æœ€å¤§èŒƒå›´å°‘ä¸€ä½ã€‚
|ç±»å‹|å­—èŠ‚æ•°|å–å€¼èŒƒå›´|å…·ä½“å–å€¼èŒƒå›´|
|:-:|:-:|:-:|:-:|
|byte|1|Â±2^7|[-128, 127]|
|short|2|Â±2^15|[-32768, 32767]|
|int|4|Â±2^31|[-21äº¿xxx, 21äº¿xxx]|
|long|8|Â±2^63|å¾ˆå¤§|
|float|4|Â±2^31|[-21äº¿xxx, 21äº¿xxx]|
|double|8|Â±2^63|å¾ˆå¤§|
|char|2|Â±2^15|[-32768, 32767]|
|boolean|4||true/false|

åœ¨Javaä¸­ï¼Œbooleanè¢«å½“æˆintå¤„ç†ï¼Œæ‰€ä»¥4ä¸ªå­—èŠ‚ã€‚

### è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦
|ä¿®é¥°ç¬¦|å½“å‰ç±»|åŒä¸€åŒ…å†…|åŒä¸€åŒ…å­å­™|ä¸åŒåŒ…å­å­™|å…¶ä»–åŒ…|
|:-:|:-:|:-:|:-:|:-:|:-:|
|default|âˆš|âˆš|âˆš|||
|public|âˆš|âˆš|âˆš|âˆš|âˆš|
|private|âˆš|||||
|protected|âˆš|âˆš|âˆš|âˆš/X||

> protected
> + å­ç±»ä¸åŸºç±»åœ¨åŒä¸€åŒ…ä¸­ï¼š  
>   è¢«å£°æ˜ä¸º protected çš„å˜é‡ã€æ–¹æ³•å’Œæ„é€ å™¨èƒ½è¢«åŒä¸€ä¸ªåŒ…ä¸­çš„ä»»ä½•å…¶ä»–ç±»è®¿é—®ï¼›
> + å­ç±»ä¸åŸºç±»ä¸åœ¨åŒä¸€åŒ…ä¸­ï¼š  
>   é‚£ä¹ˆåœ¨å­ç±»ä¸­ï¼Œå­ç±»å®ä¾‹å¯ä»¥è®¿é—®å…¶ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„ protected æ–¹æ³•ï¼Œè€Œä¸èƒ½è®¿é—®åŸºç±»å®ä¾‹çš„protectedæ–¹æ³•ã€‚
```java
package p2;
class MyObject2 {
    protected Object clone() throws CloneNotSupportedException{
       return super.clone();
    }
}
 
package p22;
public class Test2 extends MyObject2 {
    public static void main(String args[]) {
       MyObject2 obj = new MyObject2();
       obj.clone(); // Compile Error         ----(1)
 
       Test2 tobj = new Test2();
       tobj.clone(); // Complie OK         ----(2)
    }
}
```
å¯¹äº(1)è€Œè¨€ï¼Œclone()æ–¹æ³•æ¥è‡ªäºç±»MyObject2æœ¬èº«ï¼Œå› æ­¤å…¶å¯è§æ€§ä¸ºåŒ…p2åŠMyObject2çš„å­ç±»ï¼Œè™½ç„¶Test2æ˜¯MyObject2çš„å­ç±»ï¼Œä½†åœ¨Test2ä¸­ä¸èƒ½è®¿é—®åŸºç±»MyObject2çš„protectedæ–¹æ³•clone()ï¼Œå› æ­¤ç¼–è¯‘ä¸é€šè¿‡;å¯¹äº(2)è€Œè¨€ï¼Œç”±äºåœ¨Test2ä¸­è®¿é—®çš„æ˜¯å…¶æœ¬èº«å®ä¾‹çš„ä»åŸºç±»MyObject2ç»§æ‰¿æ¥çš„çš„clone()ï¼Œå› æ­¤ç¼–è¯‘é€šè¿‡ã€‚

### é™æ€ä¸Šä¸‹æ–‡ä¸éé™æ€å†…éƒ¨ç±»

ChatbotInitParam å®ä½“å¦‚ä¸‹æ‰€ç¤º, ä½†æ˜¯ ChatbotInitParam.ChatbotInitChatbotConfigParam chatbotConfig = new ChatbotInitParam.ChatbotInitChatbotConfigParam(); æŠ¥é”™, æç¤ºChatbotInitParam' is not an enclosing class  ?

```java
@Data
public class ChatbotInitParam {

    @ApiModelProperty(value = "å®ä¾‹å”¯â¼€id")
    private String instance_id;

    @Data
    public class ChatbotInitChatbotConfigParam {

        @ApiModelProperty(value = "æœºå™¨â¼ˆåç§°")
        private String name;

    }

}

```
####  ä¸ºä»€ä¹ˆå¦‚æœæ‚¨éœ€è¦åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºéé™æ€å†…éƒ¨ç±»çš„å®ä¾‹ï¼Œæ‚¨éœ€è¦å°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€çš„

åœ¨ Java ä¸­ï¼Œéé™æ€å†…éƒ¨ç±»ï¼ˆä¹Ÿç§°ä¸ºæˆå‘˜å†…éƒ¨ç±»ï¼‰æ˜¯ä¸å¤–éƒ¨ç±»çš„å®ä¾‹ç›¸å…³è”çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹å˜é‡å’Œæ–¹æ³•ã€‚è€Œåœ¨é™æ€æ–¹æ³•ä¸­ï¼Œæ‚¨æ— æ³•ç›´æ¥è®¿é—®éé™æ€çš„å®ä¾‹å˜é‡ï¼Œå› ä¸ºé™æ€æ–¹æ³•æ˜¯ä¸ç±»æœ¬èº«å…³è”ï¼Œè€Œä¸æ˜¯ä¸ç‰¹å®šå®ä¾‹å…³è”ã€‚

å¦‚æœè¦åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è®¿é—®å†…éƒ¨ç±»ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æ–¹æ³•ï¼š

+ å°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€ï¼šå°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€åï¼Œå®ƒå°±ä¸å†ä¸å¤–éƒ¨ç±»çš„å®ä¾‹ç›¸å…³è”ï¼Œå¯ä»¥åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºå®ä¾‹ã€‚è¿™æ˜¯å› ä¸ºé™æ€å†…éƒ¨ç±»ä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ã€‚

+ ä½¿ç”¨å¤–éƒ¨ç±»çš„å®ä¾‹åˆ›å»ºå†…éƒ¨ç±»çš„å®ä¾‹ï¼šå¦‚æœæ‚¨ä¸å¸Œæœ›å°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€ï¼Œè€Œåˆæƒ³åœ¨é™æ€æ–¹æ³•ä¸­åˆ›å»ºå®ƒçš„å®ä¾‹ï¼Œæ‚¨å¯ä»¥å…ˆåˆ›å»ºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œç„¶åé€šè¿‡è¯¥å®ä¾‹æ¥åˆ›å»ºå†…éƒ¨ç±»çš„å®ä¾‹ã€‚

åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨é™æ€æ–¹æ³•ä¸­åˆ›å»º ChatbotInitChatbotConfigParam çš„å®ä¾‹ï¼Œæ‚¨å¯ä»¥å°†å†…éƒ¨ç±»å£°æ˜ä¸ºé™æ€ï¼Œæˆ–è€…å°†å…¶æå–ä¸ºç‹¬ç«‹çš„ç±»ï¼Œæˆ–è€…é€šè¿‡åˆ›å»ºå¤–éƒ¨ç±»çš„å®ä¾‹æ¥åˆ›å»ºå†…éƒ¨ç±»çš„å®ä¾‹ã€‚é€‰æ‹©å“ªç§æ–¹æ³•å–å†³äºæ‚¨çš„éœ€æ±‚å’Œè®¾è®¡ã€‚

#### é™æ€ä¸Šä¸‹æ–‡


"é™æ€ä¸Šä¸‹æ–‡" æ˜¯æŒ‡åœ¨ Java ä¸­ä¸ç±»æœ¬èº«å…³è”çš„ç¯å¢ƒï¼Œè€Œä¸æ˜¯ä¸ç±»çš„å®ä¾‹ç›¸å…³è”çš„ç¯å¢ƒã€‚é™æ€ä¸Šä¸‹æ–‡ä¸­çš„ä»£ç å¯ä»¥è®¿é—®å’Œæ“ä½œé™æ€æˆå‘˜ï¼ˆé™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼‰ï¼Œä½†ä¸èƒ½è®¿é—®éé™æ€çš„å®ä¾‹æˆå‘˜ã€‚

å…·ä½“æ¥è¯´ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œæ‚¨å¤„äºé™æ€ä¸Šä¸‹æ–‡ï¼š

+ åœ¨ç±»çš„é™æ€æ–¹æ³•ä¸­ï¼šé™æ€æ–¹æ³•æ˜¯ä¸ç±»æœ¬èº«ç›¸å…³è”çš„ï¼Œå› æ­¤åœ¨é™æ€æ–¹æ³•ä¸­åªèƒ½è®¿é—®é™æ€æˆå‘˜ï¼Œä¸èƒ½è®¿é—®éé™æ€çš„å®ä¾‹æˆå‘˜ã€‚

+ åœ¨é™æ€åˆå§‹åŒ–å—ä¸­ï¼šé™æ€åˆå§‹åŒ–å—æ˜¯åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œçš„ï¼Œä¹Ÿå±äºç±»æœ¬èº«çš„æ“ä½œï¼Œå› æ­¤åŒæ ·åªèƒ½è®¿é—®é™æ€æˆå‘˜ã€‚

+ åœ¨é™æ€å­—æ®µçš„åˆå§‹åŒ–ä¸­ï¼šé™æ€å­—æ®µçš„åˆå§‹åŒ–ä¹Ÿåœ¨ç±»åŠ è½½æ—¶è¿›è¡Œï¼Œæ‰€ä»¥åªèƒ½è®¿é—®é™æ€æˆå‘˜ã€‚

æ€»ä¹‹ï¼Œé™æ€ä¸Šä¸‹æ–‡è¡¨ç¤ºæ‚¨å¤„äºä¸ç±»æœ¬èº«å…³è”çš„ç¯å¢ƒï¼Œè¿™æ„å‘³ç€æ‚¨æ— æ³•åœ¨å…¶ä¸­è®¿é—®ä¸ç±»çš„å®ä¾‹ç›¸å…³çš„æˆå‘˜ï¼Œé™¤éè¿™äº›æˆå‘˜è¢«å£°æ˜ä¸ºé™æ€ã€‚

> æ€»ç»“: åœ¨æœ¬ä¾‹ä¸­ new ChatbotInitParam.ChatbotInitChatbotConfigParam(), å°±æ˜¯è°ƒç”¨äº† ChatbotInitParam ç±»ä¸‹çš„ ChatbotInitChatbotConfigParam() é™æ€æ–¹æ³•, è€Œè¿™ä¸ªç±»æ˜¯ class xxx å¹¶ä¸æ˜¯é™æ€çš„, æ‰€ä»¥å¯¼è‡´äº†ä¸€åœº


### Javaä½¿ç”¨thiså…³é”®å­—è°ƒç”¨æœ¬ç±»é‡è½½æ„é€ å™¨
https://www.cnblogs.com/wanghongyun/p/6132083.html
```java
this(name,"ç”·");
```

### æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æœ‰å“ªäº›

ç›¸ä¼¼ç‚¹ï¼š

+ ä¸èƒ½å®ä¾‹åŒ–
+ åŒ…å«æœªå®ç°çš„æ–¹æ³•å£°æ˜
+ æ´¾ç”Ÿç±»å¿…é¡»å®ç°æœªå®ç°çš„æ–¹æ³•ï¼ŒæŠ½è±¡ç±»æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ¥å£åˆ™æ˜¯æ‰€æœ‰æˆå‘˜ï¼ˆä¸ä»…æ˜¯æ–¹æ³•åŒ…æ‹¬å…¶ä»–æˆå‘˜ï¼‰

åŒºåˆ«: 

+ é»˜è®¤çš„æ–¹æ³•å®ç°  
  æŠ½è±¡ç±»å¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼›æ¥å£ï¼ŒJava8è§„å®šå¯ä»¥ä¸ºæ¥å£æä¾›é»˜è®¤å®ç°çš„æ–¹æ³•å¹¶ä¸”ä¸ç”¨å¼ºåˆ¶å®ç°ã€‚
+ å®ç°  
  å¦‚æœå­ç±»ä¸æ˜¯æŠ½è±¡ç±»çš„è¯ï¼Œå®ƒéœ€è¦é‡å†™æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼›æ¥å£å­ç±»ä½¿ç”¨å…³é”®å­—implements æ¥å®ç°æ¥å£ï¼Œå®ƒéœ€è¦é‡å†™æ¥å£ä¸­æ²¡æœ‰é»˜è®¤ã€‚ 
+ æ„é€ å™¨
  æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨ï¼Œæ¥å£ä¸èƒ½æœ‰æ„é€ å™¨ã€‚
+ ä¸æ­£å¸¸Javaç±»çš„åŒºåˆ«
  é™¤äº†ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»ä¹‹å¤–ï¼Œå’Œæ™®é€šJavaç±»æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼›æ¥å£æ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹å¤–ã€‚
+ è®¿é—®ä¿®é¥°ç¬¦
  æŠ½è±¡æ–¹æ³•å¯æœ‰public.protectedå’Œdefaultã€abstractä¿®é¥°ç¬¦ã€‚ä¸èƒ½ç”¨privatestatic.synchronizeã€ native ä¿®é¥°ã€‚æ¥å£å±æ€§é»˜è®¤ä¿®é¥°ç¬¦æ˜¯publicstatic final (å¿…é¡»èµ‹åˆå€¼) ï¼Œæ–¹æ³•é»˜è®¤ä¿®é¥°ç¬¦æ˜¯publicabstract. Java8 å¼€å§‹å‡ºç°é™æ€æ–¹æ³•ï¼Œå¤šåŠ staticå…³é”®å­—ã€‚
+ mainæ–¹æ³•
  æŠ½è±¡ç±»å¯ä»¥è¿è¡Œå®ƒï¼›æ¥å£æ²¡æœ‰mainæ–¹æ³•ï¼Œå› æ­¤ä¸èƒ½è¿è¡Œå®ƒã€‚
+ å¤šç»§æ‰¿
  æŠ½è±¡ç±»å¯ä»¥ç»§æ‰¿ä¸€ä¸ªç±»å’Œå®ç°å¤šä¸ªæ¥å£ï¼›æ¥å£åªå¯ä»¥ç»§æ‰¿ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚

æŠ½è±¡ç±»çš„è¿ç”¨æ„ä¹‰: 

+ åœ¨é¢å‘å¯¹è±¡æ–¹æ³•ä¸­ï¼ŒæŠ½è±¡ç±»ä¸»è¦ç”¨æ¥è¿›è¡Œç±»å‹éšè—ã€‚æ„é€ å‡ºä¸€ä¸ªå›ºå®šçš„ä¸€ç»„è¡Œä¸ºçš„æŠ½è±¡æè¿°ï¼Œä½†æ˜¯è¿™ç»„è¡Œä¸ºå´èƒ½å¤Ÿæœ‰ä»»æ„ä¸ªå¯èƒ½çš„å…·ä½“å®ç°æ–¹å¼
+ è¿™ä¸ªæŠ½è±¡æè¿°å°±æ˜¯æŠ½è±¡ç±»ï¼Œè€Œè¿™ä¸€ç»„ä»»æ„ä¸ªå¯èƒ½çš„å…·ä½“å®ç°åˆ™è¡¨ç°ä¸ºæ‰€æœ‰å¯èƒ½çš„æ´¾ç”Ÿç±»ã€‚æ¨¡å—å¯ä»¥æ“ä½œä¸€ä¸ªæŠ½è±¡ä½“
+ ç”±äºæ¨¡å—ä¾èµ–äºä¸€ä¸ªå›ºå®šçš„æŠ½è±¡ä½“ï¼Œå› æ­¤å®ƒå¯ä»¥æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ï¼›åŒæ—¶ï¼Œé€šè¿‡ä»è¿™ä¸ªæŠ½è±¡ä½“æ´¾ç”Ÿï¼Œä¹Ÿå¯æ‰©å±•æ­¤æ¨¡å—çš„è¡Œä¸ºåŠŸèƒ½
+ ä¸ºäº†èƒ½å¤Ÿå®ç°é¢å‘å¯¹è±¡è®¾è®¡çš„ä¸€ä¸ªæœ€æ ¸å¿ƒçš„åŸåˆ™OCP(Open-Closed Principle)ï¼ŒæŠ½è±¡ç±»æ˜¯å…¶ä¸­çš„å…³é”®æ‰€åœ¨

### FastJson

1. åœ¨ fastJson DefaultJSONParser.parse() ä¸­              

```
case LBRACE:
                JSONObject object = new JSONObject(lexer.isEnabled(Feature.OrderedField));
                return parseObject(object, fieldName);
```

å°†æ‰€æœ‰{ } è¯†åˆ«æˆ JSONObject

2. SerializerFeature ä¸ Feature ä»€ä¹ˆå…³ç³» ? 
   æ²¡æœ‰å…³ç³»; é‡è½½æ–¹æ³•

### Java é˜Ÿåˆ—

+ [é«˜æ€§èƒ½é˜Ÿåˆ—â€”â€”Disruptor](https://tech.meituan.com/2016/11/18/disruptor.html)
+ [javaé˜Ÿåˆ—ä¸çº¿ç¨‹æ± ](https://cloud.tencent.com/developer/article/2068908)

### swagger

knife4j v3 add header (4.0.0 bug)

+ æ–‡æ¡£ç®¡ç† -> å…¨å±€å‚æ•°è®¾ç½® -> å‚æ•°åç§°: AUTH_HEADER

### Javaä½¿ç”¨HMAC-SHA256ç®—æ³•å®ç°æ¥å£è®¤è¯

https://www.jianshu.com/p/365c2b3811d9

### Java å‘½åè§„èŒƒ

https://www.jhelp.net/p/Dq0h3U69SZfAAGhP

### åˆ†å¸ƒå¼é” redission

https://blog.csdn.net/u014042066/article/details/72830939

### Java å®ç°å›è°ƒ

## 1.3 Map

### 1.3.1 Mapçš„å®ç°ç±»
|å®ç°ç±»|key value null?|æœ‰åº?|å¹¶å‘?|
|:-:|:-:|:-:|:-:|
|HashMap|key valueå¯ä»¥ä¸ºnull|æ— åº|çº¿ç¨‹ä¸å®‰å…¨|
|LinkedHashMap|key valueå¯ä»¥ä¸ºnull|å…ƒç´ æŒ‰æ’å…¥çš„é¡ºåºæ’åˆ—|çº¿ç¨‹ä¸å®‰å…¨|
|TreeMap|key valueéƒ½ä¸èƒ½ä¸ºnull|æŒ‰keyè‡ªç„¶æ’åº|éçº¿ç¨‹å®‰å…¨|
|ConcurrentHashMap|key valueéƒ½ä¸èƒ½ä¸ºnull|æŒ‰keyè‡ªç„¶æ’åº|çº¿ç¨‹å®‰å…¨|
|Hashtable|key valueéƒ½ä¸èƒ½ä¸ºnull|æ— åº|çº¿ç¨‹å®‰å…¨|
|Properties|ä¸Hashtableä¸€è‡´|||

çœ‹æºç çš„æ—¶å€™, æˆ‘ä»¬å‘ç°, Hashtableçš„putæ–¹æ³•æœ‰`synchronized`, æ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„  
è€ŒConcurrentHashMapæ˜¯åœ¨putæ–¹æ³•çš„å†…éƒ¨, ä½¿ç”¨äº†`synchronized`çš„æ–¹æ³•å—, æ‰€ä»¥ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„

Propertiesæ˜¯Hashtableçš„å­ç±»ï¼Œåœ¨å¤„ç†å±æ€§æ–‡ä»¶æ—¶ç‰¹åˆ«æ–¹ä¾¿ã€‚Propertiesçš„keyã€valueéƒ½å¿…é¡»æ˜¯Stringã€‚
EnumMapæ˜¯ç”¨äºå­˜å‚¨enumç±»å‹çš„ç±», ç ”ç©¶æ„ä¹‰ä¸å¤§

> æ³¨: å¼„æ¸…è¿™ä¸ªéå¸¸é‡è¦,   
> è™½ç„¶ç›®å‰åç«¯éƒ½å¸¸ç”¨å¯¹è±¡ä¼ é€’æ•°æ®, ä½†æ˜¯åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹, æˆ‘ä»¬éœ€è¦å°†å¯¹è±¡è½¬åŒ–ä¸ºmapåšç‰¹æ®Šå¤„ç†,   
> å¦‚æœä½¿ç”¨äº†é”™è¯¯çš„ç±», åç«¯ä¼šç›´æ¥æŠ¥é”™, å¾ˆéš¾å®šä½


> æ³¨: TreeMap ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸å…è®¸å­˜æ”¾é‡å¤å…ƒç´ çš„ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¯å¯ä»¥å­˜æ”¾é‡å¤å…ƒç´ çš„  
> å­˜æ”¾å…ƒç´ æ—¶ï¼ŒTreeMapå®ç°å¤–éƒ¨æ¯”è¾ƒå™¨æ¥å£Comparatorï¼Œå¹¶é‡å†™å…¶compareæ–¹æ³•ï¼Œå½“åˆ¤æ–­å…ƒç´ é‡å¤æ—¶ï¼Œå¼ºåˆ¶compareæ–¹æ³•è¿”å›ä¸€ä¸ªé0çš„æ•°ï¼Œå°±å¯ä»¥å°†é‡å¤å…ƒç´ å­˜å…¥ï¼›
> å®ç°å¦‚ä¸‹: 

```
TreeMap<Integer,String> tree = new TreeMap<Integer,String>(new Comparator<Integer>(){
            @Override
            public int compare(Integer o1, Integer o2) {
                if(o1.equals(o2))
                    return 1;
                else
                return o1-o2;
            }
        });
```

## 1.4 Iterator
`Collection`æ˜¯`Iterator`çš„ä¸€ä¸ªå®ç°ç±»,   
`Collection`æœ‰ä¸¤ä¸ªé‡è¦çš„å®ç°ç±»: `Set`ä»¥åŠ`List`   
`Collection`çš„å®ç°ç±»å¯ä»¥è°ƒç”¨`streamæµ`çš„æ–¹æ³•, ä»¥åŠ`Iterator`çš„éå†æ–¹æ³•
```
        TreeSet<String> set = new TreeSet();
        set.add("1");
        for (String s : set) {
            System.out.println(s);
        }

        Iterator iterator = set.iterator();
        while (iterator.hasNext()) {
            System.out.println(iterator.next());
        }
```

### 1.4.1 Set
`Set`æ¥å£æ˜¯ä¸€ç§ä¸åŒ…æ‹¬é‡å¤å…ƒç´ çš„Collection, å…ƒç´ å¯ä»¥ä¸º`null`å€¼  
|å®ç°ç±»|æœ‰åº?|å¹¶å‘?|åº•å±‚|
|:-:|:-:|:-:|:-:|
|HashSet|æ— åº|çº¿ç¨‹ä¸å®‰å…¨|HashMap|
|LinkedHashSet|éå†åºå’Œæ’å…¥åºä¸€è‡´|çº¿ç¨‹ä¸å®‰å…¨|LinkHashMap|
|TreeSet|è‡ªç„¶æ’åº|éçº¿ç¨‹å®‰å…¨|TreeMap|

### 1.4.2 List
#### 1.4.2.1 å®ç°ç±»
+ ArrayListï¼Œåº•å±‚é‡‡ç”¨æ•°ç»„ç»“æ„çš„å®ç°çš„ã€‚(å†…å­˜ä¸­è¿ç»­ç©ºé—´)ã€‚jdk1.2åªå®ç°äº†Listæ¥å£ï¼ŒåŠŸèƒ½éƒ½æ˜¯Listæ¥å£ä¸­è§„å®šçš„ã€‚
    + ä¼˜ç‚¹ï¼šéå†è®¿é—®å…ƒç´ ï¼Œæ•ˆç‡å¾ˆé«˜
    + ç¼ºç‚¹ï¼šæ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œæ•ˆç‡ç›¸å¯¹ä½ã€‚
+ LinkedListï¼Œåº•å±‚é‡‡ç”¨åŒå‘é“¾è¡¨ç»“æ„å®ç°çš„ã€‚(å…ƒç´ åœ¨å†…å­˜ä¸­ä¸æŒ¨ç€ï¼Œå…ƒç´ ä¹‹é—´çš„æŒ‡å‘)ã€‚jdk1.2å®ç°äº†Listæ¥å£çš„åŒæ—¶ï¼Œè¿˜å®ç°äº†Dequeæ¥å£ï¼Œæ‰€ä»¥æœ‰è¿™ä¸¤ä¸ªæ¥å£ä¸­çš„åŠŸèƒ½ã€‚
    + ä¼˜ç‚¹ï¼šæ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚
    + ç¼ºç‚¹ï¼šéå†è®¿é—®å…ƒç´ ï¼Œæ•ˆç‡ç›¸å¯¹ä½ã€‚
	
+ Vectorï¼Œæ˜¯ArrayListçš„å‰èº«ã€‚ä¹Ÿæ˜¯æ•°ç»„çš„ç»“æ„ã€‚å¤è€çš„ç±»ã€‚ä»jdk1.0çš„ç‰ˆæœ¬å°±æœ‰äº†ã€‚
    + çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ï¼Œåæ¥è¢«ArrayListæ›¿ä»£äº†ã€‚

> æ³¨æ„ï¼š  
> + å¦‚æœä¸€ä¸ªé›†åˆï¼Œç»å¤§å¤šæ•°çš„æ“ä½œå°±æ˜¯éå†æŸ¥è¯¢ï¼Œå»ºè®®é€‰æ‹©ArrayListã€‚  
> + å¦‚æœä¸€ä¸ªé›†åˆï¼Œé¢‘ç¹çš„æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œå»ºè®®é€‰æ‹©LinkedListã€‚  
> + å¦‚æœè¦æ¨¡æ‹Ÿæ ˆï¼Œé˜Ÿåˆ—ç­‰ç»“æ„ï¼Œå»ºè®®é€‰æ‹©LinkedListã€‚  
> +	ArrayListå’ŒLinkedListéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ•ˆç‡é«˜ã€‚Collectionså·¥å…·ç±»ï¼Œå¯ä»¥è·å–çº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚
> 

#### list set array äº’è½¬
https://www.jianshu.com/p/717bc27141c4
##### Listè½¬æ•°ç»„

+  toArray

  ```java
      public void test(List<String> list) {
          String[] arrays = list.toArray(new String[0]);
          System.out.println(Arrays.toString(arrays));
      }
  ```

##### æ•°ç»„è½¬List

+ Arrays.asList()

  ```java
  		public void test(String[] arrays) {
          List<String> stringList = Arrays.asList(array);
          System.out.println(stringList.toString());
      }
  ```

##### Setè½¬æ•°ç»„

+ Stream

  ```java
      private static void arrayToSet2() {
          String[] array = {"value1","value2","value3"};
          Set<String> set = Stream.of(array).collect(Collectors.toSet());
          System.out.println(set);
      }
  ```

##### Setè½¬List

+ new ArrayList<>(set)

  ```java
      //setä¸ºnullä¼šæŠ¥é”™
      private static void setToList(Set<String> set) {
          List<String> list=new ArrayList<>(set);
          System.out.println(list.toString());
      }
  ```
  
##### Listè½¬Set

+ new HashSet

  ```java
  	private static void listToSet(List<String> list) {
          Set<String> set=new HashSet<>(list);
          System.out.println(set.toString());
    }
  ```

  

#### 1.4.2.2 ç§»é™¤å…ƒç´ 

[listé›†åˆç§»é™¤æŒ‡å®šå…ƒç´ ](https://blog.csdn.net/shenxiaomo1688/article/details/91973077)

#### 1.4.2.3 å»é‡
1. å¾ªç¯listä¸­çš„æ‰€æœ‰å…ƒç´ ç„¶ååˆ é™¤é‡å¤
2. é€šè¿‡HashSetè¸¢é™¤é‡å¤å…ƒç´ 
3. æ–°å¢é›†åˆ, ä¸é‡å¤æ·»åŠ 
4. ç”¨list.contains()
5. ä½¿ç”¨`retainAll`è·å–äº¤é›†
6. Streamä¸­å¯¹Listè¿›è¡Œå»é‡ï¼šlist.stream().distinct();

[Javaä¸­Listé›†åˆå»é™¤é‡å¤æ•°æ®çš„å…­ç§æ–¹æ³•](https://www.cnblogs.com/zhaoyan001/p/11737961.html)

## 1.5 çº¿ç¨‹æ± 

### åŸç†

å‚è€ƒèµ„æ–™ 
+ [ç¾å›¢æŠ€æœ¯æ–‡æ¡£-çº¿ç¨‹æ± ](https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html)
+ [Javaå¸¸ç”¨çš„å‡ ç§çº¿ç¨‹æ± æ¯”è¾ƒ](https://www.cnblogs.com/aaron911/p/6213808.html)
#### ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± 
è¯¸å¦‚ Web æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨æˆ–é‚®ä»¶æœåŠ¡å™¨ä¹‹ç±»çš„è®¸å¤šæœåŠ¡å™¨åº”ç”¨ç¨‹åºéƒ½é¢å‘å¤„ç†æ¥è‡ªæŸäº›è¿œç¨‹æ¥æºçš„å¤§é‡çŸ­å°çš„ä»»åŠ¡ã€‚è¯·æ±‚ä»¥æŸç§æ–¹å¼åˆ°è¾¾æœåŠ¡å™¨ï¼Œè¿™ç§æ–¹å¼å¯èƒ½æ˜¯é€šè¿‡ç½‘ç»œåè®®ï¼ˆä¾‹å¦‚ HTTPã€FTP æˆ– POPï¼‰ã€é€šè¿‡ JMS é˜Ÿåˆ—æˆ–è€…å¯èƒ½é€šè¿‡è½®è¯¢æ•°æ®åº“ã€‚ä¸ç®¡è¯·æ±‚å¦‚ä½•åˆ°è¾¾ï¼ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­ç»å¸¸å‡ºç°çš„æƒ…å†µæ˜¯ï¼šå•ä¸ªä»»åŠ¡å¤„ç†çš„æ—¶é—´å¾ˆçŸ­è€Œè¯·æ±‚çš„æ•°ç›®å´æ˜¯å·¨å¤§çš„ã€‚  
æ„å»ºæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªç®€å•æ¨¡å‹æ˜¯ï¼šæ¯å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾å°±åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œç„¶ååœ¨æ–°çº¿ç¨‹ä¸­ä¸ºè¯·æ±‚æœåŠ¡ã€‚å®é™…ä¸Šå¯¹äºåŸå‹å¼€å‘è¿™ç§æ–¹æ³•å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†å¦‚æœè¯•å›¾éƒ¨ç½²ä»¥è¿™ç§æ–¹å¼è¿è¡Œçš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•çš„ä¸¥é‡ä¸è¶³å°±å¾ˆæ˜æ˜¾ã€‚æ¯ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼ˆthread-per-requestï¼‰æ–¹æ³•çš„ä¸è¶³ä¹‹ä¸€æ˜¯ï¼šä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼›ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°çº¿ç¨‹çš„æœåŠ¡å™¨åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸ŠèŠ±è´¹çš„æ—¶é—´å’Œæ¶ˆè€—çš„ç³»ç»Ÿèµ„æºè¦æ¯”èŠ±åœ¨å¤„ç†å®é™…çš„ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´å’Œèµ„æºæ›´å¤šã€‚  
é™¤äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ä¹‹å¤–ï¼Œæ´»åŠ¨çš„çº¿ç¨‹ä¹Ÿæ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚åœ¨ä¸€ä¸ª JVM é‡Œåˆ›å»ºå¤ªå¤šçš„çº¿ç¨‹å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿç”±äºè¿‡åº¦æ¶ˆè€—å†…å­˜è€Œç”¨å®Œå†…å­˜æˆ–â€œåˆ‡æ¢è¿‡åº¦â€ã€‚ä¸ºäº†é˜²æ­¢èµ„æºä¸è¶³ï¼ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºéœ€è¦ä¸€äº›åŠæ³•æ¥é™åˆ¶ä»»ä½•ç»™å®šæ—¶åˆ»å¤„ç†çš„è¯·æ±‚æ•°ç›®ã€‚  
çº¿ç¨‹æ± ä¸ºçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¼€é”€é—®é¢˜å’Œèµ„æºä¸è¶³é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å¯¹å¤šä¸ªä»»åŠ¡é‡ç”¨çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ›å»ºçš„å¼€é”€è¢«åˆ†æ‘Šåˆ°äº†å¤šä¸ªä»»åŠ¡ä¸Šã€‚å…¶å¥½å¤„æ˜¯ï¼Œå› ä¸ºåœ¨è¯·æ±‚åˆ°è¾¾æ—¶çº¿ç¨‹å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥æ— æ„ä¸­ä¹Ÿæ¶ˆé™¤äº†çº¿ç¨‹åˆ›å»ºæ‰€å¸¦æ¥çš„å»¶è¿Ÿã€‚è¿™æ ·ï¼Œå°±å¯ä»¥ç«‹å³ä¸ºè¯·æ±‚æœåŠ¡ï¼Œä½¿åº”ç”¨ç¨‹åºå“åº”æ›´å¿«ã€‚è€Œä¸”ï¼Œé€šè¿‡é€‚å½“åœ°è°ƒæ•´çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ï¼Œä¹Ÿå°±æ˜¯å½“è¯·æ±‚çš„æ•°ç›®è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå°±å¼ºåˆ¶å…¶å®ƒä»»ä½•æ–°åˆ°çš„è¯·æ±‚ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä¸ºæ­¢ï¼Œä»è€Œå¯ä»¥é˜²æ­¢èµ„æºä¸è¶³ã€‚  

#### ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©
1. æ­»é”  
ä»»ä½•å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºéƒ½æœ‰æ­»é”é£é™©ã€‚å½“ä¸€ç»„è¿›ç¨‹æˆ–çº¿ç¨‹ä¸­çš„æ¯ä¸€ä¸ªéƒ½åœ¨ç­‰å¾…ä¸€ä¸ªåªæœ‰è¯¥ç»„ä¸­å¦ä¸€ä¸ªè¿›ç¨‹æ‰èƒ½å¼•èµ·çš„äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬å°±è¯´è¿™ç»„è¿›ç¨‹æˆ–çº¿ç¨‹æ­»é”ã€‚  
æ­»é”çš„æœ€ç®€å•æƒ…å½¢æ˜¯ï¼šçº¿ç¨‹ A æŒæœ‰å¯¹è±¡ X çš„ç‹¬å é”ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…å¯¹è±¡ Y çš„é”ï¼Œè€Œçº¿ç¨‹ B æŒæœ‰å¯¹è±¡ Y çš„ç‹¬å é”ï¼Œå´åœ¨ç­‰å¾…å¯¹è±¡ X çš„é”ã€‚é™¤éæœ‰æŸç§æ–¹æ³•æ¥æ‰“ç ´å¯¹é”çš„ç­‰å¾…ï¼ˆJava é”å®šä¸æ”¯æŒè¿™ç§æ–¹æ³•ï¼‰ï¼Œå¦åˆ™æ­»é”çš„çº¿ç¨‹å°†æ°¸è¿œç­‰ä¸‹å»ã€‚  
è™½ç„¶ä»»ä½•å¤šçº¿ç¨‹ç¨‹åºä¸­éƒ½æœ‰æ­»é”çš„é£é™©ï¼Œä½†çº¿ç¨‹æ± å´å¼•å…¥äº†å¦ä¸€ç§æ­»é”å¯èƒ½ï¼Œåœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ± çº¿ç¨‹éƒ½åœ¨æ‰§è¡Œå·²é˜»å¡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å¦ä¸€ä»»åŠ¡çš„æ‰§è¡Œç»“æœçš„ä»»åŠ¡ï¼Œä½†è¿™ä¸€ä»»åŠ¡å´å› ä¸ºæ²¡æœ‰æœªè¢«å ç”¨çš„çº¿ç¨‹è€Œä¸èƒ½è¿è¡Œã€‚å½“çº¿ç¨‹æ± è¢«ç”¨æ¥å®ç°æ¶‰åŠè®¸å¤šäº¤äº’å¯¹è±¡çš„æ¨¡æ‹Ÿï¼Œè¢«æ¨¡æ‹Ÿçš„å¯¹è±¡å¯ä»¥ç›¸äº’å‘é€æŸ¥è¯¢ï¼Œè¿™äº›æŸ¥è¯¢æ¥ä¸‹æ¥ä½œä¸ºæ’é˜Ÿçš„ä»»åŠ¡æ‰§è¡Œï¼ŒæŸ¥è¯¢å¯¹è±¡åˆåŒæ­¥ç­‰å¾…ç€å“åº”æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚  
2. èµ„æºä¸è¶³   
çº¿ç¨‹æ± çš„ä¸€ä¸ªä¼˜ç‚¹åœ¨äºï¼šç›¸å¯¹äºå…¶å®ƒæ›¿ä»£è°ƒåº¦æœºåˆ¶è€Œè¨€ï¼Œå®ƒä»¬é€šå¸¸æ‰§è¡Œå¾—å¾ˆå¥½ã€‚ä½†åªæœ‰æ°å½“åœ°è°ƒæ•´äº†çº¿ç¨‹æ± å¤§å°æ—¶æ‰æ˜¯è¿™æ ·çš„ã€‚  
çº¿ç¨‹æ¶ˆè€—åŒ…æ‹¬å†…å­˜å’Œå…¶å®ƒç³»ç»Ÿèµ„æºåœ¨å†…çš„å¤§é‡èµ„æºã€‚é™¤äº† Thread å¯¹è±¡æ‰€éœ€çš„å†…å­˜ä¹‹å¤–ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ä¸¤ä¸ªå¯èƒ½å¾ˆå¤§çš„æ‰§è¡Œè°ƒç”¨å †æ ˆã€‚é™¤æ­¤ä»¥å¤–ï¼ŒJVM å¯èƒ½ä¼šä¸ºæ¯ä¸ª Java çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæœ¬æœºçº¿ç¨‹ï¼Œè¿™äº›æœ¬æœºçº¿ç¨‹å°†æ¶ˆè€—é¢å¤–çš„ç³»ç»Ÿèµ„æºã€‚æœ€åï¼Œè™½ç„¶çº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„è°ƒåº¦å¼€é”€å¾ˆå°ï¼Œä½†å¦‚æœæœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œç¯å¢ƒåˆ‡æ¢ä¹Ÿå¯èƒ½ä¸¥é‡åœ°å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚  
å¦‚æœçº¿ç¨‹æ± å¤ªå¤§ï¼Œé‚£ä¹ˆè¢«é‚£äº›çº¿ç¨‹æ¶ˆè€—çš„èµ„æºå¯èƒ½ä¸¥é‡åœ°å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢å°†ä¼šæµªè´¹æ—¶é—´ï¼Œè€Œä¸”ä½¿ç”¨è¶…å‡ºæ¯”æ‚¨å®é™…éœ€è¦çš„çº¿ç¨‹å¯èƒ½ä¼šå¼•èµ·èµ„æºåŒ®ä¹é—®é¢˜ï¼Œå› ä¸ºæ± çº¿ç¨‹æ­£åœ¨æ¶ˆè€—ä¸€äº›èµ„æºï¼Œè€Œè¿™äº›èµ„æºå¯èƒ½ä¼šè¢«å…¶å®ƒä»»åŠ¡æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ã€‚é™¤äº†çº¿ç¨‹è‡ªèº«æ‰€ä½¿ç”¨çš„èµ„æºä»¥å¤–ï¼ŒæœåŠ¡è¯·æ±‚æ—¶æ‰€åšçš„å·¥ä½œå¯èƒ½éœ€è¦å…¶å®ƒèµ„æºï¼Œä¾‹å¦‚ JDBC è¿æ¥ã€å¥—æ¥å­—æˆ–æ–‡ä»¶ã€‚è¿™äº›ä¹Ÿéƒ½æ˜¯æœ‰é™èµ„æºï¼Œæœ‰å¤ªå¤šçš„å¹¶å‘è¯·æ±‚ä¹Ÿå¯èƒ½å¼•èµ·å¤±æ•ˆï¼Œä¾‹å¦‚ä¸èƒ½åˆ†é… JDBC è¿æ¥ã€‚
3. å¹¶å‘é”™è¯¯  
çº¿ç¨‹æ± å’Œå…¶å®ƒæ’é˜Ÿæœºåˆ¶ä¾é ä½¿ç”¨ wait() å’Œ notify() æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½éš¾äºä½¿ç”¨ã€‚å¦‚æœç¼–ç ä¸æ­£ç¡®ï¼Œé‚£ä¹ˆå¯èƒ½ä¸¢å¤±é€šçŸ¥ï¼Œå¯¼è‡´çº¿ç¨‹ä¿æŒç©ºé—²çŠ¶æ€ï¼Œå°½ç®¡é˜Ÿåˆ—ä¸­æœ‰å·¥ä½œè¦å¤„ç†ã€‚ä½¿ç”¨è¿™äº›æ–¹æ³•æ—¶ï¼Œå¿…é¡»æ ¼å¤–å°å¿ƒã€‚è€Œæœ€å¥½ä½¿ç”¨ç°æœ‰çš„ã€å·²ç»çŸ¥é“èƒ½å·¥ä½œçš„å®ç°ï¼Œä¾‹å¦‚ util.concurrent åŒ…ã€‚
4. çº¿ç¨‹æ³„æ¼  
å½“ä»æ± ä¸­é™¤å»ä¸€ä¸ªçº¿ç¨‹ä»¥æ‰§è¡Œä¸€é¡¹ä»»åŠ¡ï¼Œè€Œåœ¨ä»»åŠ¡å®Œæˆåè¯¥çº¿ç¨‹å´æ²¡æœ‰è¿”å›æ± æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å‘ç”Ÿçº¿ç¨‹æ³„æ¼çš„ä¸€ç§æƒ…å½¢å‡ºç°åœ¨ä»»åŠ¡æŠ›å‡ºä¸€ä¸ª RuntimeException æˆ–ä¸€ä¸ª Error æ—¶ã€‚å¦‚æœæ± ç±»æ²¡æœ‰æ•æ‰åˆ°å®ƒä»¬ï¼Œé‚£ä¹ˆçº¿ç¨‹åªä¼šé€€å‡ºè€Œçº¿ç¨‹æ± çš„å¤§å°å°†ä¼šæ°¸ä¹…å‡å°‘ä¸€ä¸ªã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¬¡æ•°è¶³å¤Ÿå¤šæ—¶ï¼Œçº¿ç¨‹æ± æœ€ç»ˆå°±ä¸ºç©ºï¼Œè€Œä¸”ç³»ç»Ÿå°†åœæ­¢ï¼Œå› ä¸ºæ²¡æœ‰å¯ç”¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚  
æœ‰äº›ä»»åŠ¡å¯èƒ½ä¼šæ°¸è¿œç­‰å¾…æŸäº›èµ„æºæˆ–æ¥è‡ªç”¨æˆ·çš„è¾“å…¥ï¼Œè€Œè¿™äº›èµ„æºåˆä¸èƒ½ä¿è¯å˜å¾—å¯ç”¨ï¼Œç”¨æˆ·å¯èƒ½ä¹Ÿå·²ç»ç¦»çº¿äº†ï¼Œè¯¸å¦‚æ­¤ç±»çš„ä»»åŠ¡ä¼šæ°¸ä¹…åœæ­¢ï¼Œè€Œè¿™äº›åœæ­¢çš„ä»»åŠ¡ä¹Ÿä¼šå¼•èµ·å’Œçº¿ç¨‹æ³„æ¼åŒæ ·çš„é—®é¢˜ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹è¢«è¿™æ ·ä¸€ä¸ªä»»åŠ¡æ°¸ä¹…åœ°æ¶ˆè€—ç€ï¼Œé‚£ä¹ˆå®ƒå®é™…ä¸Šå°±è¢«ä»æ± é™¤å»äº†ã€‚å¯¹äºè¿™æ ·çš„ä»»åŠ¡ï¼Œåº”è¯¥è¦ä¹ˆåªç»™äºˆå®ƒä»¬è‡ªå·±çš„çº¿ç¨‹ï¼Œè¦ä¹ˆåªè®©å®ƒä»¬ç­‰å¾…æœ‰é™çš„æ—¶é—´ã€‚
5. è¯·æ±‚è¿‡è½½   
ä»…ä»…æ˜¯è¯·æ±‚å°±å‹å®äº†æœåŠ¡å™¨ï¼Œè¿™ç§æƒ…å†µæ˜¯å¯èƒ½çš„ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¸æƒ³å°†æ¯ä¸ªåˆ°æ¥çš„è¯·æ±‚éƒ½æ’é˜Ÿåˆ°æˆ‘ä»¬çš„å·¥ä½œé˜Ÿåˆ—ï¼Œå› ä¸ºæ’åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡å¯èƒ½ä¼šæ¶ˆè€—å¤ªå¤šçš„ç³»ç»Ÿèµ„æºå¹¶å¼•èµ·èµ„æºç¼ºä¹ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹å†³å®šå¦‚ä½•åšå–å†³äºæ‚¨è‡ªå·±ï¼›åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°æŠ›å¼ƒè¯·æ±‚ï¼Œä¾é æ›´é«˜çº§åˆ«çš„åè®®ç¨åé‡è¯•è¯·æ±‚ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªæŒ‡å‡ºæœåŠ¡å™¨æš‚æ—¶å¾ˆå¿™çš„å“åº”æ¥æ‹’ç»è¯·æ±‚ã€‚

#### çº¿ç¨‹æ± ç»„æˆ
ä¸€èˆ¬çš„çº¿ç¨‹æ± ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ 4 ä¸ªç»„æˆéƒ¨åˆ†ï¼š
1. çº¿ç¨‹æ± ç®¡ç†å™¨ï¼šç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ± 
2. å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹
3. ä»»åŠ¡æ¥å£ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥å£ï¼Œç”¨äºå·¥ä½œçº¿ç¨‹è°ƒåº¦å…¶è¿è¡Œ
4. ä»»åŠ¡é˜Ÿåˆ—ï¼šç”¨äºå­˜æ”¾å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæä¾›ä¸€ç§ç¼“å†²æœºåˆ¶  

Java ä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡ Executor æ¡†æ¶å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº† Executorï¼ŒExecutorsï¼ŒExecutorServiceï¼ŒThreadPoolExecutor ï¼ŒCallable å’Œ Futureã€FutureTask è¿™å‡ ä¸ªç±»ã€‚  
ThreadPoolExecutor çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š

```java
public ThreadPoolExecutor(int corePoolSize,
                          int maximumPoolSize,
                          long keepAliveTime,
                          TimeUnit unit,
                          BlockingQueue<Runnable> workQueue) {
        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,
             Executors.defaultThreadFactory(), defaultHandler);
    }
```
1. corePoolSizeï¼šæŒ‡å®šäº†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ã€‚
2. maximumPoolSizeï¼šæŒ‡å®šäº†çº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚
3. keepAliveTimeï¼šå½“å‰çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œå³å¤šæ¬¡æ—¶é—´å†…ä¼šè¢«é”€æ¯ã€‚
4. unitï¼škeepAliveTime çš„å•ä½ã€‚
5. workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚
6. threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬ç”¨é»˜è®¤çš„å³å¯ã€‚
7. handlerï¼šæ‹’ç»ç­–ç•¥ï¼Œå½“ä»»åŠ¡å¤ªå¤šæ¥ä¸åŠå¤„ç†ï¼Œå¦‚ä½•æ‹’ç»ä»»åŠ¡ã€‚

#### Java çº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹
1. çº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œé‡Œé¢æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä½œä¸ºå‚æ•°ä¼ è¿›æ¥çš„ã€‚ä¸è¿‡ï¼Œå°±ç®—é˜Ÿåˆ—é‡Œé¢æœ‰ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¹Ÿä¸ä¼šé©¬ä¸Šæ‰§è¡Œå®ƒä»¬ã€‚
2. å½“è°ƒç”¨ execute() æ–¹æ³•æ·»åŠ ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ï¼š  
    a) å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº corePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›  
    b) å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº corePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›  
    c) å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº maxiumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›  
    d) å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡ç­‰äº maxiumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæŠ›å‡ºå¼‚å¸¸ RejectExecutionExceptionã€‚  
3. å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚
4. å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšï¼Œè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº corePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° corePoolSize çš„å¤§å°ã€‚

#### æ‹’ç»ç­–ç•¥  

çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å·²ç»ç”¨å®Œäº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡ï¼ŒåŒæ—¶ï¼Œç­‰å¾…é˜Ÿåˆ—ä¹Ÿå·²ç»æ’æ»¡äº†ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚JDK å†…ç½®çš„æ‹’ç»ç­–ç•¥å¦‚ä¸‹ï¼š

+ AbortPolicy ï¼š ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚
+ CallerRunsPolicy ï¼š åªè¦çº¿ç¨‹æ± æœªå…³é—­ï¼Œè¯¥ç­–ç•¥ç›´æ¥åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­ï¼Œè¿è¡Œå½“å‰è¢«ä¸¢å¼ƒçš„ä»»åŠ¡ã€‚æ˜¾ç„¶è¿™æ ·åšä¸ä¼šçœŸçš„ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ï¼Œä»»åŠ¡æäº¤çº¿ç¨‹çš„æ€§èƒ½ææœ‰å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚
+ DiscardOldestPolicy ï¼š ä¸¢å¼ƒæœ€è€çš„ä¸€ä¸ªè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å³å°†è¢«æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚
+ DiscardPolicy ï¼š è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§æ–¹æ¡ˆã€‚

ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº† RejectedExecutionHandler æ¥å£ï¼Œè‹¥ä»¥ä¸Šç­–ç•¥ä»æ— æ³•æ»¡è¶³å®é™…éœ€è¦ï¼Œå®Œå…¨å¯ä»¥è‡ªå·±æ‰©å±• RejectedExecutionHandler æ¥å£ã€‚

### SpringBoot å®ç°

#### çº¿ç¨‹æ± æ„é€ æ–¹æ³•

```java
ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
// æœ€å¤§åŒæ—¶æ‰§è¡Œ20ä¸ª, ç¼“å­˜200ä¸ª, å¤šä½™åˆ™é˜»å¡çº¿ç¨‹
executor.setCorePoolSize(coreSize);
executor.setMaxPoolSize(maxSize);
executor.setQueueCapacity(queueCapacity);
executor.setKeepAliveSeconds(keepAlive);
executor.setThreadNamePrefix(threadNamePrefix);
executor.setRejectedExecutionHandler(rejectedExecutionHandlerC);
executor.setWaitForTasksToCompleteOnShutdown(awaitTermination);
executor.setAwaitTerminationSeconds(awaitTerminationPeriod);
return executor;
```

+ setCorePoolSizeï¼šæŒ‡å®šäº†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ã€‚

+ setMaxPoolSizeï¼šæŒ‡å®šäº†çº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚æ³¨æ„, core-size ä¸èƒ½å¤§äº max-size, å¦åˆ™ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸

+ setQueueCapacity: ç”¨æ¥ç¼“å†²æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—æœ€å¤§æ•°é‡, è¶…è¿‡æ‰§è¡Œæ‹’ç»ç­–ç•¥

+ setKeepAliveSecondsï¼šå½“å‰çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œæ—¶é—´å†…ä¼šè¢«é”€æ¯ã€‚

+ setThreadNamePrefix: çº¿ç¨‹æ± åçš„å‰ç¼€, è®¾ç½®å¥½äº†ä¹‹åå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å®šä½å¤„ç†ä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹æ± 

+ setRejectedExecutionHandler: æ‹’ç»ç­–ç•¥

+ setWaitForTasksToCompleteOnShutdown: è®¾ç½®çº¿ç¨‹æ± å…³é—­çš„æ—¶å€™ç­‰å¾…æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆå†ç»§ç»­é”€æ¯å…¶ä»–çš„Bean, é¿å…åº”ç”¨å…³é—­å¯¼è‡´çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ‰§è¡Œå¤±è´¥

+ setAwaitTerminationSeconds: è®¾ç½®çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰é”€æ¯å°±å¼ºåˆ¶é”€æ¯ï¼Œä»¥ç¡®ä¿åº”ç”¨æœ€åèƒ½å¤Ÿè¢«å…³é—­ï¼Œè€Œä¸æ˜¯é˜»å¡ä½

  > Set the maximum number of seconds that this executor is supposed to block on shutdown in order to wait for remaining tasks to complete their execution before the rest of the container continues to shut down. This is particularly useful if your remaining tasks are likely to need access to other resources that are also managed by the container.
  > By default, this executor won't wait for the termination of tasks at all. It will either shut down immediately, interrupting ongoing tasks and clearing the remaining task queue - or, if the "waitForTasksToCompleteOnShutdown" flag has been set to true, it will continue to fully execute all ongoing tasks as well as all remaining tasks in the queue, in parallel to the rest of the container shutting down.
  > In either case, if you specify an await-termination period using this property, this executor will wait for the given time (max) for the termination of tasks. As a rule of thumb, specify a significantly higher timeout here if you set "waitForTasksToCompleteOnShutdown" to true at the same time, since all remaining tasks in the queue will still get executed - in contrast to the default shutdown behavior where it's just about waiting for currently executing tasks that aren't reacting to thread interruption.

#### å¼‚æ­¥çº¿ç¨‹æ± è°ƒç”¨ @Async

https://zhuanlan.zhihu.com/p/532827958

https://juejin.cn/post/6976893903223914527

 https://blog.csdn.net/YoungLee16/article/details/88398045

+ åœ¨@SpringBootApplicationå¯åŠ¨ç±»å½“ä¸­æ·»åŠ æ³¨è§£@EnableAsyncæ³¨è§£ã€‚
+ å¼‚æ­¥æ–¹æ³•ä½¿ç”¨æ³¨è§£@[Async](https://so.csdn.net/so/search?q=Async&spm=1001.2101.3001.7020)çš„è¿”å›å€¼åªèƒ½ä¸ºvoidæˆ–è€…Futureã€‚
+ éœ€è¦èµ°Springçš„ä»£ç†ç±»ã€‚å› ä¸º@Transactionalå’Œ@Asyncæ³¨è§£çš„å®ç°éƒ½æ˜¯åŸºäºSpringçš„AOPï¼Œè€ŒAOPçš„å®ç°æ˜¯åŸºäºåŠ¨æ€ä»£ç†æ¨¡å¼å®ç°çš„ã€‚é‚£ä¹ˆæ³¨è§£å¤±æ•ˆçš„åŸå› å°±å¾ˆæ˜æ˜¾äº†ï¼Œæœ‰å¯èƒ½å› ä¸ºè°ƒç”¨æ–¹æ³•çš„æ˜¯å¯¹è±¡æœ¬èº«è€Œä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡Springå®¹å™¨ã€‚

#### çº¿ç¨‹æ± ä¸šåŠ¡éš”ç¦», çŠ¶æ€ç›‘æ§ä¸çŠ¶æ€è°ƒä¼˜

##### ä¸šåŠ¡éš”ç¦»

https://www.jianshu.com/p/6f6e2bcb8128

åœ¨ä¸åŒçš„ä¸šåŠ¡æ–¹æ³•ä¸­å›½å‘¢ä½¿ç”¨@Asyncæ³¨è§£ä¼ å…¥ä¸åŒçš„å®ä¾‹nameæ¥ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± å®ä¾‹

##### çŠ¶æ€ç›‘æ§

ThreadPoolExecutoræä¾›äº†beforeExecute, afterExecute ç­‰é’©å­æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯ä»¥åœ¨é’©å­æ–¹æ³•ä¸­å¯¹çº¿ç¨‹æ± ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸ŠæŠ¥CAT,ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š



```dart
    @Override
    protected void beforeExecute(Thread t, Runnable r) {
        String threadName = Thread.currentThread().getName();
        Transaction transaction = Cat.newTransaction(threadPoolName, runnableNameMap.get(r.getClass().getSimpleName()));
        transactionMap.put(threadName, transaction);
        super.beforeExecute(t, r);
    }

    @Override
    protected void afterExecute(Runnable r, Throwable t) {
        super.afterExecute(r, t);
        String threadName = Thread.currentThread().getName();
        Transaction transaction = transactionMap.get(threadName);
        transaction.setStatus(Message.SUCCESS);
        if (t != null) {
            Cat.logError(t);
            transaction.setStatus(t);
        }
        transaction.complete();
        transactionMap.remove(threadName);
    }
```

é€šè¿‡ä½¿ç”¨CATçš„StatusExtensionï¼Œå¯ä»¥å®šæ—¶å°†çº¿ç¨‹æ± çš„è¿è¡Œæ—¶çŠ¶æ€æ•°æ®å‘é€åˆ°CATå¹¶ç”ŸæˆæŸ±çŠ¶å›¾ï¼Œç›¸å…³å®ç°ä»£ç å¦‚ä¸‹ï¼š



```dart
    public StatusExtension registerStatusExtension(ThreadPoolProperties prop, Object object) {
        NaughtyThreadPoolTaskExecutor executor = (NaughtyThreadPoolTaskExecutor) object;
        StatusExtension statusExtension =  new StatusExtension() {
            @Override
            public String getId() {
                return "thread.pool.info." + prop.getThreadPoolName();
            }

            @Override
            public String getDescription() {
                return "çº¿ç¨‹æ± ç›‘æ§";
            }

            @Override
            public Map<String, String> getProperties() {
                AtomicLong rejectCount = getRejectCount(prop.getThreadPoolName());

                Map<String, String> pool = new HashMap<>();
              pool.put("activeCount", String.valueOf(executor.getActiveCount()));
                    pool.put("keepAliveTime", String.valueOf(executor.getKeepAliveSeconds()));
                    int coreSize = executor.getCorePoolSize();
                    int maxSize = executor.getMaxPoolSize();
                    if (coreSize!=0){
                        pool.put("active/core", String.valueOf(Float.valueOf(executor.getActiveCount())/Float.valueOf(coreSize)));
                    }
                    if (maxSize!=0){
                        pool.put("active/max", String.valueOf(Float.valueOf(executor.getActiveCount())/Float.valueOf(maxSize)));
                    }
                    pool.put("coreSize", String.valueOf(executor.getCorePoolSize()));
                    pool.put("maxSize", String.valueOf(executor.getMaxPoolSize()));
                    ThreadPoolExecutor threadPoolExecutor = executor.getThreadPoolExecutor();
                    pool.put("completedTaskCount", String.valueOf(threadPoolExecutor.getCompletedTaskCount()));
                    pool.put("largestPoolSize", String.valueOf(threadPoolExecutor.getLargestPoolSize()));
                    pool.put("taskCount", String.valueOf(threadPoolExecutor.getTaskCount()));
                    pool.put("rejectCount", String.valueOf(rejectCount == null ? 0 : rejectCount.get()));
                    pool.put("queueSize", String.valueOf(threadPoolExecutor.getQueue().size()));
                return pool;
            }
        };
        StatusExtensionRegister.getInstance().register(statusExtension);
        return statusExtension;
    }
```

å„é¡¹ç›‘æ§æŒ‡æ ‡çš„è¯´æ˜å¦‚ä¸‹ï¼šï¼ˆä»¥ä¸‹éƒ¨åˆ†è§‚ç‚¹å¯èƒ½éœ€è¦ç»è¿‡è¿›ä¸€æ­¥çš„éªŒè¯ï¼Œä»…ä¾›å¤§å®¶å‚è€ƒï¼‰

- active/coreSize ï¼šæ´»åŠ¨çº¿ç¨‹æ•°å’Œæ ¸å¿ƒçº¿ç¨‹æ•°çš„æ¯”å€¼ï¼Œ å…¶ä¸­active = executor.getActiveCount()ï¼Œè¡¨ç¤ºæ‰€æœ‰è¿è¡Œä¸­çš„å·¥ä½œçº¿ç¨‹çš„æ•°é‡ï¼Œè¿™ä¸ªæ¯”å€¼ååº”çº¿ç¨‹æ± çš„çº¿ç¨‹æ´»è·ƒçŠ¶æ€ï¼Œå¦‚æœä¸€ç›´ç»´æŒåœ¨ä¸€ä¸ªå¾ˆä½çš„æ°´å¹³ï¼Œåˆ™è¯´æ˜çº¿ç¨‹æ± éœ€è¦è¿›è¡Œç¼©å®¹ï¼›å¦‚æœé•¿æ—¶é—´ç»´æŒä¸€ä¸ªå¾ˆå¤§çš„æ•°å€¼ï¼Œè¯´æ˜æ´»è·ƒåº¦å¥½ï¼Œçº¿ç¨‹æ± åˆ©ç”¨ç‡é«˜ã€‚
- active/maxSize ï¼šæ´»åŠ¨çº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°çš„æ¯”å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥é…åˆä¸Šé¢çš„ active/coreSize æ¥çœ‹ï¼Œå½“active/coreSizeå¤§äº100%çš„æ—¶å€™ï¼Œå¦‚æœactive/maxSizeç»´æŒåœ¨ä¸€ä¸ªè¾ƒä½çš„å€¼ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹æ± çš„è´Ÿè½½åä½ï¼Œå¦‚æœå¤§äº60%æˆ–è€…æ›´é«˜ï¼Œåˆ™è¯´æ˜çº¿ç¨‹æ± è¿‡è½½ï¼Œéœ€è¦åŠæ—¶è°ƒæ•´çº¿ç¨‹æ± å®¹é‡é…ç½®ã€‚
- completedTaskCountï¼šæ‰§è¡Œå®Œæ¯•çš„å·¥ä½œçº¿ç¨‹çš„æ€»æ•°ï¼ŒåŒ…å«å†å²æ‰€æœ‰ã€‚
- largestPoolSizeï¼šå†å²ä¸Šçº¿ç¨‹æ± å®¹é‡è§¦è¾¾è¿‡çš„æœ€å¤§å€¼
- rejectCountï¼šè¢«æ‹’ç»çš„çº¿ç¨‹çš„æ•°é‡ï¼Œå¦‚æœå¤§é‡çº¿ç¨‹è¢«æ‹’ç»ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹æ± å·²ç»æº¢å‡ºäº†ï¼Œéœ€è¦åŠæ—¶è°ƒæ•´çº¿ç¨‹æ± é…ç½®
- queueSizeï¼šé˜Ÿåˆ—ä¸­å·¥ä½œçº¿ç¨‹çš„æ•°é‡ï¼Œå¦‚æœå¤§é‡çš„çº¿ç¨‹æ± åœ¨æ’é˜Ÿï¼Œè¯´æ˜coreSizeå·²ç»ä¸å¤Ÿç”¨äº†ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥è°ƒæ•´ï¼Œå¯¹äºæ‰§è¡Œæ—¶é—´è¦æ±‚å¾ˆä¸¥æ ¼çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯èƒ½éœ€è¦é€šè¿‡æå‡coreSizeæ¥å‡å°‘æ’é˜Ÿæƒ…å†µã€‚

#### ç»“æŸåå‘å¸ƒäº‹ä»¶, æ¯”å¦‚é€šçŸ¥

#### 1. åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ ThreadPoolExecutor, é‡å†™ afterExecute()

```
// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ ThreadPoolExecutor
                ThreadPoolExecutor executor = new ThreadPoolExecutor(
                        this.getCorePoolSize(),
                        this.getMaxPoolSize(),
                        this.getKeepAliveSeconds(),
                        TimeUnit.SECONDS,
                        this.getQueueCapacity() == 0 ? new SynchronousQueue<>() : new LinkedBlockingQueue<>(this.getQueueCapacity()),
                        threadFactory,
                        rejectedExecutionHandler
                ) {
                    @Override
                    protected void afterExecute(Runnable r, Throwable t) {
                        super.afterExecute(r, t);
                        if (t == null && r instanceof Future<?>) {
                            try {
                                Object result = ((Future<?>) r).get();
                                System.out.println("ä»»åŠ¡å®Œæˆï¼Œç»“æœ: " + result);
                            } catch (CancellationException ce) {
                                System.out.println("ä»»åŠ¡è¢«å–æ¶ˆ");
                            } catch (ExecutionException ee) {
                                System.out.println("ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸: " + ee.getCause());
                            } catch (InterruptedException ie) {
                                Thread.currentThread().interrupt();
                            }
                        } else if (t != null) {
                            System.out.println("ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸: " + t.getMessage());
                        }
                    }
                };

                return executor;
```



##### 2.ä½¿ç”¨ `CompletableFuture`ï¼ˆæ¨èï¼‰

```
@Async
public CompletableFuture<String> doWork() throws InterruptedException {
    Thread.sleep(2000);
    return CompletableFuture.completedFuture("ä»»åŠ¡å®Œæˆ");
}
```

è°ƒç”¨æ—¶ï¼š

```
asyncService.doWork().thenAccept(result -> {
    System.out.println("æ”¶åˆ°é€šçŸ¥: " + result);
});
```

âœ… ä¼˜ç‚¹ï¼šçœŸæ­£å¼‚æ­¥å›è°ƒï¼Œä»»åŠ¡ç»“æŸåè‡ªåŠ¨é€šçŸ¥ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ã€‚

------

##### 3. ç»Ÿä¸€ç›‘å¬ï¼šè‡ªå®šä¹‰ AsyncUncaughtExceptionHandler

å¦‚æœä½ çš„ `@Async` æ–¹æ³•æ˜¯ `void` è¿”å›ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç»Ÿä¸€å¤„ç†å¼‚å¸¸æˆ–å®Œæˆé€šçŸ¥ï¼š

```
@Configuration
@EnableAsync
public class AsyncConfig implements AsyncConfigurer {
    @Override
    public Executor getAsyncExecutor() {
        return Executors.newFixedThreadPool(5);
    }

    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return (ex, method, params) -> {
            System.out.println("å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸: " + ex.getMessage());
        };
    }
}
```

å¦‚æœè¦â€œé€šçŸ¥â€ï¼Œå¯ä»¥åœ¨ `afterExecute` é‡Œæ‰©å±•ï¼ˆç±»ä¼¼æˆ‘ä¹‹å‰è®²çš„è‡ªå®šä¹‰ `ThreadPoolExecutor`ï¼‰ã€‚

------

##### 4. äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼ˆæ¨èï¼‰

Spring æœ¬èº«å°±æ”¯æŒ **äº‹ä»¶æœºåˆ¶**ï¼ˆ`ApplicationEventPublisher` + `@EventListener`ï¼‰ï¼Œä½ å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆæ—¶å‘å¸ƒäº‹ä»¶ï¼Œè®¢é˜…è€…è‡ªåŠ¨æ”¶åˆ°é€šçŸ¥ã€‚

ç¤ºä¾‹ï¼š

```
// å®šä¹‰äº‹ä»¶
public class TaskCompletedEvent extends ApplicationEvent {
    private final String result;
    public TaskCompletedEvent(Object source, String result) {
        super(source);
        this.result = result;
    }
    public String getResult() { return result; }
}

// åœ¨å¼‚æ­¥æ–¹æ³•é‡Œå‘å¸ƒäº‹ä»¶
@Service
public class AsyncService {
    @Autowired
    private ApplicationEventPublisher publisher;

    @Async
    public void doWork() throws InterruptedException {
        Thread.sleep(2000);
        publisher.publishEvent(new TaskCompletedEvent(this, "ä»»åŠ¡å®Œæˆ"));
    }
}

// ç›‘å¬äº‹ä»¶
@Component
public class TaskCompletedListener {
    @EventListener
    public void onTaskCompleted(TaskCompletedEvent event) {
        System.out.println("æ”¶åˆ°é€šçŸ¥: " + event.getResult());
    }
}
```

âœ… ä¼˜ç‚¹ï¼šè§£è€¦ï¼Œä»»åŠ¡ç»“æŸåé€šçŸ¥é€»è¾‘ä¸ç”¨å†™åœ¨ä»»åŠ¡é‡Œã€‚
 âœ… é€‚åˆâ€œä»»åŠ¡ â†’ æ¶ˆæ¯æ€»çº¿ â†’ å¤šä¸ªè®¢é˜…è€…â€åœºæ™¯ã€‚

------

##### 5. æ€»ç»“å¯¹æ¯”

- **è¿”å› `CompletableFuture`** â†’ æœ€æ–¹ä¾¿çš„å¼‚æ­¥å›è°ƒï¼Œæ¨èã€‚
- **äº‹ä»¶æœºåˆ¶** â†’ è§£è€¦ï¼Œæ¨èåœ¨ Spring ä½“ç³»é‡Œä½¿ç”¨ã€‚
- **AsyncConfigurer.afterExecute** â†’ é€‚åˆç»Ÿä¸€ç›‘æ§ï¼Œé€‚åˆå…¨å±€æ‹¦æˆªã€‚

### JDK å®ç°

##### è°ƒç”¨é»˜è®¤æ„é€ å™¨(cache, fixed, single, schedule)

https://blog.51cto.com/u_15736848/5540003

1. newCachedThreadPool  

   ![Javaä½¿ç”¨ Executors åˆ›å»ºå››ç§çº¿ç¨‹æ± åŸç†_é˜»å¡é˜Ÿåˆ—_03](https://s2.51cto.com/images/blog/202208/03095144_62e9d4b0c753f33120.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184)

   åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚  
   ç‰¹ç‚¹ï¼š  

     + å·¥ä½œçº¿ç¨‹çš„åˆ›å»ºæ•°é‡å‡ ä¹æ²¡æœ‰é™åˆ¶(å…¶å®ä¹Ÿæœ‰é™åˆ¶çš„,æ•°ç›®ä¸ºInterger. MAX_VALUE), è¿™æ ·å¯çµæ´»çš„å¾€çº¿ç¨‹æ± ä¸­æ·»åŠ çº¿ç¨‹ã€‚åœ¨ä½¿ç”¨CachedThreadPoolæ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶ä»»åŠ¡çš„æ•°é‡ï¼Œå¦åˆ™ï¼Œç”±äºå¤§é‡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¾ˆæœ‰ä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚
     + å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¾€çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡ï¼Œå³å¦‚æœå·¥ä½œçº¿ç¨‹ç©ºé—²äº†æŒ‡å®šçš„æ—¶é—´(é»˜è®¤ä¸º1åˆ†é’Ÿ)ï¼Œåˆ™è¯¥å·¥ä½œçº¿ç¨‹å°†è‡ªåŠ¨ç»ˆæ­¢ã€‚ç»ˆæ­¢åï¼Œå¦‚æœä½ åˆæäº¤äº†æ–°çš„ä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹æ± é‡æ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚  

2. newFixedThreadPool  

   ![Javaä½¿ç”¨ Executors åˆ›å»ºå››ç§çº¿ç¨‹æ± åŸç†_é˜Ÿåˆ—](https://s2.51cto.com/images/blog/202208/03095144_62e9d4b04bbb016743.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184)

   åˆ›å»ºä¸€ä¸ªæŒ‡å®šå·¥ä½œçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚æ¯å½“æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°é‡è¾¾åˆ°çº¿ç¨‹æ± åˆå§‹çš„æœ€å¤§æ•°ï¼Œåˆ™å°†æäº¤çš„ä»»åŠ¡å­˜å…¥åˆ°æ± é˜Ÿåˆ—ä¸­ã€‚FixedThreadPoolæ˜¯ä¸€ä¸ªå…¸å‹ä¸”ä¼˜ç§€çš„çº¿ç¨‹æ± ï¼Œå®ƒå…·æœ‰çº¿ç¨‹æ± æé«˜ç¨‹åºæ•ˆç‡å’ŒèŠ‚çœåˆ›å»ºçº¿ç¨‹æ—¶æ‰€è€—çš„å¼€é”€çš„ä¼˜ç‚¹ã€‚  
   ç‰¹ç‚¹: 

    + å·¥ä½œçº¿ç¨‹æ•°é‡æŒ‡å®š
    + ä½†æ˜¯ï¼Œåœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚

3. newSingleThreadExecutor  

   ![Javaä½¿ç”¨ Executors åˆ›å»ºå››ç§çº¿ç¨‹æ± åŸç†_é˜»å¡é˜Ÿåˆ—_02](https://s2.51cto.com/images/blog/202208/03095144_62e9d4b092a9b62048.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184)

   åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„Executorï¼Œå³åªåˆ›å»ºå”¯ä¸€çš„å·¥ä½œè€…çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹å¼‚å¸¸ç»“æŸï¼Œä¼šæœ‰å¦ä¸€ä¸ªå–ä»£å®ƒï¼Œä¿è¯é¡ºåºæ‰§è¡Œã€‚å•å·¥ä½œçº¿ç¨‹æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ä»»æ„ç»™å®šçš„æ—¶é—´ä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚ 
   ç‰¹ç‚¹: 

    + ç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡, å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡
    + å ç”¨å°, ä½†æ˜¯æ‰§è¡Œæ•ˆç‡ä½

4. newScheduleThreadPool  

   ![Javaä½¿ç”¨ Executors åˆ›å»ºå››ç§çº¿ç¨‹æ± åŸç†_é˜»å¡é˜Ÿåˆ—_03](https://s2.51cto.com/images/blog/202208/03095144_62e9d4b0c753f33120.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184)

   åˆ›å»ºä¸€ä¸ªå®šé•¿çš„çº¿ç¨‹æ± ï¼Œè€Œä¸”æ”¯æŒå®šæ—¶çš„ä»¥åŠå‘¨æœŸæ€§çš„ä»»åŠ¡æ‰§è¡Œï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ 
   ç‰¹ç‚¹: 

    + å·¥ä½œçº¿ç¨‹æ•°é‡æŒ‡å®š
    + æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ, åº”å°½é‡é¿å…ä½¿ç”¨

   > newScheduleThreadPoolè¯¦è§£: http://www.ideabuffer.cn/2017/04/14/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9AScheduledThreadPoolExecutor/

#### çº¿ç¨‹æ± é˜»å¡é˜Ÿåˆ—

+ ArrayBlockingQueue

  æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯çº¿ç¨‹å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ï¼Œå³å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆè¢«é˜»å¡åœ¨å¤–é¢çš„çº¿ç¨‹å¯¹é˜Ÿåˆ—è®¿é—®çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å…¬å¹³ï¼ˆå³å…ˆé˜»å¡ï¼Œå…ˆæ’å…¥ï¼‰çš„ã€‚

+ LinkedBlockingQueue

  ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆå‡ºå…ˆè¿›çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åº

+ DelayQueue

  æ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå³å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ 

+ SynchronousQueue

  ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸€ä¸ªputå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚å¹¶ä¸”ä»–æ”¯æŒå…¬å¹³è®¿é—®é˜Ÿåˆ—ã€‚

+ PriorityBlockingQueue

  æ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—

+ LinkedTransferQueue

  ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚

+ LinkedBlockingDeque

  é“¾è¡¨ç»“æ„çš„åŒå‘é˜»å¡é˜Ÿåˆ—ï¼Œä¼˜åŠ¿åœ¨äºå¤šçº¿ç¨‹å…¥é˜Ÿæ—¶ï¼Œå‡å°‘ä¸€åŠçš„ç«äº‰ã€‚

### Tomcat, WSGI, ASGI, çº¿ç¨‹æ± çš„å…³ç³»

#### Tomcat çš„åŸºæœ¬å¹¶å‘æ¨¡å‹

- Tomcat æ˜¯ä¸€ä¸ª **Java Servlet å®¹å™¨**ã€‚
- åœ¨å®ƒçš„çº¿ç¨‹æ± ï¼ˆé€šå¸¸æ˜¯ **çº¿ç¨‹æ±  Executor**ï¼‰é‡Œï¼Œ**æ¯ä¸ª HTTP è¯·æ±‚ä¼šåˆ†é…ä¸€ä¸ªçº¿ç¨‹** æ¥å¤„ç†ã€‚
- è¿™ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œä½ çš„ Servlet / Spring Controller é‡Œçš„é€»è¾‘ï¼Œç„¶åè¿”å›å“åº”ã€‚

æ¢å¥è¯è¯´ï¼š

- **è¯·æ±‚çº§åˆ«çº¿ç¨‹** = è´Ÿè´£è¯¥è¯·æ±‚çš„ä¸»å¤„ç†é€»è¾‘ã€‚
- çº¿ç¨‹æ± çš„å¤§å°å†³å®šäº†åŒæ—¶èƒ½å¹¶å‘å¤„ç†å¤šå°‘è¯·æ±‚ã€‚

> å¤šçº¿ç¨‹+å¼‚æ­¥
>
> + ä½¿ç”¨ asgi => æä¾›å¹¶å‘
> + å£°æ˜çº¿ç¨‹æ± 
> + @Async



#### WSGI + uvicore

WSGIï¼ˆFlaskï¼‰çº¿ç¨‹å¹¶å‘ï¼šè¯·æ±‚é˜»å¡çº¿ç¨‹

```
# app_flask.py
from flask import Flask
import time

app = Flask(__name__)

@app.route("/io")
def io_block():
    time.sleep(5)           # é˜»å¡5ç§’ï¼šçº¿ç¨‹è¢«å ä½
    return "done"
```

è¿è¡Œï¼ˆ4ä¸ªworkerï¼Œæ¯ä¸ª1çº¿ç¨‹ï¼‰ï¼š

```
gunicorn app_flask:app -w 4 --threads 1
```

åŒæ—¶æ¥10ä¸ªè¯·æ±‚ï¼šæœ€å¤šåªæœ‰4ä¸ªè¯·æ±‚åœ¨â€œå¹²æ´»â€ï¼Œå…¶ä½™æ’é˜Ÿã€‚

#### 2) ASGIï¼ˆFastAPIï¼‰åç¨‹å¹¶å‘ï¼šç­‰å¾…ä¸å çº¿ç¨‹

```
# app_fastapi_io.py
from fastapi import FastAPI
import asyncio

app = FastAPI()

@app.get("/io")
async def io_nonblocking():
    await asyncio.sleep(5)  # éé˜»å¡ç­‰å¾…ï¼šçº¿ç¨‹å¯å»å¤„ç†åˆ«çš„è¯·æ±‚
    return {"ok": True}
```

è¿è¡Œï¼ˆ1ä¸ªworkerä¹Ÿè¡Œï¼‰ï¼š

```
uvicorn app_fastapi_io:app --workers 1
```

åŒæ—¶æ¥10ä¸ªè¯·æ±‚ï¼š**5ç§’åå‡ ä¹ä¸€èµ·è¿”å›**ï¼Œå› ä¸ºç­‰å¾…æœŸé—´æ²¡æœ‰å ä½çº¿ç¨‹ã€‚

> æ³¨æ„ï¼š
>
> + ASGIæƒ³è¦â€œé«˜å¹¶å‘â€ï¼Œä½ ç”¨çš„åº“ä¹Ÿè¦éé˜»å¡ï¼ˆå¦‚ `httpx.AsyncClient`ã€`asyncpg` ç­‰ï¼‰ã€‚å¦‚æœç”¨é˜»å¡åº“ï¼Œä»ä¼šå¡çº¿ç¨‹ï¼Œéœ€è¦ `run_in_executor()` æˆ–æ¢å¼‚æ­¥é©±åŠ¨ã€‚
>
> + ç”¨ **ä¿¡å·é‡ (Semaphore)**æ§åˆ¶å¹¶å‘
>
>   + âœ… æ–¹æ¡ˆ 1ï¼šå…¨å±€ä¸­é—´ä»¶é™å¹¶å‘
>
>   > from fastapi import FastAPI, Request
>   > import asyncio
>   >
>   > app = FastAPI()
>   > sem = asyncio.Semaphore(5)  # å…¨å±€é™å¹¶å‘æ•°
>   >
>   > @app.middleware("http")
>   > async def limit_concurrency(request: Request, call_next):
>   >     async with sem:
>   >         response = await call_next(request)
>   >         return response
>   >
>   > @app.get("/a")
>   > async def a():
>   >     await asyncio.sleep(3)
>   >     return {"route": "a"}
>   >
>   > @app.get("/b")
>   > async def b():
>   >     await asyncio.sleep(3)
>   >     return {"route": "b"}
>
>   + âœ… æ–¹æ¡ˆ 2ï¼šä¾èµ–æ³¨å…¥ï¼ˆæ¯ç»„è·¯ç”±å¯è‡ªå®šä¹‰é™æµå™¨ï¼‰
>
>     ```
>     from fastapi import FastAPI, Depends
>     import asyncio
>                             
>     app = FastAPI()
>                             
>     class ConcurrencyLimiter:
>         def __init__(self, max_concurrency: int):
>             self.sem = asyncio.Semaphore(max_concurrency)
>                             
>         async def __call__(self):
>             await self.sem.acquire()
>             try:
>                 yield
>             finally:
>                 self.sem.release()
>                             
>     # ç»™ä¸åŒçš„è·¯ç”±ç»„è®¾å®šä¸åŒçš„å¹¶å‘ä¸Šé™
>     limit5 = ConcurrencyLimiter(5)
>     limit2 = ConcurrencyLimiter(2)
>                             
>     @app.get("/fast", dependencies=[Depends(limit5)])
>     async def fast_endpoint():
>         await asyncio.sleep(3)
>         return {"msg": "fast endpoint"}
>                             
>     @app.get("/slow", dependencies=[Depends(limit2)])
>     async def slow_endpoint():
>         await asyncio.sleep(5)
>         return {"msg": "slow endpoint"}
>                             
>     ```
>
> ğŸ‘‰ è¿™æ ·å³ä½¿åŒæ—¶æ¥ 100 ä¸ªè¯·æ±‚ï¼Œäº‹ä»¶å¾ªç¯é‡Œä¹Ÿåªä¼šåŒæ—¶â€œè¿è¡Œâ€5ä¸ªï¼Œå…¶ä»–çš„è¦ç­‰ä¿¡å·é‡é‡Šæ”¾ã€‚

#### æ€»ç»“

> âœ… **Flask +ï¼ˆgï¼‰unicorn**ï¼šå¹¶å‘=workersÃ—threadsï¼›æ¯ä¸ªè¯·æ±‚å ä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°è¿”å›ã€‚
>
> âœ… **FastAPI + ASGI(uvicorn/hypercorn)**ï¼šåŸºäºäº‹ä»¶å¾ªç¯çš„åç¨‹å¹¶å‘ï¼›ç­‰å¾… I/O æ—¶**ä¸å çº¿ç¨‹**ã€‚
>
> âŒ **â€œasync ç­‰äº Tomcat + @Asyncâ€**ï¼šä¸ç­‰ä»·ã€‚
>
> - `@Async`=æŠŠå·¥ä½œä¸¢ç»™**åˆ«çš„çº¿ç¨‹æ± **ï¼ˆçº¿ç¨‹å¹¶å‘ï¼‰ã€‚
> - `async/await`=åœ¨**åŒä¸€äº‹ä»¶å¾ªç¯**é‡Œåä½œå¼è°ƒåº¦ï¼ˆåç¨‹å¹¶å‘ï¼‰ï¼Œç­‰å¾… I/O æ—¶é‡Šæ”¾æ§åˆ¶æƒè€Œä¸æ˜¯å ç”¨çº¿ç¨‹ã€‚

## 1.6 å¯¹è±¡, åå°„, æ³›å‹

Reference: 
* Javaé€šè¿‡åå°„è·å–æ³›å‹ç±»å‹ä¿¡æ¯ 
  https://blog.csdn.net/cnds123321/article/details/119655880
* æ“¦æ‹­æ³• 
  https://www.liaoxuefeng.com/wiki/1252599548343744/1265104600263968
* Javaæ³›å‹--åˆ›å»ºç±»å‹å®ä¾‹çš„å‡ ç§æ–¹æ³• 
  https://blog.csdn.net/Sife_007/article/details/80308517
  
* Type ç±»å‹ æ³›å‹ åå°„ Class ParameterizedType [MD] 
  https://www.cnblogs.com/baiqiantao/p/7460580.html
  
* æ‰“ä¸ªèµŒä½ å¯èƒ½ä¸çŸ¥é“å¦‚ä½•è·å–Javaæ³›å‹çš„Classå¯¹è±¡ 
  https://cloud.tencent.com/developer/article/1851247

jad; jclasslib;  type erase 

* Javaæ ¹æ®ç±»ååå°„åˆ›å»ºå¯¹è±¡ Javaé€šè¿‡åå°„åˆ›å»ºå¯¹è±¡
https://blog.51cto.com/u_13259/6482348
``` java
      Constructor constructor = i.getClass().getConstructor();
      constructor.setAccessible(true);
      test = (Test) constructor.newInstance();
```


## 1.7 stream æµå¼æ“ä½œ
### flatmap
+ https://www.geeksforgeeks.org/stream-flatmap-Java-examples/  
+ https://openhome.cc/zh-tw/Java/functional-api/flatmap/  
```
        List<String> violationList = sosInfoDTOS.stream()
                                                .filter(i -> ObjectUtil.isNotEmpty(i.getMsgInfo()))
                                                .flatMap(i -> Arrays.asList(i.getMsgInfo().split(",")).stream())
                                                .distinct()
                                                .collect(Collectors.toList());
```

## 1.8 å‡½æ•°å¼ç¼–ç¨‹
https://zyb0408.github.io/gitbooks/onJava8/docs/book/13-Functional-Programming.html#Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F

## 1.9 Predicate æ–­è¨€
https://www.jianshu.com/p/5988b22f45dd

## Java å®šæ—¶å™¨

https://www.cnblogs.com/silent-bug/p/13653049.html

## Java Localdate -> String
LocalDate/LocalDateTimeä¸Stringçš„äº’ç›¸è½¬æ¢ç¤ºä¾‹(é™„DateTimeFormatterè¯¦è§£)
https://www.jianshu.com/p/b7e72e585a37
https://www.cnblogs.com/CF1314/p/13884530.html

### String ç±»å‹è½¬localDate
LocalDate beginDateTime = LocalDate.parse(beginDate, DateTimeFormatter.ofPattern(â€œyyyy-MM-ddâ€));

### dateç±»å‹è½¬localDate
Date dates = new SimpleDateFormat(â€œyyyyMMâ€).parse(cycle);
Instant instant = dates.toInstant();
ZoneId zoneId = ZoneId.systemDefault();
LocalDate localDate = instant.atZone(zoneId).toLocalDate();

## Javaç»éªŒ

1. refDefine-classçš„é—®é¢˜å¦‚æœæ¥è‡ªäºå¼•ç”¨, å¯èƒ½æ˜¯jaråŒ…å†²çª; æœ¬åœ°çš„classæ‰¾ä¸åˆ°å†ç¡®å®šæ˜¯ä¸æ˜¯maven-compileå‡ºäº†é—®é¢˜
2. 

```/**
         * enumç±»è‡ªå¸¦ä¸€ä¸ªvalues()æ–¹æ³•, è·å–è¯¥ç±»ä¸­çš„æ‰€æœ‰enum
         * 
         * enumå˜é‡è‡ªå¸¦ä¸¤å±æ€§
         * name: å³å˜é‡åtoString å¦‚RequestMethod.GET.name()å³ä¸º"name"
         * ordinal: åœ¨enumç±»ä¸­çš„é¡ºåº, ä»0å¼€å§‹
         */

  enum è·å–ç´¢å¼•ä½ç½®: ConstantEnum.values()[i].ordinal()
```

3. å¯¹è±¡å¿…é¡»åšéç©ºåˆ¤æ–­, é¿å…NPE
4. listæˆ–åˆ†é¡µä¸è¦ä½¿ç”¨copypropertiesæ–¹æ³•, åœ¨ä¸€å®šæ•°é‡çš„æ—¶å€™, copypropertiesä¼šå¯¼è‡´æŸ¥è¯¢å¾ˆæ…¢; å»ºè®®ä½¿ç”¨mapperæŸ¥è¯¢ç›´æ¥è¿”å›vo, åœ¨voä¸­ç›´æ¥setå€¼
5. Restfulæœ¬åœ°è°ƒç”¨127.0.0.1:xxxx, ä½†æ˜¯è¿™ç§çš„é—®é¢˜åœ¨äº, ä¸€ä¸ªæœåŠ¡ä¾èµ–äºä¸€ä¸ªæœåŠ¡, è€Œä¸æ˜¯åˆ†å¸ƒå¼æœåŠ¡é›†ç¾¤; (æ‰€ä»¥å¼•å…¥Feignè§£è€¦)
6. å¼•å…¥ä»£ç è§„èŒƒçš„æ„ä¹‰, å®ç°é£é™©å¯æ§
7. å­¦ä¼šåšå·®å¼‚åŒ–è®¾è®¡, äº§å“å·®å¼‚åŒ–, æœåŠ¡å·®å¼‚åŒ–

```
import static com.xxx.xxxStaticFinal.*;
ç›´æ¥å¼•ç”¨æ‰€æœ‰å¸¸é‡
```

8. æŠ›å‡ºå¼‚å¸¸å¿…é¡»ç²¾å‡†æŠ¥é”™, çŸ¥é“æ˜¯å“ªä¸ªæ–¹æ³•, å“ªä¸ªå­—æ®µæŠ¥é”™

9. ç¬¬ä¸‰æ–¹æ¥å£æ•°æ®å¿…é¡»å…¨éƒ¨ä¿å­˜, å°¤å…¶æ˜¯æ¶‰åŠåˆ°æ”¯ä»˜

10. // ä¸å¯ç”¨ clazz.getDeclaredConstructor().newInstance(); å› ä¸ºè¿™æ ·ä¸ä¼šåŠ è½½ spring - autowired   this.factory = SpringUtils.getBean(clazz);

11. æ•°æ®åº“å»ºè®®å…³é—­ 5432 å¯¹å¤–ç«¯å£, éœ€è¦è¿æ¥æ—¶, ssh è¿è¿‡å»    ç„¶åå†å†™ postgres sql; å¹¶ä¸”ä½¿ç”¨å†…ç½‘ç«¯å£, å¯ä»¥èŠ‚çœå¤–ç½‘ io 

12. æµ‹è¯•/ç”Ÿäº§ä¸æœ¬åœ°ç¯å¢ƒå…±ç”¨ redis, ä¼šå¯¼è‡´æ–­ç‚¹è°ƒè¯•å¼‚å¸¸

13. fileter

14. é™¤äº†æ–°å¢åŠŸèƒ½, ä¿®æ”¹å…±ç”¨æ•°æ®åº“ä¹‹å‰å¿…é¡»é€šçŸ¥ dba, æˆ–è€…åšå¥½å¤‡ä»½, ä¸¥ç¦ç›´æ¥ä¿®æ”¹æ•°æ®åº“, å¼•èµ·ç”Ÿäº§äº‹æ•…

15. è‡ªå®šä¹‰å‘½ä»¤è¡Œå‚æ•°  `--myParam='test'`

16. Response è·å– byte[]

    ```java
    InputStream inputStream = response.body().asInputStream();
    return IOUtils.toByteArray(inputStream);    
    ```

17. @Async ä½¿ç”¨ https://blog.csdn.net/YoungLee16/article/details/88398045

    + åœ¨@SpringBootApplicationå¯åŠ¨ç±»å½“ä¸­æ·»åŠ æ³¨è§£@EnableAsyncæ³¨è§£ã€‚
    + å¼‚æ­¥æ–¹æ³•ä½¿ç”¨æ³¨è§£@[Async](https://so.csdn.net/so/search?q=Async&spm=1001.2101.3001.7020)çš„è¿”å›å€¼åªèƒ½ä¸ºvoidæˆ–è€…Futureã€‚
    + éœ€è¦èµ°Springçš„ä»£ç†ç±»ã€‚å› ä¸º@Transactionalå’Œ@Asyncæ³¨è§£çš„å®ç°éƒ½æ˜¯åŸºäºSpringçš„AOPï¼Œè€ŒAOPçš„å®ç°æ˜¯åŸºäºåŠ¨æ€ä»£ç†æ¨¡å¼å®ç°çš„ã€‚é‚£ä¹ˆæ³¨è§£å¤±æ•ˆçš„åŸå› å°±å¾ˆæ˜æ˜¾äº†ï¼Œæœ‰å¯èƒ½å› ä¸ºè°ƒç”¨æ–¹æ³•çš„æ˜¯å¯¹è±¡æœ¬èº«è€Œä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡Springå®¹å™¨ã€‚

18. å‘½åè§„èŒƒ https://www.jhelp.net/p/Dq0h3U69SZfAAGhP
19. Javaä½¿ç”¨HMAC-SHA256ç®—æ³•å®ç°æ¥å£è®¤è¯  https://www.jianshu.com/p/365c2b3811d9
20. constant string too long
java string æ”¯æŒä¼ é€’é•¿å­—æ®µ, ä½†æ˜¯åˆå§‹åŒ–æ—¶ä¸æ”¯æŒ 10kb ä»¥ä¸Šå­—ç¬¦ä¸², æ‰€ä»¥åªèƒ½é€šè¿‡è¯»å–æ–‡ä»¶æˆ–è€…httpæ–¹å¼è·å–é•¿å­—æ®µ, æ¯”å¦‚
```java
    public static String sendLongAudio() {
        // æŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶è·¯å¾„
        String filePath = "path";

        String out = "";
        try {
            // åˆ›å»ºæ–‡ä»¶è¯»å–å™¨
            FileReader fileReader = new FileReader(filePath);

            // åˆ›å»ºç¼“å†²å­—ç¬¦æµ
            BufferedReader bufferedReader = new BufferedReader(fileReader);

            // é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹
            String line = "";
            while ((line = bufferedReader.readLine()) != null) {
                out = line;
            }

            // å…³é—­æ–‡ä»¶è¯»å–å™¨
            bufferedReader.close();
        } catch (IOException e) {
            e.printStackTrace();
        }

        return out;
    }
```
21. è·å–æ–¹æ³•å `Thread.currentThread().getStackTrace()[1].getMethodName();`

22. java ä¼ å…¥ç‰¹å®šå‚æ•°
java å¯åŠ¨æ—¶ä¼ å…¥å‚æ•° `java -jar xxx.jar --spring.profiles.active=prod`


23.  è¿”å›å‰ç«¯ @Configuration ä¿®é¥°çš„ç±», ä¼šæŠ¥å¼‚å¸¸
@Configurationæ³¨è§£ç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œé€šå¸¸ä¸ä¼šç›´æ¥è¿”å›ç»™å‰ç«¯ã€‚å¦‚æœæ‚¨å°è¯•å°†å¸¦æœ‰@Configurationæ³¨è§£çš„ç±»ç›´æ¥è¿”å›ç»™å‰ç«¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¼‚å¸¸æˆ–ä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚

```

@RestController
@RequestMapping("/api")
public class MyController {

    @Value("${your-config-key}")
    private String configValue;

    @GetMapping("/config")
    public String getConfig() {
        return configValue;
    }
}
```

24.  immutables
https://reflectoring.io/immutables-library/

25. System.out.println æ ¼å¼åŒ–è¾“å‡º
åŸºç¡€çš„æ ¼å¼åŒ–è¾“å‡ºï¼š
System.out.printf("Hello %s!%n", "World");

26. å¦‚ä½•åœ¨ springboot å¯åŠ¨æ—¶ æŸ¥è¯¢æ•°æ®åº“ 
æœ€ç®€å•æœ€ç¬¨çš„æ–¹æ³•, æ”¾åœ¨ spring-boot runApplication å†…æ‰§è¡Œ, é¿å… mybatis åŠ è½½é¡ºåºå¯¼è‡´æ‰§è¡Œå¤±è´¥
```java
    public static void main(String[] args) {
        SpringApplication.run(ServerApplication.class,args);

        init();
    }
    
    public static void init() {
      // æŸ¥è¯¢æ•°æ®åº“
    }
```

27. @Bean é—®é¢˜, é—®é¢˜å…¶å®æ˜¯ @Resource å’Œ @Bean æ˜¯åŒä¸€ä¸ªå¯¹è±¡, ä¸èƒ½åŒæ—¶ç”¨, å¦åˆ™ä¼šå¯¼è‡´åŠ è½½å¤±è´¥
```

å·²çŸ¥ä»£ç å¦‚ä¸‹, ç³»ç»Ÿå¯åŠ¨æ—¶, å°† AuthenticationClient è‡ªåŠ¨æ³¨å…¥, æ‰§è¡Œ clientOptions.setAppId(appid),  appid ä¸ºç©º, åº”å¦‚ä½•ä¿®æ”¹

@ConfigurationProperties(prefix = "iam")
@Component
@Setter
@Slf4j
public class AuthingService {

    private String appid;

    private String appsceret;

    private String apphost;

    private String redirectUrl;

    @Bean
    public AuthenticationClient getAuthenticationClient() {
        // ä½¿ç”¨ AppId å’Œ AppHost è¿›è¡Œåˆå§‹åŒ–
        AuthenticationClientOptions clientOptions = new AuthenticationClientOptions();
        clientOptions.setAppId(appid);
        clientOptions.setAppSecret(appsceret);
        clientOptions.setAppHost(apphost);
        clientOptions.setRedirectUri(redirectUrl);

        AuthenticationClient authenticationClient = null;
        try {
            authenticationClient = new AuthenticationClient(clientOptions);
        } catch (Exception e) {
            log.error("AuthenticationClient åˆå§‹åŒ–å¤±è´¥: " + e.getMessage(), e);
        }
        return authenticationClient;
    }
}

```

28. InetAddress.getLocalHost().getHostName() took 5006 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
+ Edit the /etc/hosts file. `sudo nano /etc/hosts`
+ Ensure there's an entry for 127.0.0.1 and your hostname:
```
127.0.0.1       localhost your_hostname
::1             localhost your_hostname
```
Replace your_hostname with the actual hostname of your machine. If you don't know your hostname, you can usually get it by typing `hostname` in the terminal.

29. cn.hutool.core.bean.BeanUtils.copyProperties   å¿½ç•¥ç©ºå€¼
`CopyOptions.create().setIgnoreNullValue(true);`


30. å»ºç«‹æ–°çš„ module
new module -> jakartaEE , REST service & Application server -> unclick all dependencies

31. JDK21æŠ¥é”™NoSuchFieldError: Class com.sun.tools.javac.tree.JCTree$JCImport does not have member fie
https://blog.csdn.net/G971005287W/article/details/133350154
å‡çº§lombok

32. feign.RetryableException: null executing GET http://****/cr**t/e**/cre****ount/2**8060
https://www.cnblogs.com/zxporz/p/13094614.html

33. spring-boot application get env config
```java
    ConfigurableApplicationContext application = SpringApplication.run(xxxApplication.class, args);
		Environment env = application.getEnvironment();
		String port = env.getProperty("server.port");
```

34. java ä» url  è·å–bufferImage
```java
// å®šä¹‰ä½ çš„å›¾ç‰‡èµ„æºURL
            URL url = new URL("http://www.example.com/image.jpg");
            // è¯»å–å¹¶åˆ›å»ºä¸€ä¸ªBufferedImageå¯¹è±¡
            BufferedImage image = ImageIO.read(url);
```

35. @Service å•ä¾‹æ¨¡å¼è·å–å®ä¾‹
```java
getApplicationContext().getBean(clazz)
```

è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š

+ **ä¸Springå®¹å™¨ä¿æŒä¸€è‡´**ï¼šç›´æ¥ä½¿ç”¨Springçš„ApplicationContextç¡®ä¿äº†ä½ è·å–çš„beanæ˜¯Springå®¹å™¨æ‰€ç®¡ç†çš„ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„ä¾èµ–æ³¨å…¥å’Œå®¹å™¨ç‰¹æ€§ã€‚
+ **çµæ´»æ€§**ï¼šä½ å¯ä»¥åŠ¨æ€åœ°æ ¹æ®ç±»åæˆ–beançš„åç§°æ¥è·å–å®ä¾‹ï¼Œè¿™ä½¿å¾—ä»£ç æ›´åŠ çµæ´»ã€‚
+ **é€‚ç”¨äºå¤æ‚åœºæ™¯**ï¼šåœ¨ä¸€äº›å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œå¦‚åŠ¨æ€å†³å®šè¦ä½¿ç”¨å“ªä¸ªbeançš„æƒ…å†µï¼Œè¿™ç§æ–¹æ³•éå¸¸æœ‰ç”¨ã€‚

ä¹Ÿæœ‰ä¸€äº›æ½œåœ¨çš„ç¼ºç‚¹æˆ–éœ€è¦æ³¨æ„çš„ç‚¹ï¼š

+ è¿èƒŒä¾èµ–æ³¨å…¥åŸåˆ™ï¼šç›´æ¥ä»ApplicationContextè·å–beanè¿èƒŒäº†ä¾èµ–æ³¨å…¥çš„åŸåˆ™ï¼Œå³ä¾èµ–åº”è¯¥è¢«æ³¨å…¥åˆ°ä½¿ç”¨å®ƒä»¬çš„å¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯ç”±å¯¹è±¡è‡ªå·±å»å¯»æ‰¾ä¾èµ–ã€‚
+ ä»£ç è€¦åˆï¼šè¿™ç§æ–¹æ³•ä½¿ä½ çš„ä»£ç ä¸Springæ¡†æ¶ç´§å¯†è€¦åˆï¼Œè¿™å¯èƒ½ä¼šä½¿å¾—å•å…ƒæµ‹è¯•å˜å¾—æ›´åŠ å›°éš¾ï¼Œå› ä¸ºä½ éœ€è¦åœ¨æµ‹è¯•æ—¶é…ç½®Spring ApplicationContextã€‚
+ æ€§èƒ½è€ƒè™‘ï¼šé¢‘ç¹åœ°ä»ApplicationContextè·å–beanå¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹åº”ç”¨ä¸­ã€‚


36. nacosæ˜¯é€šè¿‡ http è¿˜æ˜¯ grpc æ–¹å¼?
    Spring Cloud Nacos é›†æˆé€šå¸¸é€šè¿‡ HTTPï¼ˆæˆ– HTTPSï¼‰åŸŸåè®¿é—®çš„æ–¹å¼ä¸ Nacos Server è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ gRPCã€‚

37. equals å’Œ == åŒºåˆ«
+ == è¿ç®—ç¬¦:

ç”¨é€”ï¼šæ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å¼•ç”¨åœ°å€ï¼Œå³å®ƒä»¬æ˜¯å¦æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªä½ç½®ã€‚
åŸºæœ¬ç±»å‹ï¼šå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ int, char, double ç­‰ï¼‰ï¼Œ== æ¯”è¾ƒçš„æ˜¯å€¼æœ¬èº«ã€‚
å¯¹è±¡ï¼šå¯¹äºå¯¹è±¡å¼•ç”¨ï¼ˆå¦‚ String, Long ç­‰åŒ…è£…ç±»ï¼‰ï¼Œ== æ¯”è¾ƒçš„æ˜¯å®ƒä»¬æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆå³æ˜¯å¦æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ï¼‰ã€‚

+ .equals() æ–¹æ³•:

ç”¨é€”ï¼šé€šå¸¸ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æˆ–å€¼æ˜¯å¦ç›¸ç­‰ã€‚
é‡å†™ï¼šObject ç±»çš„ .equals() æ–¹æ³•é»˜è®¤è¡Œä¸ºæ˜¯æ¯”è¾ƒå¼•ç”¨ï¼Œä½†å¾ˆå¤šç±»ï¼ˆå¦‚ String, Integer ç­‰ï¼‰é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œæä¾›äº†å†…å®¹æ¯”è¾ƒçš„é€»è¾‘ã€‚
å¯¹è±¡ï¼šå¯¹äºè‡ªå®šä¹‰å¯¹è±¡ï¼Œå¦‚æœéœ€è¦æ ¹æ®å¯¹è±¡çš„çŠ¶æ€ï¼ˆå³å®ƒçš„å­—æ®µå€¼ï¼‰åˆ¤æ–­ç›¸ç­‰æ€§ï¼Œé€šå¸¸éœ€è¦é‡å†™ .equals() æ–¹æ³•ã€‚

`ç»“è®º: é™¤äº†åŸºæœ¬ç±»å‹ä»¥å¤–, æ— è„‘ç”¨ .equals() å³å¯`

38. The bean 'xxx.FeignClientSpecification' could not be registered. A bean with that name has already been defined and overriding is disabled.
è¯´æ˜æœ‰åŒä¸€ä¸ª feign å·²ç»æ³¨å†Œ, è€ƒè™‘ä¾èµ–åŒ…å†…å†²çª, 
+ æ¨èä½¿ç”¨æ‰©å±•Feignå®¢æˆ·ç«¯
  è¿™ä¸ªå®¢æˆ·ç«¯ä¹Ÿåº”è¯¥æŒ‡å®šç›¸åŒçš„æœåŠ¡åï¼ˆsysï¼‰ï¼Œä½†å®ƒå¯ä»¥æœ‰ä¸€ä¸ªä¸åŒçš„Javaç±»åå’Œ/æˆ–ä¸€ä¸ªä¸åŒçš„contextIdï¼Œè¿™æ ·Springå°±èƒ½åŒºåˆ†è¿™ä¸¤ä¸ªä¸åŒçš„Feignå®¢æˆ·ç«¯å®ä¾‹ã€‚
  ```java
  @FeignClient(name = "sys", contextId = "customFeignClient", /* è‡ªå®šä¹‰é…ç½® */)
  ```
+ è¦†ç›–ä½¿ç”¨ `spring.main.allow-bean-definition-overriding=true`, ä½†æ˜¯è¿™æ ·ä¼šè®©æ•´ä¸ªé¡¹ç›®éƒ½å…è®¸åŒåè¦†ç›–

39.  Boolean defaultValue = "b'0'"  é»˜è®¤å€¼æ˜¯true è¿˜æ˜¯ false
The default value b'0' as shown in Boolean defaultValue = "b'0'" indicates a false value. In many programming contexts, a binary value of 0 typically represents false, while 1 represents true. Therefore, in this case, the default value is false.

40. SpelEvaluationException: EL1001E: Type conversion problem, cannot convert from xxxParam to java.lang.String
SPEL è¡¨è¾¾å¼ä¸èƒ½ç›´æ¥æ¥æ”¶æŸä¸ªentityä½œä¸ºå…¥å‚, åªèƒ½æ˜¯å­—ç¬¦ä¸²

41. ELè¡¨è¾¾å¼
`${env.name}`

42. Boolean defaultValue = "b'0'"  é»˜è®¤å€¼æ˜¯true è¿˜æ˜¯ false
The default value b'0' as shown in Boolean defaultValue = "b'0'" indicates a false value. In many programming contexts, a binary value of 0 typically represents false, while 1 represents true. Therefore, in this case, the default value is false.
0å¦1æ˜¯

43. æœåŠ¡å™¨å¤„ç†å¼‚å¸¸:Handler dispatch failed; nested exception is java.lang.AssertionError: class xxx TableInfoä¸å­˜åœ¨ï¼
selectAll æ–¹æ³•çš„å…¥å‚å¿…é¡»æ˜¯ table-entity

44. ä½¿ç”¨ `@TableField(typeHandler = JacksonTypeHandler.class)` åªèƒ½å­˜æ•°æ®, ä¸èƒ½æŸ¥æ•°æ®
æˆ‘ä»¬åªéœ€è¦åœ¨å®ä½“ç±»ä¸­åŠ ä¸Š@TableName(value =xxx, autoResultMap = true)åé¢çš„autoResultMap å³å¯ã€‚

45. java string å¤§å†™ç¬¬ä¸€ä½
```java
public String capitalizeFirstLetter(String str) {
    if (str == null || str.isEmpty()) {
        return str;
    }
    return str.substring(0, 1).toUpperCase() + str.substring(1);
}
```

46. string è½¬é©¼å³°
```java
public String toCamelCase(String str) {
    if (str == null || str.isEmpty()) {
        return str;
    }

    StringBuilder camelCaseStr = new StringBuilder();
    boolean makeNextUpperCase = false;

    for (char c : str.toCharArray()) {
        if (Character.isSpaceChar(c)) {
            makeNextUpperCase = true;
        } else if (makeNextUpperCase) {
            camelCaseStr.append(Character.toUpperCase(c));
            makeNextUpperCase = false;
        } else {
            camelCaseStr.append(Character.toLowerCase(c));
        }
    }

    return camelCaseStr.toString();
}
```

47. spring cloud gateway ç½‘å…³é…ç½®, urinameä¸pathnameä¸€è‡´
ä¼šå¯¼è‡´è·¯ç”±æ— æ³•è®¿é—®, å»ºè®®ä½¿ç”¨ä¸åŒçš„ã€æè¿°æ€§çš„å‘½åæ¥åŒºåˆ†URIå’Œè·¯å¾„æ–­è¨€ã€‚

48. 0 0 23 * * ?   è¿™ä¸ª cron è¡¨è¾¾å¼ä»€ä¹ˆæ„æ€
è¿™ä¸ªå…·ä½“çš„è¡¨è¾¾å¼ 0 0 23 * * ? ç”±å…­ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªéƒ¨åˆ†çš„å«ä¹‰å¦‚ä¸‹ï¼š
0 - ç§’ï¼ˆè¡¨ç¤ºåœ¨åˆ†é’Ÿçš„å¼€å§‹æ—¶åˆ»ï¼‰
0 - åˆ†é’Ÿï¼ˆè¡¨ç¤ºåœ¨å°æ—¶çš„å¼€å§‹æ—¶åˆ»ï¼‰
23 - å°æ—¶ï¼ˆè¡¨ç¤ºä¸€å¤©ä¸­çš„ 23 ç‚¹ï¼‰
* - æ—¥ï¼ˆè¡¨ç¤ºæ¯å¤©ï¼‰
* - æœˆï¼ˆè¡¨ç¤ºæ¯æœˆï¼‰
? - æ˜ŸæœŸï¼ˆ? è¡¨ç¤ºä¸æŒ‡å®šï¼Œåœ¨ Cron è¡¨è¾¾å¼ä¸­ï¼Œæ—¥å’Œæ˜ŸæœŸè¿™ä¸¤ä¸ªå­—æ®µé€šå¸¸æœ‰ä¸€ä¸ªè¦è®¾ä¸º ?ï¼‰

49. springboot æ’é™¤æŸäº›ç±»
@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class, ...})

50. springboot-component æ’é™¤æŸäº›ç±»
```java
@ComponentScan(basePackages = "com.example.package",
               excludeFilters = @ComponentScan.Filter(
                   type = FilterType.ASSIGNABLE_TYPE,
                   value = MyExcludedClass.class
               ))
```

51. MultipartFileè·å– base64
```java
    base64EncodedString = Base64.getEncoder().encodeToString(fileContent);
```

52. java æœ‰å¤šä¸ª project   mavenå¦‚ä½•æ‰“åŒ…æŒ‡å®šçš„jar
cd åˆ°æŒ‡å®šç›®å½•, å† mvn package

53. java ç»§æ‰¿æ³¨è§£
ä½¿ç”¨@Inheritedå…ƒæ³¨è§£

54. bigdecimal java å¦‚ä½•ä¿å­˜ä¸¤ä½å°æ•°
BigDecimal roundedNumber = number.setScale(2, RoundingMode.HALF_UP);

55. MultipartFile file1 æ€ä¹ˆæ”¹å
`file.transferTo(destinationFile);`

56. æ¡ä»¶æ„é€ å™¨ä½œä¸ºå‚æ•°è¿›è¡Œæ›´æ–°
```
UpdateWrapper<User> updateWrapper = new UpdateWrapper<>();
updateWrapper.eq("name","shimin");
 
User user = new User();
user.setAge(18);
 
Integer rows = userMapper.update(user, updateWrapper);
```

57.  feign.FeignException$ServiceUnavailable: [503/404] during [POST] to [http://service/api] [param]: [Load balancer does not contain an instance for the service service-oss]
å…³é—­ HTTP VPN, é‡å¯æ‰€æœ‰æœåŠ¡

58. å¦‚æœApplicationç±»åŒ…æ‰€åœ¨çš„ä½ç½®ä¹Ÿå¾ˆå…³é”®ï¼ŒSpringBooté¡¹ç›®çš„Beanè£…é…é»˜è®¤è§„åˆ™æ˜¯æ ¹æ®Applicationç±»æ‰€åœ¨çš„åŒ…ä½ç½®ä»ä¸Šå¾€ä¸‹æ‰«æï¼Applicationç±»æ˜¯æŒ‡SpringBooté¡¹ç›®å…¥å£ç±»ã€‚ä¹Ÿå°±æ˜¯æˆ‘çš„Serviceå±‚æ‰€åœ¨çš„åŒ…å¿…é¡»åœ¨com.example.mydemoæˆ–å…¶å­åŒ…ä¸‹ï¼Œå¦åˆ™Serviceå±‚ä¸­çš„Beanä¸ä¼šè¢«æ‰«æåˆ°
59. web-shiroåŸç†æ˜¯é€šè¿‡å°†userNameå°åœ¨jwt-tokenä¸­, ç„¶ååœ¨shiro-realmçš„doGetAuthenticationInfo()æ–¹æ³•é‰´æƒ, æœ€åé€šè¿‡new SimpleAuthenticationInfo(loginUser, token, getName())å°†loginUserå°åœ¨shiro-principalä¸­
60. @NotNull(message = "å°é¢ä¸èƒ½ä¸ºç©º") æ ‡ç­¾åªèƒ½åˆ¤æ–­nullå€¼, ä¸èƒ½åˆ¤æ–­sizeä¸º0çš„list
61. postæ¥å£ @RequestBodyæ‰èƒ½æ¥json; iosç«¯ç”¨postæ¥ä¸­æ–‡
62. å¤šè¡¨é«˜çº§æŸ¥è¯¢, ä½¿ç”¨FieldsUtil.getFieldsWithAlias(stuDTO, "stu"); è¯¥æ–¹æ³•ä¸ä¼šæ‹¼æ¥delFlag; åŒæ—¶åˆ—è¡¨é¡µçš„ç®€å•æŸ¥è¯¢, è¯·ä½¿ç”¨å•è¡¨æŸ¥è¯¢
63. ä½¿ç”¨é«˜çº§æŸ¥è¯¢, è¦ä¹ˆremoveæ’åºå­—æ®µ, ç„¶åè‡ªå·±æ‰‹åŠ¨å†™æ’åº, è¦ä¹ˆå°±ç”¨ä»–çš„æ’åº
64. DynamicDataSourceContextHolder.push("master"); ä¸æ”¯æŒåœ¨äº‹åŠ¡ä¸‹åˆ‡æ¢æ•°æ®æº
65. ideaçš„é¡¹ç›®, è®°å¾—ä»é¡¹ç›®é‡Œåˆ æ‰jrebel.xml, ä»–ä¼šå¯¼è‡´ä¸€å †é—®é¢˜
66. å’Œç¬¬ä¸‰æ–¹å¯¹æ¥çš„å‡†åˆ™, ä¸€å®šè¦æŠŠç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„ä¿¡æ¯ä¿å­˜å®Œæ•´
67. SOAæ¶æ„, åœ¨shellè„šæœ¬ä¸­, ä¸€å®šè¦å…ˆç›‘æ§server2æ˜¯å¦è¿è¡Œ, ç„¶åserver2è¿è¡Œå†éƒ¨ç½²server1, éƒ¨ç½²åç›‘æ§server1éƒ¨ç½²æˆåŠŸ, å†éƒ¨ç½²server2; ä¿è¯è‡³å°‘ä¸€å°æœåŠ¡å™¨åœ¨è¿è¡Œä¸­;
68. 127.0.0.1 æŸäº›ç«¯å£å¯èƒ½æ²¡æœ‰æ‰“å¼€, æ‰€ä»¥æ— æ³•ç›´æ¥è®¿é—®
69. æ‰“åŒ…æ—¶å¿½ç•¥æŸäº›æ¨¡å—çš„åŠæ³•
```
    <modules>
<!--      <module>module1</module>
      <module>module2</module>-->
      <module>module3</module>
    </modules>
```
70.  @CacheEvict(value = {BCardConstant.SYS_CONFIG_PARK_LIST} åªä¼šåˆ é™¤è¯¥key, è€Œä¸ä¼šåˆ é™¤å­key; æ‰€ä»¥å¦‚éœ€åˆ é™¤å­key, éœ€è¦ä½¿ç”¨redisæ¨¡ç³Šåˆ é™¤
71.  
![image](https://user-images.githubusercontent.com/37357447/150462539-dd732910-266a-4f9c-bb06-71924f43108d.png)
72.  shiro å¦‚æœæƒ³ç”¨å…¨å±€å¼‚å¸¸æ•è·å¤„ç†shiroå¼‚å¸¸, åœ¨JwtFilter-executeLoginæ–¹æ³•ä¸­ä½¿ç”¨try-catch-throwå³å¯; å¦åˆ™ä¼šè‡ªåŠ¨æŠ›å‡ºAuthenticationExceptionå¼‚å¸¸, è€Œäº¤ç»™spring-filterå®¹å™¨å¤„ç†
73.  åœ¨ä»£ç ä¸­ è·å–é¡¹ç›®å
``` java
    @Autowired
    ServletContext servletContext;

    @RequestMapping("/project-name")
    public void getProjectName(HttpServletResponse response) throws IOException {
        String projectName = servletContext.getContextPath();
        response.getWriter().write("Project Name: " + projectName);
    }
  
```
74.  spring validation
```
https://blog.csdn.net/kylin_tam/article/details/116276610
@Min => num

@Max => num

@Size(min=, max=) => list

@Length(min=, max=) => String
```
75.  Java å®ç°æ–­ç‚¹ä¼ è¾“: https://blog.csdn.net/u011250186/article/details/128322350
76.  æŒ‰éœ€åŠ è½½ - @Condition
    https://blog.csdn.net/xcy1193068639/article/details/81491071
```java
public class LinuxCondition implements Condition {
 
    @Override
    public boolean matches(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata) {
 
        Environment environment = conditionContext.getEnvironment();
 
        String property = environment.getProperty("os.name");
        if (property.contains("Linux")){
            return true;
        }
        return false;
    }
}
```
77.  æŒ‰éœ€åŠ è½½ - @ConditionalOnProperty
```java
@ConditionalOnProperty(name = "token.check", havingValue = "false")
```

78.  `@JsonIgnore` è¦ä½¿ç”¨ jackson æä¾›çš„ @JsonIgnore æ‰ç”Ÿæ•ˆ
79.  json å¤§å†™å˜é‡å¤„ç†, ä½¿ç”¨æ³¨è§£ `@JsonProperty("SN")`
80. md5 æ ¼å¼éªŒè¯: ç¡®ä¿å®ƒæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º32çš„å­—ç¬¦ä¸²ï¼Œä¸”åªåŒ…å«åå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ0-9å’Œa-fæˆ–A-Fï¼‰
81. spring bootæ€ä¹ˆåˆ›å»ºæŒ‡å®šnameçš„bean: ä½¿ç”¨ `@Bean(name="beanname")`
82. try-catch-finallyæ‰§è¡Œé¡ºåº(https://juejin.cn/post/7104448863297077284)
try->catch->finally, 
+ æ— è®ºæœ‰æ— return, éƒ½æŒ‰ç…§æ­¤é¡ºåº
+ è‹¥ return æ˜¯ä¸ªæŒ‡é’ˆ, åˆ™ finally çš„æ“ä½œä¼šå½±å“ return çš„ç»“æœ
83.  Mavenæ‰“åŒ…æŒ‡å®šé¡¹ç›®çš„JAR
cd module -> mvn clean package
84. java åˆ†éš”æ–œæ 
åæ–œæ  \\ æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œç”¨äºè½¬ä¹‰ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³è¦æŒ‰ç…§å•ä¸ªåæ–œæ æ¥åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä½ éœ€è¦ä½¿ç”¨å››ä¸ªåæ–œæ  \\\\ æ¥è¡¨ç¤ºä¸€ä¸ªæ™®é€šçš„åæ–œæ å­—ç¬¦ã€‚
String fileName = originalFilename.split("\\\\")[0];
85. java feign æŒ‡å®š Content-Type
éœ€è¦ä½¿ç”¨ consumes = "application/x-www-form-urlencoded", åœ¨ header ä¸­æŒ‡å®šæ— æ•ˆ
86. javaé‡è¦ç‰¹æ€§ä¸æ€æƒ³: åå°„, é€’å½’, æ³›å‹
87. java è½¬ä¹‰
+ ""éœ€è¦è½¬ä¹‰, æ‰€ä»¥ \"\" ä»£è¡¨æ˜¯ "", ä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­, è¦è¯†åˆ«"", æœ€åæ•ˆæœåº”è¯¥æ˜¯ "\"\"", æ‰€ä»¥è¿˜éœ€è¦ç”Ÿæˆä¸€ä¸ª\, æ‰€ä»¥ä½ çš„inputå®é™…æ˜¯ "\\\""
+ æ³¨æ„: {}ä¸éœ€è¦è½¬ä¹‰
88. æŒ‡å®š json é”®å€¼
+ å¸¸ç”¨ @JsonProperty(value="xxx"), åŒ…æ‹¬ä¸é™äº @RequestBody ç­‰springæ³¨è§£
+ alibabaFastjson ä½¿ç”¨  @JSONField(name = "xxx")
89. feign get è¯·æ±‚å‘é€å…¥å‚
```java
	Map<String, String> list(@RequestParam("projectName") String projectName, @RequestParam("codeList") List<String> code);
```
90. mybatis plus æ›´æ–°æ—¶ä¸å¿½ç•¥ null
```
é€šå¸¸ mybatis plus ç­–ç•¥éƒ½æ˜¯æ›´æ–° null å€¼å¿½ç•¥,
è‹¥æƒ³æ›´æ–°æŸä¸ªå€¼ä¸º null, åˆ™é€‰æ‹© @TableField(updateStrategy = FieldStrategy.IGNORED)
```
91. t.getClass().getDeclaredFields() æ— æ³•è·å–åˆ°çˆ¶çº§çš„å±æ€§, éœ€è¦è‡ªå·±å®ç°é€’å½’çˆ¶çº§, æˆ–è€…ä½¿ç”¨ä¸‹è¿°æ–¹æ³•
FieldUtils.getAllFieldsList

92. `java: java.lang.NoSuchFieldError: Class com.sun.tools.javac.tree.JCTree$JCImport does not have member field 'com.sun.tools.javac.tree.JCTree qualid'`
ä½¿ç”¨ jdk<= 17

93. å¤šé‡æ³›å‹è§£æ
```
        PlateInfoResult<PlateInfo> plateInfoResult = JSON.parseObject(whiteResult, new TypeReference<PlateInfoResult<PlateInfo>>(){});
```
```
    public static <T> T parseResult(String result, Class<T> c) {
        R<T> r = JSONObject.parseObject(result, new TypeReference<R<T>>(c) {
        });
        if (!r.getSuccess()) {
            throw new IllegalArgumentException(r.getMessage());
        }
        return r.getData();
    }
```
94. æ³›å‹è·å–çˆ¶ç±»å­—æ®µ
```
<!-- maven ä¾èµ– -->
<dependency>
  <groupId>org.apache.commons</groupId>
  <artifactId>commons-lang3</artifactId>
  <version>3.12.0</version>
</dependency>

// ç›´æ¥è·å–åŒ…å«çˆ¶ç±»çš„å­—æ®µ
List<Field> fields = FieldUtils.getAllFieldsList(paramObj.getClass());
```
95. æ‰“å°æ–¹æ³•å
```
String methodName = Thread.currentThread().getStackTrace()[1].getMethodName();  // æ‰“å°å½“å‰æ–¹æ³•å
String methodName = Thread.currentThread().getStackTrace()[2].getMethodName();  // æ‰“å°è°ƒç”¨è¯¥æ–¹æ³•çš„çˆ¶çº§æ–¹æ³•å
```

96. LocalDateTime å’Œ datetime åŒºåˆ«
ç±»å‹	æ˜¯å¦å¸¦æ—¶åŒº	æœ¬è´¨ç±»å‹
LocalDateTime	âŒ ä¸å¸¦æ—¶åŒº	çº¯ç²¹çš„æœ¬åœ°æ—¥æœŸæ—¶é—´
Hutool DateTime	âœ”ï¸ æœ‰æ—¶åŒºåç§»	å®è´¨ä¸Šæ˜¯ java.util.Date çš„å°è£…ï¼ˆå†…éƒ¨ä¿å­˜ UTC æ¯«ç§’å€¼ï¼‰

ğŸ‘‰ æ€»ç»“ï¼šLocalDateTime ä¸æ˜¯ä¸€ä¸ªçœŸå®ç¬æ—¶æ—¶é—´ï¼ŒDateTime æ˜¯ã€‚

97. Spring äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼ˆTransaction Propagationï¼‰ä¸€å…±æœ‰ 7 ç§ç­–ç•¥

| ä¼ æ’­è¡Œä¸º                        | å«ä¹‰                             | æ˜¯å¦éœ€è¦å·²æœ‰äº‹åŠ¡ | äº‹åŠ¡è¡Œä¸ºè¯´æ˜                                                 | å¸¸ç”¨åœºæ™¯                              |
| ------------------------------- | -------------------------------- | ---------------- | ------------------------------------------------------------ | ------------------------------------- |
| **PROPAGATION_REQUIRED** (é»˜è®¤) | æœ‰å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±åˆ›å»ºæ–°äº‹åŠ¡       | å¯æœ‰å¯æ—          | - è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ â†’ åŠ å…¥å½“å‰äº‹åŠ¡    - è‹¥ä¸å­˜åœ¨ â†’ åˆ›å»ºæ–°äº‹åŠ¡   | **æœ€å¸¸ç”¨**ï¼›ä¸€èˆ¬ä¸šåŠ¡é€»è¾‘              |
| **PROPAGATION_REQUIRES_NEW**    | æ°¸è¿œåˆ›å»ºæ–°äº‹åŠ¡                   | ä¸ä¾èµ–å·²æœ‰äº‹åŠ¡   | - æŒ‚èµ·å½“å‰äº‹åŠ¡   - å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡å•ç‹¬è¿è¡Œ                    | **æ—¥å¿—è®°å½•ã€è¡¥å¿ã€ç‹¬ç«‹æäº¤**          |
| **PROPAGATION_SUPPORTS**        | æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ä»¥éäº‹åŠ¡è¿è¡Œ | å¯æœ‰å¯æ—          | - æœ‰äº‹åŠ¡ â†’ åŠ å…¥äº‹åŠ¡   - æ— äº‹åŠ¡ â†’ éäº‹åŠ¡è¿è¡Œ                  | è¯»å–ç±»æ“ä½œï¼›æ˜¯å¦éœ€è¦äº‹åŠ¡æ— æ‰€è°“        |
| **PROPAGATION_NOT_SUPPORTED**   | æ€»æ˜¯ä¸ä½¿ç”¨äº‹åŠ¡                   | ä¸èƒ½æœ‰äº‹åŠ¡       | - æŒ‚èµ·å½“å‰äº‹åŠ¡   - ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œ                          | **éæ ¸å¿ƒé€»è¾‘ã€ä¸éœ€è¦äº‹åŠ¡çš„åœºæ™¯**      |
| **PROPAGATION_NEVER**           | å¿…é¡»ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ             | ä¸èƒ½æœ‰äº‹åŠ¡       | - è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ â†’ æŠ›å¼‚å¸¸                                    | å¿…é¡»æ— äº‹åŠ¡ï¼Œä¾‹å¦‚äº‹åŠ¡ä¸éäº‹åŠ¡å¼ºéš”ç¦»    |
| **PROPAGATION_MANDATORY**       | å¿…é¡»åœ¨å·²æœ‰äº‹åŠ¡å†…è¿è¡Œ             | å¿…é¡»å·²æœ‰äº‹åŠ¡     | - æ— äº‹åŠ¡ â†’ æŠ›å¼‚å¸¸                                            | å¿…é¡»å¤„äºäº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ DAO/æ ¸å¿ƒä¸šåŠ¡ |
| **PROPAGATION_NESTED**          | åµŒå¥—äº‹åŠ¡ï¼ˆSavepointï¼‰            | å¿…é¡»å·²æœ‰äº‹åŠ¡     | - ä½¿ç”¨ Savepoint å®ç°åµŒå¥—   - å†…éƒ¨äº‹åŠ¡å¤±è´¥å¯å›æ»šè‡³ savepoint | **å±€éƒ¨å›æ»š**ã€å¤æ‚ä¸šåŠ¡æµç¨‹            |

98. @Resource å’Œ @Autowire åŒºåˆ«

| æ³¨è§£           | æ¥æº                 | é»˜è®¤æ³¨å…¥æ–¹å¼                       | æŒ‰ç±»å‹å†²çªæ—¶            | æ˜¯å¦å¯ç”¨ `name` æŒ‡å®š |
| -------------- | -------------------- | ---------------------------------- | ----------------------- | -------------------- |
| **@Autowired** | Spring               | **æŒ‰ç±»å‹ï¼ˆbyTypeï¼‰**               | æŠ¥é”™ï¼ˆéœ€è¦ @Qualifierï¼‰ | å¯ä»¥ç”¨ `@Qualifier`  |
| **@Resource**  | JSR-250ï¼ˆJava æ ‡å‡†ï¼‰ | **æŒ‰åç§°ï¼ˆbyNameï¼‰**ä¼˜å…ˆï¼Œå†æŒ‰ç±»å‹ | ä½¿ç”¨ `name` ç²¾ç¡®åŒ¹é…    | å¯ä»¥ç”¨ `name` å±æ€§   |

99. nested exception is org.apache.ibatis.reflection.ReflectionException: Could not set property 'createAt' of 'class tech.ynfy.module.customer360.bean.CustomerProfileCore' with value 'Thu Nov 13 11:40:59 CST 2025' Cause: java.lang.IllegalArgumentException: argument type mismatch ï¼›
    ä¸èƒ½ç”¨ hutool.date

100. if ((hot == null && !isTempCustomerIdEmpty) || isCustomerIdEmpty ) { ä¸ºä»€ä¹ˆæœ€å³è¾¹æ°¸è¿œä¸ºfalse ï¼Ÿ

     ```
     å…ˆç»™å˜é‡èµ·ä¸ªç®€å•åå­—ï¼š
     
     A = (hot == null)
     B = isTempCustomerIdEmpty
     
     
     ä½ çš„ if æ¡ä»¶å°±æ˜¯ï¼š
     
     (A && !B) || B
     
     åˆ†ä¸¤ç§æƒ…å†µçœ‹ï¼š
     æƒ…å†µä¸€ï¼šB = trueï¼ˆä¸´æ—¶å®¢æˆ· ID ä¸ºç©ºï¼‰
     
     å³è¾¹ï¼šB = true
     
     å·¦è¾¹ï¼šA && !B = A && false = false
     
     æ‰€ä»¥æ•´ä½“ç»“æœï¼š
     
     (false) || true  => true
     
     
     æ­¤æ—¶ if ä¸€å®šæˆç«‹ï¼Œæ˜¯å³è¾¹çš„ B å†³å®šçš„ã€‚
     
     æƒ…å†µäºŒï¼šB = falseï¼ˆä¸´æ—¶å®¢æˆ· ID ä¸ä¸ºç©ºï¼‰
     
     å³è¾¹ï¼šB = false
     
     å·¦è¾¹ï¼šA && !B = A && true = A
     
     æ‰€ä»¥æ•´ä½“ç»“æœï¼š
     
     A || false  => A
     
     
     ä¹Ÿå°±æ˜¯ï¼š
     
     hot == null
     
     
     æ­¤æ—¶ if æˆä¸æˆç«‹ï¼Œåªçœ‹ hot æ˜¯å¦ä¸º nullï¼Œå³è¾¹é‚£æ®µ B ä¸€å®šæ˜¯ falseã€‚
     ```

101. java && ä¸ & ||ä¸| åŒºåˆ«

     ```
     åœ¨ Java ä¸­ï¼Œ&& ä¸ &ã€|| ä¸ | éƒ½å¯ä»¥ç”¨äºé€»è¾‘è¿ç®—ï¼Œä½†å®ƒä»¬æœ‰ é‡è¦åŒºåˆ«ï¼šæ˜¯å¦ çŸ­è·¯(short-circuit) ä»¥åŠæ˜¯å¦å¯ç”¨äº ä½è¿ç®—ã€‚
     
     âœ… 1. &&ï¼ˆé€»è¾‘ä¸ï¼‰ vs &ï¼ˆé€»è¾‘ä¸/ä½ä¸ï¼‰
     (1) && â€”â€” é€»è¾‘ä¸ + çŸ­è·¯
     
     å·¦è¾¹ä¸º false æ—¶ï¼Œå³è¾¹ä¸ä¼šæ‰§è¡Œï¼ˆçŸ­è·¯ï¼‰
     
     åªèƒ½ç”¨äº boolean
     
     ç¤ºä¾‹ï¼š
     
     boolean result = (a > 0) && (b++ > 0);
     // å¦‚æœ a > 0 ä¸º falseï¼Œb++ ä¸ä¼šæ‰§è¡Œ
     
     (2) & â€”â€” é€»è¾‘ä¸ï¼ˆæ— çŸ­è·¯ï¼‰æˆ–ä½ä¸
     ä½œä¸ºé€»è¾‘ä¸ï¼ˆbooleanï¼‰
     
     å·¦è¾¹æ— è®ºçœŸå‡ï¼Œå³è¾¹éƒ½ä¼šæ‰§è¡Œï¼ˆæ— çŸ­è·¯ï¼‰
     
     boolean result = (a > 0) & (b++ > 0);
     // ä¸ç®¡å·¦è¾¹ç»“æœæ˜¯ä»€ä¹ˆï¼Œb++ éƒ½ä¼šæ‰§è¡Œ
     
     ä½œä¸ºä½ä¸ï¼ˆæ•´æ•°ï¼‰
     
     æŒ‰ä½è¿›è¡Œ AND è¿ç®—
     
     int x = 6 & 3;  
     // 6 = 110, 3 = 011 â†’ 010 = 2
     
     ğŸ”¥ 2. ||ï¼ˆé€»è¾‘æˆ–ï¼‰ vs |ï¼ˆé€»è¾‘æˆ–/ä½æˆ–ï¼‰
     (1) || â€”â€” é€»è¾‘æˆ– + çŸ­è·¯
     
     å·¦è¾¹ä¸º true æ—¶ï¼Œå³è¾¹ä¸ä¼šæ‰§è¡Œï¼ˆçŸ­è·¯ï¼‰
     
     boolean result = (a > 0) || (b++ > 0);
     // å¦‚æœ a > 0 ä¸º trueï¼Œb++ ä¸ä¼šæ‰§è¡Œ
     
     (2) | â€”â€” é€»è¾‘æˆ–ï¼ˆæ— çŸ­è·¯ï¼‰æˆ–ä½æˆ–
     ä½œä¸ºé€»è¾‘æˆ–ï¼ˆbooleanï¼‰
     
     ä¸çŸ­è·¯ï¼Œå·¦å³ä¸¤è¾¹éƒ½ä¼šæ‰§è¡Œ
     
     boolean result = (a > 0) | (b++ > 0);
     // b++ æ€»ä¼šæ‰§è¡Œ
     
     ä½œä¸ºä½æˆ–ï¼ˆæ•´æ•°ï¼‰
     
     æŒ‰ä½è¿›è¡Œ OR è¿ç®—
     
     int x = 6 | 3;
     // 6 = 110, 3 = 011 â†’ 111 = 7
     
     ```

102. åƒä¸‡æ³¨æ„å¤šé‡æ³›å‹, å†…éƒ¨ä¸èƒ½å† `List<T>` å¦åˆ™ä¼šæˆä¸º `List<List<Module>>`
```
package com.mylike.module.yunxi.dto;

import lombok.Data;

/**
 * é€šç”¨ API å“åº”ç»“æ„ï¼ˆå¤–å±‚åŒ…è£…ï¼‰
 *
 * @param <T> listData ä¸­æ¯æ¡å…ƒç´ çš„ç±»å‹ï¼ˆä¸šåŠ¡å¯¹è±¡ï¼‰
 */
@Data
public class YunxiApiResponse<T> {
	
	/**
	 * ä¸šåŠ¡çŠ¶æ€ç ï¼ˆ0 è¡¨ç¤ºæˆåŠŸï¼‰
	 */
	private Integer code;
	
	/**
	 * ä¸šåŠ¡æç¤ºä¿¡æ¯ï¼ˆå¯èƒ½ä¸º nullï¼‰
	 */
	private String message;
	
	/**
	 * æœåŠ¡ç«¯ä¿¡æ¯ï¼Œå¦‚ IPã€ç«¯å£ã€traceId
	 */
	private String serverInfo;
	
	/**
	 * ä¸šåŠ¡æ•°æ®éƒ¨åˆ†
	 * å†…éƒ¨ä¸ºåˆ†é¡µç»“æ„ PageResult<T>
	 */
	private PageResult<T> data;
	
	/**
	 * åˆ†é¡µç»“æœå°è£…ç»“æ„
	 */
	@Data
	public static class PageResult<T> {
		
		/**
		 * å½“å‰é¡µç 
		 */
		private Integer currentPage;
		
		/**
		 * æ¯é¡µæ¡æ•°
		 */
		private Integer pageSize;
		
		/**
		 * æ€»è®°å½•æ•°
		 */
		private Integer totalRows;
		
		/**
		 * æ˜¯å¦ä¸ºæœ€åä¸€é¡µ
		 */
		private Boolean lastPage;
		
		/**
		 * å®é™…æ•°æ®åˆ—è¡¨
		 */
		private T listData;
	}
}

	@PostMapping(value = "/module/m0013/func/g0001")
	@Operation(summary = "å®¢æˆ·å•†å“æµè§ˆè½¨è¿¹")
	List<TrackDTO> listCustomerBrowseTrack(@RequestBody YunxiReqDTO reqDTO);

```


102. `@Resource` å’Œ `@Autowired` åŒºåˆ«
+ `@Autowired` æŒ‰ç±»å‹ä¼˜å…ˆ  é»˜è®¤ç”¨è¿™ä¸ªå°±è¡Œ
+ åƒ `FeignClient` ä¹‹ç±»çš„ç”¨ `name` æ¥åŒºåˆ†çš„, å¿…é¡»ä½¿ç”¨ `@Resource` æ¥åŠ è½½

103. è‡ªåŠ¨ update æ—¶é—´
```
1ï¼‰å®ä½“å­—æ®µåŠ è‡ªåŠ¨å¡«å……æ ‡è®°
@TableField(value = "update_at", fill = FieldFill.INSERT_UPDATE) // æˆ– FieldFill.UPDATE
@DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")
@JsonFormat(timezone = "GMT+8", pattern = "yyyy-MM-dd HH:mm:ss")
@JSONField(format = "yyyy-MM-dd HH:mm:ss")
@Schema(description = "æ›´æ–°æ—¶é—´")
private Date updateAt;


å¦‚æœä½ çš„åˆ—åå°±æ˜¯ update_atï¼Œå»ºè®®æŠŠ value="update_at" å†™ä¸Šï¼Œé¿å…å‘½åç­–ç•¥ä¸ä¸€è‡´å¯¼è‡´ä¸ç”Ÿæ•ˆã€‚

2ï¼‰å®ç° MetaObjectHandlerï¼ˆå…³é”®ï¼‰

Spring Boot é¡¹ç›®é‡Œç›´æ¥ @Component å³å¯ï¼š

import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import org.apache.ibatis.reflection.MetaObject;
import org.springframework.stereotype.Component;

import java.util.Date;

@Component
public class MyMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        // æ’å…¥æ—¶åŒæ—¶å¡«å……ï¼ˆå¯é€‰ï¼‰
        this.strictInsertFill(metaObject, "updateAt", Date.class, new Date());
        // å¦‚æœä½ è¿˜æœ‰ createAtï¼š
        // this.strictInsertFill(metaObject, "createAt", Date.class, new Date());
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        // æ›´æ–°æ—¶è‡ªåŠ¨åˆ·æ–°æ›´æ–°æ—¶é—´
        this.strictUpdateFill(metaObject, "updateAt", Date.class, new Date());
    }
}
```

104. maven jdk version ä¸ç”Ÿæ•ˆ

     åƒä¸‡ä¸è¦å¼ºåˆ¶è®¾ç½® mvn çš„ jdk, 

105. java `### Cause: java.sql.SQLSyntaxErrorException: ORA-00942: table or view does not exist`
     è€ƒè™‘ä¸Šä¸‹æ–‡çš„é—®é¢˜, ä½¿ç”¨ `@DS` è¯•è¯•
106. 

# ç¬¬äºŒç«  Mysql

## 2.1 åŸºç¡€ç±»å‹
[åŸæ–‡é“¾æ¥](https://blog.csdn.net/Alen_xiaoxin/article/details/88418808)ï¼šhttps://blog.csdn.net/Alen_xiaoxin/article/details/88418808
1. æ•°å€¼ç±»å‹  

|ç±»å‹|å¤§å°|èŒƒå›´(æœ‰ç¬¦å·)|èŒƒå›´(æ— ç¬¦å· unsigned)|
|:-:|:-:|:-:|:-:|
|TINYINT|1|(-128, 127)|(0, 255)|
|SMALLINT|2|(-32768, 32767)|(0, 65535)|
|MEDIUMINT|3|Â±800ä¸‡|1700ä¸‡|
|INT|4|Â±21äº¿|42äº¿|
|BIGINT|8|å¾ˆå¤§||
|FLOAT|4|||
|DOUBLE|8|||
|DECIMAL|å¯¹DECIMAL(M,D) ï¼Œå¦‚æœM>Dï¼Œä¸ºM+2å¦åˆ™ä¸ºD+2|ä¾èµ–äºMå’ŒDçš„å€¼||

+ int(m) é‡Œçš„ m æ˜¯è¡¨ç¤º SELECT æŸ¥è¯¢ç»“æœé›†ä¸­çš„æ˜¾ç¤ºå®½åº¦ï¼Œå¹¶ä¸å½±å“å®é™…çš„å–å€¼èŒƒå›´ï¼Œæ²¡æœ‰å½±å“åˆ°æ˜¾ç¤ºçš„å®½åº¦ã€‚  
+ > MySQL ä¸­ä½¿ç”¨æµ®ç‚¹æ•°å’Œå®šç‚¹æ•°æ¥è¡¨ç¤ºå°æ•°ã€‚  
  > æµ®ç‚¹ç±»å‹æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆFLOATï¼‰å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆDOUBLEï¼‰ï¼›å®šç‚¹ç±»å‹åªæœ‰ä¸€ç§ï¼Œå°±æ˜¯ DECIMALã€‚  
  > æµ®ç‚¹ç±»å‹å’Œå®šç‚¹ç±»å‹éƒ½å¯ä»¥ç”¨(M, D)æ¥è¡¨ç¤ºï¼Œå…¶ä¸­Mç§°ä¸ºç²¾åº¦ï¼Œè¡¨ç¤ºæ€»å…±çš„ä½æ•°ï¼›Dç§°ä¸ºæ ‡åº¦ï¼Œè¡¨ç¤ºå°æ•°çš„ä½æ•°ã€‚  
  > FLOAT ç±»å‹çš„å–å€¼èŒƒå›´å¦‚ä¸‹ï¼š  
  > æœ‰ç¬¦å·çš„å–å€¼èŒƒå›´ï¼š-3.402823466E+38ï½-1.175494351E-38ã€‚  
  > æ— ç¬¦å·çš„å–å€¼èŒƒå›´ï¼š0 å’Œ -1.175494351E-38ï½-3.402823466E+38ã€‚  
  > DOUBLE ç±»å‹çš„å–å€¼èŒƒå›´å¦‚ä¸‹ï¼š  
  > æœ‰ç¬¦å·çš„å–å€¼èŒƒå›´ï¼š-1.7976931348623157E+308ï½-2.2250738585072014E-308ã€‚  
  > æ— ç¬¦å·çš„å–å€¼èŒƒå›´ï¼š0 å’Œ -2.2250738585072014E-308ï½-1.7976931348623157E+308ã€‚  
  > æç¤ºï¼šä¸è®ºæ˜¯å®šç‚¹è¿˜æ˜¯æµ®ç‚¹ç±»å‹ï¼Œå¦‚æœç”¨æˆ·æŒ‡å®šçš„ç²¾åº¦è¶…å‡ºç²¾åº¦èŒƒå›´ï¼Œåˆ™ä¼šå››èˆäº”å…¥è¿›è¡Œå¤„ç†ã€‚  
  > FLOAT å’Œ DOUBLE åœ¨ä¸æŒ‡å®šç²¾åº¦æ—¶ï¼Œé»˜è®¤ä¼šæŒ‰ç…§å®é™…çš„ç²¾åº¦ï¼ˆç”±è®¡ç®—æœºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå†³å®šï¼‰ï¼ŒDECIMAL å¦‚æœä¸æŒ‡å®šç²¾åº¦ï¼Œé»˜è®¤ä¸ºï¼ˆ10ï¼Œ0ï¼‰ã€‚  
  > float(5,2) è¡¨ç¤ºï¼šè¿™ä¸ªæµ®ç‚¹æ•°æœ€å¤§é•¿åº¦ä¸º5ï¼Œä¹Ÿå°±æ˜¯äº”ä½ï¼Œç„¶åå°æ•°éƒ¨åˆ†ä¸º2ä½ï¼Œè‡³äºå­˜å‚¨èŒƒå›´ï¼Œå–å†³äºä½ æ˜¯å¦å®šä¹‰äº†æ— ç¬¦å·ã€‚
  > æ— ç¬¦å·çš„è¯ï¼Œæœ€å°æ˜¯0.0 æœ€å¤§èƒ½å­˜å‚¨åˆ°99999.9ï¼Œå¦‚æœæœ‰ç¬¦å·çš„è¯ï¼ŒèŒƒå›´æ˜¯ï¼š-99999.9è‡³99999.9ã€‚
  > é»˜è®¤å¤§å°ä¸º24ä½æ•°å­—ï¼Œç²¾åº¦å¤§çº¦7ä½æ•°å­—ï¼ˆç»æµ‹è¯•ä¸º6ä½ï¼‰ï¼Œå½“è®¾ç½®Må¤§å°å¤§äº24æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºDOUBLEç±»å‹;åŒæ—¶è®¾ç½®Må’ŒDæ—¶ä¸è¿›è¡Œè‡ªåŠ¨è½¬æ¢ã€‚
  > å°æ•°ä½è¶…è¿‡è®¾å®šå€¼ï¼ŒæŒ‰å››èˆäº”å…¥ä¿å­˜
+ æµ®ç‚¹å‹åœ¨æ•°æ®åº“ä¸­å­˜æ”¾çš„æ˜¯è¿‘ä¼¼å€¼ï¼Œè€Œå®šç‚¹ç±»å‹åœ¨æ•°æ®åº“ä¸­å­˜æ”¾çš„æ˜¯ç²¾ç¡®å€¼ã€‚  
+ decimal(m,d) å‚æ•° m ( m < 65 ) æ˜¯æ€»ä¸ªæ•°ï¼Œå‚æ•° d ( d < 30ä¸” d < m) æ˜¯å°æ•°ä½ã€‚

2. æ—¥æœŸå’Œæ—¶é—´ç±»å‹
è¡¨ç¤ºæ—¶é—´å€¼çš„æ—¥æœŸå’Œæ—¶é—´ç±»å‹ä¸ºDATETIMEã€DATEã€TIMESTAMPã€TIMEã€YEARã€‚  
æ¯ä¸ªæ—¶é—´ç±»å‹æœ‰ä¸€ä¸ªæœ‰æ•ˆå€¼èŒƒå›´å’Œä¸€ä¸ª"é›¶"å€¼ï¼Œå½“æŒ‡å®šä¸åˆæ³•çš„MySQLä¸èƒ½è¡¨ç¤ºçš„å€¼æ—¶ä½¿ç”¨"é›¶"å€¼ã€‚  
TIMESTAMPç±»å‹æœ‰ä¸“æœ‰çš„è‡ªåŠ¨æ›´æ–°ç‰¹æ€§ã€‚ 

3. å­—ç¬¦ä¸²ç±»å‹
å­—ç¬¦ä¸²ç±»å‹æŒ‡CHARã€VARCHARã€BINARYã€VARBINARYã€BLOBã€TEXTã€ENUMå’ŒSETã€‚
|ç±»å‹|å¤§å°|ç”¨é€”|
|:-:|:-:|:-:|
|CHAR|0-255å­—èŠ‚|å®šé•¿|
|VARCHAR|0-65535å­—èŠ‚|å˜é•¿|
|TINYBLOB|0-255å­—èŠ‚|äºŒè¿›åˆ¶å­—ç¬¦ä¸²|
|BLOB|0-65536å­—èŠ‚|äºŒè¿›åˆ¶é•¿æ–‡æœ¬|
|MEDIUMBLOB|0-16 777 215å­—èŠ‚|äºŒè¿›åˆ¶ä¸­é•¿æ–‡æœ¬|
|LONGBLOB|0-4 294 967 295å­—èŠ‚|äºŒè¿›åˆ¶æå¤§æ–‡æœ¬|
|TINYTEXT|0-255å­—èŠ‚|çŸ­æ–‡æœ¬|
|TEXT|0-65536å­—èŠ‚|é•¿æ–‡æœ¬|
|MEDIUMTEXT|0-16 777 215å­—èŠ‚|ä¸­é•¿æ–‡æœ¬|
|LONGTEXT|0-4 294 967 295å­—èŠ‚|æå¤§æ–‡æœ¬|

+ > char å’Œ varcharï¼š  
  > 1. char(n) è‹¥å­˜å…¥å­—ç¬¦æ•°å°äºnï¼Œåˆ™ä»¥ç©ºæ ¼è¡¥äºå…¶åï¼ŒæŸ¥è¯¢ä¹‹æ—¶å†å°†ç©ºæ ¼å»æ‰ã€‚æ‰€ä»¥ char ç±»å‹å­˜å‚¨çš„å­—ç¬¦ä¸²æœ«å°¾ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œvarchar ä¸é™äºæ­¤ã€‚  
  > 2. char(n) å›ºå®šé•¿åº¦ï¼Œchar(4) ä¸ç®¡æ˜¯å­˜å…¥å‡ ä¸ªå­—ç¬¦ï¼Œéƒ½å°†å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œvarchar æ˜¯å­˜å…¥çš„å®é™…å­—ç¬¦æ•° +1 ä¸ªå­—èŠ‚ï¼ˆn<=255ï¼‰æˆ– +2ä¸ªå­—èŠ‚(n>255)ï¼Œ
  æ‰€ä»¥ varchar(4),å­˜å…¥ 3 ä¸ªå­—ç¬¦å°†å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚  
  > 3. char ç±»å‹çš„å­—ç¬¦ä¸²æ£€ç´¢é€Ÿåº¦è¦æ¯” varchar ç±»å‹çš„å¿«ã€‚  
+ > varchar å’Œ textï¼š  
  > 1. varchar å¯æŒ‡å®š nï¼Œtext ä¸èƒ½æŒ‡å®šï¼Œå†…éƒ¨å­˜å‚¨ varchar æ˜¯å­˜å…¥çš„å®é™…å­—ç¬¦æ•° +1 ä¸ªå­—èŠ‚ï¼ˆn<=255ï¼‰æˆ– +2 ä¸ªå­—èŠ‚(n>255)ï¼Œtext æ˜¯å®é™…å­—ç¬¦æ•° +2 ä¸ªå­—èŠ‚ã€‚
  > 2. text ç±»å‹ä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚
  > 3. varchar å¯ç›´æ¥åˆ›å»ºç´¢å¼•ï¼Œtext åˆ›å»ºç´¢å¼•è¦æŒ‡å®šå‰å¤šå°‘ä¸ªå­—ç¬¦ã€‚varchar æŸ¥è¯¢é€Ÿåº¦å¿«äº text, åœ¨éƒ½åˆ›å»ºç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œtext çš„ç´¢å¼•ä¼¼ä¹ä¸èµ·ä½œç”¨ã€‚
  > 4. å­—æ®µé•¿åº¦ä½äº5000ä½¿ç”¨varchar(), å¤§äº5000ä½¿ç”¨text(é˜¿é‡Œè§„çº¦), ä¸”æŠ½ç¦»å•ç‹¬åšè¡¨
+ > blob å’Œ text:   
  > 1. BLOBå’Œtextå­˜å‚¨æ–¹å¼ä¸åŒï¼ŒTEXTä»¥æ–‡æœ¬æ–¹å¼å­˜å‚¨ï¼Œè‹±æ–‡å­˜å‚¨åŒºåˆ†å¤§å°å†™ï¼Œè€ŒBlobæ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨ï¼Œä¸åˆ†å¤§å°å†™ã€‚  
  > 2. BLOBå­˜å‚¨çš„æ•°æ®åªèƒ½æ•´ä½“è¯»å‡ºã€‚  
  > 3. TEXTå¯ä»¥æŒ‡å®šå­—ç¬¦é›†ï¼ŒBLOBä¸ç”¨æŒ‡å®šå­—ç¬¦é›†ã€‚  

## 2.2 çº¦æŸ
åœ¨ MySQL ä¸­ï¼Œä¸»è¦æ”¯æŒä»¥ä¸‹ 6 ç§çº¦æŸï¼š
1. ä¸»é”®çº¦æŸ  
ä¸»é”®çº¦æŸæ˜¯ä½¿ç”¨æœ€é¢‘ç¹çš„çº¦æŸã€‚åœ¨è®¾è®¡æ•°æ®è¡¨æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½ä¼šè¦æ±‚è¡¨ä¸­è®¾ç½®ä¸€ä¸ªä¸»é”®ã€‚  
ä¸»é”®æ˜¯è¡¨çš„ä¸€ä¸ªç‰¹æ®Šå­—æ®µï¼Œè¯¥å­—æ®µèƒ½å”¯ä¸€æ ‡è¯†è¯¥è¡¨ä¸­çš„æ¯æ¡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå­¦ç”Ÿä¿¡æ¯è¡¨ä¸­çš„å­¦å·æ˜¯å”¯ä¸€çš„ã€‚  
2. å¤–é”®çº¦æŸ  
   å¤–é”®çº¦æŸç»å¸¸å’Œä¸»é”®çº¦æŸä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚  
   ä¾‹å¦‚ï¼Œä¸€ä¸ªæ°´æœæ‘Šï¼Œåªæœ‰è‹¹æœã€æ¡ƒå­ã€æå­ã€è¥¿ç“œ 4 ç§æ°´æœï¼Œé‚£ä¹ˆï¼Œä½ æ¥åˆ°æ°´æœæ‘Šè¦ä¹°æ°´æœåªèƒ½é€‰æ‹©è‹¹æœã€æ¡ƒå­ã€æå­å’Œè¥¿ç“œï¼Œä¸èƒ½è´­ä¹°å…¶å®ƒçš„æ°´æœã€‚  
    > æ³¨æ„: é˜¿é‡Œè§„èŒƒè§„å®š, ç¦æ­¢ä½¿ç”¨å¤–é”®å’Œçº§è”, ä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³  
    > å› ä¸ºå¤–é”®å½±å“æ•°æ®åº“çš„æ’å…¥é€Ÿåº¦  
    > è€Œçº§è”æ›´æ–°æ˜¯å¼ºé˜»å¡  
    > éƒ½ä¸é€‚åˆåˆ†å¸ƒå¼/é«˜å¹¶å‘çš„é›†ç¾¤

    > å¦‚æœæŸäº›æ—§è¡¨æœ‰å¤–é”®æ€ä¹ˆåŠ?  
    > è§£å†³åŠæ³•: SET FOREIGN_KEY_CHECKS = 0;
3. å”¯ä¸€çº¦æŸ  
å”¯ä¸€çº¦æŸä¸ä¸»é”®çº¦æŸæœ‰ä¸€ä¸ªç›¸ä¼¼çš„åœ°æ–¹ï¼Œå°±æ˜¯å®ƒä»¬éƒ½èƒ½å¤Ÿç¡®ä¿åˆ—çš„å”¯ä¸€æ€§ã€‚ä¸ä¸»é”®çº¦æŸä¸åŒçš„æ˜¯ï¼Œå”¯ä¸€çº¦æŸåœ¨ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ªï¼Œå¹¶ä¸”è®¾ç½®å”¯ä¸€çº¦æŸçš„åˆ—æ˜¯å…è®¸æœ‰ç©ºå€¼çš„ï¼Œè™½ç„¶åªèƒ½æœ‰ä¸€ä¸ªç©ºå€¼ã€‚  
ä¾‹å¦‚ï¼Œåœ¨ç”¨æˆ·ä¿¡æ¯è¡¨ä¸­ï¼Œè¦é¿å…è¡¨ä¸­çš„ç”¨æˆ·åé‡åï¼Œå°±å¯ä»¥æŠŠç”¨æˆ·ååˆ—è®¾ç½®ä¸ºå”¯ä¸€çº¦æŸã€‚
4. æ£€æŸ¥çº¦æŸ  
æ£€æŸ¥çº¦æŸæ˜¯ç”¨æ¥æ£€æŸ¥æ•°æ®è¡¨ä¸­ï¼Œå­—æ®µå€¼æ˜¯å¦æœ‰æ•ˆçš„ä¸€ä¸ªæ‰‹æ®µã€‚  
ä¾‹å¦‚ï¼Œå­¦ç”Ÿä¿¡æ¯è¡¨ä¸­çš„å¹´é¾„å­—æ®µæ˜¯æ²¡æœ‰è´Ÿæ•°çš„ï¼Œå¹¶ä¸”æ•°å€¼ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ã€‚å¦‚æœæ˜¯å¤§å­¦ç”Ÿï¼Œå¹´é¾„ä¸€èˆ¬åº”è¯¥åœ¨ 18~30 å²ä¹‹é—´ã€‚åœ¨è®¾ç½®å­—æ®µçš„æ£€æŸ¥çº¦æŸæ—¶è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·èƒ½å¤Ÿå‡å°‘æ— æ•ˆæ•°æ®çš„è¾“å…¥ã€‚
5. éç©ºçº¦æŸ  
éç©ºçº¦æŸç”¨æ¥çº¦æŸè¡¨ä¸­çš„å­—æ®µä¸èƒ½ä¸ºç©ºã€‚ä¾‹å¦‚ï¼Œåœ¨å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­ï¼Œå¦‚æœä¸æ·»åŠ å­¦ç”Ÿå§“åï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•æ˜¯æ²¡æœ‰ç”¨çš„ã€‚
6. é»˜è®¤å€¼çº¦æŸ  
é»˜è®¤å€¼çº¦æŸç”¨æ¥çº¦æŸå½“æ•°æ®è¡¨ä¸­æŸä¸ªå­—æ®µä¸è¾“å…¥å€¼æ—¶ï¼Œè‡ªåŠ¨ä¸ºå…¶æ·»åŠ ä¸€ä¸ªå·²ç»è®¾ç½®å¥½çš„å€¼ã€‚

## 2.3 mysqlä¼˜åŒ–
1. é¿å…ä½¿ç”¨å‡ºç°3ä¸ª join ä»¥ä¸Šçš„è¯­å¥
2. ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–ä»£ç 
3. ç¡®ä¿æŸ¥è¯¢æ¡ä»¶è½åœ¨ç´¢å¼•ä¸Š
    > ä½¿ç”¨ Explain + SQLè¯­å¥æ¥ç¡®å®šç´¢å¼•æ•ˆæœ,   
    > consts > ref > range > index > all, è€Œæ ¹æ®é˜¿é‡Œè§„çº¦, åº”è‡³å°‘æ˜¯ range ç­‰çº§

    > ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ **https://learnku.com/articles/38889**  
    > a. è¿åæœ€ä½³å·¦å‰ç¼€æ³•åˆ™  
    > + æœªå‘½ä¸­å¤åˆç´¢å¼•  1, 2, 3  ç´¢å¼•åªå‘½ä¸­ 1, 12, 13, 123  
    > + like ä»¥é€šé…ç¬¦å¼€å¤´("%abc")  

    > b. åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ(è®¡ç®—, å‡½æ•°ç­‰ç­‰)  
    > c. ä½¿ç”¨äº† èŒƒå›´æŸ¥æ‰¾(> <) ä¸ç­‰äº(<> !=) ORæŸ¥æ‰¾ æˆ– NOT INæŸ¥æ‰¾
    > + è§£å†³åŠæ³•: ä½¿ç”¨like inç­‰æ›¿æ¢, æˆ–è€…ä½¿ç”¨å…¶ä»–æ•°æ®åº“   

    > d. ç±»å‹å¼‚å¸¸, å‘ç”Ÿç±»å‹è½¬æ¢ ä¾‹å¦‚å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸², è€ŒæŸ¥æ‰¾æ¡ä»¶ä¸ºæ•°å­—  
    > e. å­—æ®µå€¼ä¸º null, åŸåˆ™ä¸Šæˆ‘ä»¬åº”é¿å…ä»»ä½•å­—æ®µå­˜å‚¨ null å€¼
    > f. ç‰¹æ®Šæƒ…å†µ, mysql è®¤ä¸ºå…¨è¡¨æ›´å¿«çš„æ—¶å€™
    > g. order by / group by çš„å­—æ®µä¹Ÿéœ€è¦é¿å…ä¸Šè¿°æƒ…å†µ

4. åº”å°½é‡é¿å… in æ“ä½œ, è‹¥å®åœ¨éœ€è¦ä½¿ç”¨, æ§åˆ¶ in å…ƒç´ åœ¨1000ä¸ªä»¥å†…
5. é¿å…ä½¿ç”¨ select * / count(*) / sum(*) ç­‰æ–¹æ³•
    > åŸå› : 
    > + count(*) ä¼šç»Ÿè®¡å€¼ä¸º null çš„è¡Œ, 
    > + sum(*) ä¼šå‡ºç° nul å€¼, éœ€è¦è€ƒè™‘ NPE é—®é¢˜
    > + select * ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜: 
    >   + a. å¢åŠ æŸ¥è¯¢åˆ†æå™¨è§£ææˆæœ¬
    >   + b. å¢å‡å­—æ®µå®¹æ˜“ä¸ resultMap é…ç½®ä¸ä¸€è‡´
    >   + c. å¤šä½™å­—æ®µå¢åŠ ç½‘ç»œå¼€é”€
6. å‚è€ƒ[2.1 åŸºç¡€ç±»å‹](#21-åŸºç¡€ç±»å‹), åº”å°½é‡å‡†ç¡®é€‰æ‹©é•¿åº¦æ­£ç¡®çš„æ•°æ®ç±»å‹'
7. æ°¸è¿œå°æ ‡é©±åŠ¨å¤§è¡¨ï¼ˆå°çš„æ•°æ®é›†é©±åŠ¨å¤§çš„æ•°æ®é›†ï¼‰

### mysql æœ‰å“ªäº›ç´¢å¼•   ä»¥åŠå¦‚ä½•ä¼˜åŒ–å‘½ä¸­

#### 1. MySQL å¸¸è§ç´¢å¼•ç±»å‹

##### ğŸ”¹ 1.1 B-Tree ç´¢å¼•ï¼ˆæœ€å¸¸ç”¨ï¼‰

- **é»˜è®¤ç´¢å¼•ç±»å‹**ï¼ˆInnoDB/ MyISAMï¼‰ã€‚

- é€‚ç”¨äºï¼šç­‰å€¼æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ã€å‰ç¼€åŒ¹é…ã€æ’åºã€‚

- ç¤ºä¾‹ï¼š

  ```
  CREATE INDEX idx_user_name ON users(name);
  SELECT * FROM users WHERE name = 'Alice';
  ```

##### ğŸ”¹ 1.2 Hash ç´¢å¼•

- **Memory å¼•æ“**æ”¯æŒã€‚

- ç­‰å€¼æŸ¥è¯¢æ•ˆç‡é«˜ï¼ˆO(1)ï¼‰ã€‚

- ç¼ºç‚¹ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ / æ’åºã€‚

- ç¤ºä¾‹ï¼š

  ```
  CREATE INDEX idx_user_id USING HASH ON users(id);
  ```

##### ğŸ”¹ 1.3 å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰

- **MyISAMã€InnoDB** å¼•æ“æ”¯æŒã€‚

- é¢å‘é•¿æ–‡æœ¬å­—æ®µï¼ˆ`CHAR`ã€`VARCHAR`ã€`TEXT`ï¼‰ã€‚

- åº•å±‚ç”¨ **å€’æ’ç´¢å¼•**ï¼Œæ”¯æŒ BM25ã€‚

- ç¤ºä¾‹ï¼š

  ```
  CREATE FULLTEXT INDEX idx_content ON articles(content);
  SELECT * FROM articles WHERE MATCH(content) AGAINST('database' IN NATURAL LANGUAGE MODE);
  ```

##### ğŸ”¹ 1.4 ç©ºé—´ç´¢å¼•ï¼ˆSPATIALï¼‰

- MyISAM / InnoDB æ”¯æŒã€‚

- é¢å‘ GIS æ•°æ®ç±»å‹ï¼ˆ`POINT`, `GEOMETRY`ï¼‰ã€‚

- ç”¨ R-Tree å­˜å‚¨ã€‚

- ç¤ºä¾‹ï¼š

  ```
  CREATE SPATIAL INDEX idx_location ON places(location);
  ```

##### ğŸ”¹ 1.5 ä¸»é”®ç´¢å¼•ï¼ˆPrimary Keyï¼‰

- InnoDBï¼š**èšç°‡ç´¢å¼•**ï¼ˆClustered Indexï¼‰ï¼Œæ•°æ®æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾ã€‚
- MyISAMï¼šä¸»é”®ç´¢å¼•å’Œæ•°æ®åˆ†ç¦»ã€‚

##### ğŸ”¹ 1.6 å”¯ä¸€ç´¢å¼•ï¼ˆUNIQUEï¼‰

- ä¿è¯å­—æ®µå”¯ä¸€æ€§ï¼ŒæŸ¥è¯¢æ•ˆç‡æ¥è¿‘æ™®é€š B-Tree ç´¢å¼•ã€‚

- ç¤ºä¾‹ï¼š

  ```
  CREATE UNIQUE INDEX idx_email ON users(email);
  ```

##### ğŸ”¹ 1.7 ç»„åˆç´¢å¼•ï¼ˆComposite Indexï¼‰

- ç´¢å¼•å¤šä¸ªåˆ—ï¼Œéµå¾ª **æœ€å·¦å‰ç¼€åŸåˆ™**ã€‚

- ç¤ºä¾‹ï¼š

  ```
  CREATE INDEX idx_name_age ON users(name, age);
  ```

- æŸ¥è¯¢ä¼˜åŒ–ï¼š

  ```
  SELECT * FROM users WHERE name = 'Alice' AND age = 20;  -- å‘½ä¸­ç´¢å¼•
  SELECT * FROM users WHERE age = 20;                     -- ä¸èƒ½å®Œå…¨å‘½ä¸­
  ```

------

#### 2. å·¥å…·ä¸è¯Šæ–­

- `EXPLAIN`ï¼šæŸ¥çœ‹ SQL æ˜¯å¦èµ°ç´¢å¼•ã€‚
- `SHOW INDEX FROM table;`ï¼šæŸ¥çœ‹ç´¢å¼•ç»“æ„ã€‚
- æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šåˆ†ææœªå‘½ä¸­ç´¢å¼•çš„ SQLã€‚

###### 

## 2.4 mysqlé”
[å‚è€ƒèµ„æ–™1](https://www.modb.pro/db/41502): https://www.modb.pro/db/41502  
[å‚è€ƒèµ„æ–™2](https://www.cnblogs.com/jojop/p/13982679.html): https://www.cnblogs.com/jojop/p/13982679.html
### 2.4.1 åŠ é”æœºåˆ¶
ä¹è§‚é”ä¸æ‚²è§‚é”æ˜¯ä¸¤ç§å¹¶å‘æ§åˆ¶çš„æ€æƒ³ï¼Œå¯ç”¨äºè§£å†³ä¸¢å¤±æ›´æ–°é—®é¢˜  

ä¹è§‚é”ä¼šâ€œä¹è§‚åœ°â€å‡å®šå¤§æ¦‚ç‡ä¸ä¼šå‘ç”Ÿå¹¶å‘æ›´æ–°å†²çªï¼Œè®¿é—®ã€å¤„ç†æ•°æ®è¿‡ç¨‹ä¸­ä¸åŠ é”ï¼Œåªåœ¨æ›´æ–°æ•°æ®æ—¶å†æ ¹æ®ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³åˆ¤æ–­æ˜¯å¦æœ‰å†²çªï¼Œæœ‰åˆ™å¤„ç†ï¼Œæ— åˆ™æäº¤äº‹åŠ¡ã€‚ç”¨æ•°æ®ç‰ˆæœ¬ï¼ˆVersionï¼‰è®°å½•æœºåˆ¶å®ç°ï¼Œè¿™æ˜¯ä¹è§‚é”æœ€å¸¸ç”¨çš„ä¸€ç§å®ç°æ–¹å¼  

æ‚²è§‚é”ä¼šâ€œæ‚²è§‚åœ°â€å‡å®šå¤§æ¦‚ç‡ä¼šå‘ç”Ÿå¹¶å‘æ›´æ–°å†²çªï¼Œè®¿é—®ã€å¤„ç†æ•°æ®å‰å°±åŠ æ’ä»–é”ï¼Œåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­é”å®šæ•°æ®ï¼Œäº‹åŠ¡æäº¤æˆ–å›æ»šåæ‰é‡Šæ”¾é”ã€‚å¦å¤–ä¸ä¹è§‚é”ç›¸å¯¹åº”çš„ï¼Œæ‚²è§‚é”æ˜¯ç”±æ•°æ®åº“è‡ªå·±å®ç°äº†çš„ï¼Œè¦ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨æ•°æ®åº“çš„ç›¸å…³è¯­å¥å°±å¯ä»¥äº†ã€‚  

### 2.4.2 mysqlé”åˆ†ç±»
1. ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†ç±»ï¼š
+ è¯»é”ï¼ˆå…±äº«é”ï¼‰ï¼šé’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œï¼Œä¸ä¼šäº’ç›¸å½±å“
+ å†™é”ï¼ˆæ’ä»–é”ï¼‰ï¼šå½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”

2. ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†ç±»ï¼š  
ä¸ºäº†å°½å¯èƒ½æé«˜æ•°æ®åº“çš„å¹¶å‘åº¦ï¼Œæ¯æ¬¡é”å®šçš„æ•°æ®èŒƒå›´è¶Šå°è¶Šå¥½ï¼Œç†è®ºä¸Šæ¯æ¬¡åªé”å®šå½“å‰æ“ä½œçš„æ•°æ®çš„æ–¹æ¡ˆä¼šå¾—åˆ°æœ€å¤§çš„å¹¶å‘åº¦ï¼Œä½†æ˜¯ç®¡ç†é”æ˜¯å¾ˆè€—èµ„æºçš„äº‹æƒ…ï¼ˆæ¶‰åŠè·å–ï¼Œæ£€æŸ¥ï¼Œé‡Šæ”¾é”ç­‰åŠ¨ä½œï¼‰ï¼Œå› æ­¤æ•°æ®åº“ç³»ç»Ÿéœ€è¦åœ¨é«˜å¹¶å‘å“åº”å’Œç³»ç»Ÿæ€§èƒ½ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†â€œé”ç²’åº¦ï¼ˆLock granularityï¼‰â€çš„æ¦‚å¿µã€‚
   + è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼ˆMyISAM å’Œ MEMORY å­˜å‚¨å¼•æ“é‡‡ç”¨çš„æ˜¯è¡¨çº§é”ï¼‰ï¼›
   + è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜ï¼ˆInnoDB å­˜å‚¨å¼•æ“æ—¢æ”¯æŒè¡Œçº§é”ä¹Ÿæ”¯æŒè¡¨çº§é”ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ˜¯é‡‡ç”¨è¡Œçº§é”ï¼‰ï¼›
   + é¡µé¢é”ï¼šå¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚

1. ä»å¼•æ“å®ç°åˆ†ç±»
æ‰€æœ‰å¼•æ“å‡æ”¯æŒè¡¨é”, åªæœ‰InnoDBæ”¯æŒè¡Œé”, è€Œåªæœ‰BDBæ”¯æŒé¡µé”

### 2.4.3 mysql-Innodbé”ä»‹ç»
1. InnoDBè¡¨é”â€”â€”æ„å‘é”  
ç”±äºè¡¨é”å’Œè¡Œé”è™½ç„¶é”å®šèŒƒå›´ä¸åŒï¼Œä½†æ˜¯ä¼šç›¸äº’å†²çªã€‚å½“ä½ è¦åŠ è¡¨é”æ—¶ï¼ŒåŠ¿å¿…è¦å…ˆéå†è¯¥è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ’ä»–é”ã€‚è¿™ç§éå†æ£€æŸ¥çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸€ç§ä½æ•ˆçš„æ–¹å¼ï¼ŒMySQLå¼•å…¥äº†æ„å‘é”ï¼Œæ¥æ£€æµ‹è¡¨é”å’Œè¡Œé”çš„å†²çªã€‚  
æ„å‘é”ä¹Ÿæ˜¯è¡¨çº§é”ï¼Œåˆ†ä¸ºè¯»æ„å‘é”ï¼ˆISé”ï¼‰å’Œå†™æ„å‘é”ï¼ˆIXé”ï¼‰ã€‚å½“äº‹åŠ¡è¦åœ¨è®°å½•ä¸ŠåŠ ä¸Šè¡Œé”æ—¶ï¼Œè¦é¦–å…ˆåœ¨è¡¨ä¸ŠåŠ ä¸Šæ„å‘é”ã€‚è¿™æ ·åˆ¤æ–­è¡¨ä¸­æ˜¯å¦æœ‰è®°å½•æ­£åœ¨åŠ é”å°±å¾ˆç®€å•äº†ï¼Œåªè¦çœ‹ä¸‹è¡¨ä¸Šæ˜¯å¦æœ‰æ„å‘é”å°±è¡Œäº†ï¼Œä»è€Œå°±èƒ½æé«˜æ•ˆç‡ã€‚
æ„å‘é”ä¹‹é—´æ˜¯ä¸ä¼šäº§ç”Ÿå†²çªçš„ï¼Œå®ƒåªä¼šé˜»å¡è¡¨çº§è¯»é”æˆ–å†™é”ã€‚æ„å‘é”ä¸äºè¡Œçº§é”å‘ç”Ÿå†²çªã€‚

2. InnoDBä¸­çš„è¡Œé”
   + å…±äº«é”ï¼ˆSï¼‰ï¼šåŠ äº†é”çš„è®°å½•ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½èƒ½å»è¯»å–ä½†ä¸èƒ½ä¿®æ”¹ï¼ŒåŒæ—¶é˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’ä»–é”ï¼›
   + æ’ä»–é”ï¼ˆXï¼‰ï¼šå…è®¸å·²ç»è·å¾—æ’ä»–é”çš„äº‹åŠ¡å»æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡å–å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«è¯»é”å’Œæ’ä»–å†™é”ï¼›

### 2.4.4 mysql-Innodbé”å®ç°
+ æ„å‘é”æ˜¯ InnoDB è‡ªåŠ¨åŠ çš„ï¼Œä¸éœ€è¦ç”¨æˆ·å¹²é¢„ï¼›
+ å¯¹äºUPDATEã€DELETEå’ŒINSERTè¯­å¥ï¼ŒInnoDBä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ•°æ®é›†åŠ ä¸Šæ’ä»–é”ï¼›
+ å¯¹äºæ™®é€šçš„SELECTè¯­å¥ï¼ŒInnoDBä¸ä¼šåŠ ä»»ä½•é”ï¼›äº‹åŠ¡å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾ç¤ºç»™è®°å½•é›†æ·»åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼š
  + å…±äº«é”ï¼ˆSï¼‰ï¼šselect * from table_name where ... lock in share modeã€‚æ­¤æ—¶å…¶ä»– session ä»ç„¶å¯ä»¥æŸ¥è¯¢è®°å½•ï¼Œå¹¶ä¹Ÿå¯ä»¥å¯¹è¯¥è®°å½•åŠ  share mode çš„å…±äº«é”ã€‚ä½†æ˜¯å¦‚æœå½“å‰äº‹åŠ¡éœ€è¦å¯¹è¯¥è®°å½•è¿›è¡Œæ›´æ–°æ“ä½œï¼Œåˆ™å¾ˆæœ‰å¯èƒ½é€ æˆæ­»é”ã€‚
  + æ’ä»–é”ï¼ˆXï¼‰ï¼šselect * from table_name where ... for updateã€‚å…¶ä»–sessionå¯ä»¥æŸ¥è¯¢è®°å½•ï¼Œä½†æ˜¯ä¸èƒ½å¯¹è¯¥è®°å½•åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼Œåªèƒ½ç­‰å¾…é”é‡Šæ”¾ååœ¨åŠ é”ã€‚

> æ³¨æ„: 
> + ç´¢å¼•å¤±æ•ˆä¼šå¯¼è‡´è¡Œé”å˜è¡¨é”
> + for update ä»…é€‚ç”¨äºInnoDBï¼Œä¸”å¿…é¡»åœ¨äº‹åŠ¡å—(BEGIN/COMMIT)ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚

æ‰€ä»¥ç»¼ä¸Š, æˆ‘ä»¬åªç”¨å…³æ³¨ mysql InnoDB select è¯­å¥çš„è¡Œé”å®ç°ã€‚ 
è€Œåœ¨ä¸åŒæƒ…å½¢ä¸‹, InnoDBä¼šæ ¹æ®ç»“æœä¸åŒ, è°ƒç”¨ä¸åŒçš„è¡Œé”ç®—æ³•, å®ç°ä¸åŒçš„é”æ¨¡å¼ã€‚
+ è®°å½•é”(Record Locks)
  1. å•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚å¯¹ç´¢å¼•é¡¹åŠ é”ï¼Œé”å®šç¬¦åˆæ¡ä»¶çš„è¡Œã€‚å…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å’Œåˆ é™¤åŠ é”é¡¹ï¼›
  ```
  # åœ¨ id=1 çš„è®°å½•ä¸ŠåŠ ä¸Šè®°å½•é”ï¼Œä»¥é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤ id=1 è¿™ä¸€è¡Œ  
  SELECT * FROM table WHERE id = 1 FOR UPDATE;
  ```
  2. åœ¨é€šè¿‡ ä¸»é”®ç´¢å¼• ä¸ å”¯ä¸€ç´¢å¼• å¯¹æ•°æ®è¡Œè¿›è¡Œ UPDATE æ“ä½œæ—¶ï¼Œä¹Ÿä¼šå¯¹è¯¥è¡Œæ•°æ®åŠ è®°å½•é”ï¼š
  ```
  -- id åˆ—ä¸ºä¸»é”®åˆ—æˆ–å”¯ä¸€ç´¢å¼•åˆ—
  UPDATE SET age = 50 WHERE id = 1;
  ```
+ é—´éš™é”ï¼ˆGap Locksï¼‰  
  + å½“æˆ‘ä»¬ä½¿ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ã€‚å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€œé—´éš™â€ã€‚InnoDB ä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ã€‚    
  + å¯¹ç´¢å¼•é¡¹ä¹‹é—´çš„â€œé—´éš™â€åŠ é”ï¼Œé”å®šè®°å½•çš„èŒƒå›´ï¼ˆå¯¹ç¬¬ä¸€æ¡è®°å½•å‰çš„é—´éš™æˆ–æœ€åä¸€æ¡å°†è®°å½•åçš„é—´éš™åŠ é”ï¼‰ï¼Œä¸åŒ…å«ç´¢å¼•é¡¹æœ¬èº«ã€‚å…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨é”èŒƒå›´å†…æ’å…¥æ•°æ®ï¼Œè¿™æ ·å°±é˜²æ­¢äº†åˆ«çš„äº‹åŠ¡æ–°å¢å¹»å½±è¡Œã€‚  
  + é—´éš™é”åŸºäºéå”¯ä¸€ç´¢å¼•ï¼Œå®ƒé”å®šä¸€æ®µèŒƒå›´å†…çš„ç´¢å¼•è®°å½•ã€‚é—´éš™é”åŸºäºä¸‹é¢å°†ä¼šæåˆ°çš„Next-Key Lockingç®—æ³•ï¼Œè¯·åŠ¡å¿…ç‰¢è®°ï¼šä½¿ç”¨é—´éš™é”é”ä½çš„æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿™ä¸ªåŒºé—´ä¸­çš„æ¯ä¸€æ¡æ•°æ®ã€‚
  + é—´éš™é”çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åŒä¸€äº‹åŠ¡çš„ä¸¤æ¬¡å½“å‰è¯»ï¼Œå‡ºç°å¹»è¯»çš„æƒ…å†µ
```
  -- æ‰€æœ‰åœ¨ï¼ˆ1ï¼Œ10ï¼‰åŒºé—´å†…çš„è®°å½•è¡Œéƒ½ä¼šè¢«é”ä½ï¼Œæ‰€æœ‰id ä¸º 2ã€3ã€4ã€5ã€6ã€7ã€8ã€9 çš„æ•°æ®è¡Œçš„æ’å…¥ä¼šè¢«é˜»å¡ï¼Œä½†æ˜¯ 1 å’Œ 10 ä¸¤æ¡è®°å½•è¡Œå¹¶ä¸ä¼šè¢«é”ä½ã€‚
  SELECT * FROM table WHERE id BETWEN 1 AND 10 FOR UPDATE;
```

+ ä¸´é”®é”(Next-key Locks)
  + ä¸´é”®é”ï¼Œæ˜¯è®°å½•é”ä¸é—´éš™é”çš„ç»„åˆï¼Œå®ƒçš„å°é”èŒƒå›´ï¼Œæ—¢åŒ…å«ç´¢å¼•è®°å½•ï¼ŒåˆåŒ…å«ç´¢å¼•åŒºé—´ã€‚(ä¸´é”®é”çš„ä¸»è¦ç›®çš„ï¼Œä¹Ÿæ˜¯ä¸ºäº†é¿å…å¹»è¯»(Phantom Read)ã€‚å¦‚æœæŠŠäº‹åŠ¡çš„éš”ç¦»çº§åˆ«é™çº§ä¸ºRCï¼Œä¸´é”®é”åˆ™ä¹Ÿä¼šå¤±æ•ˆã€‚)
  + ä¸´é”®é”å¯ä»¥ç†è§£ä¸ºä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ç§ç‰¹æ®Šçš„ç®—æ³•ã€‚é€šè¿‡ä¸´å»ºé”å¯ä»¥è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚æ¯ä¸ªæ•°æ®è¡Œä¸Šçš„éå”¯ä¸€ç´¢å¼•åˆ—ä¸Šéƒ½ä¼šå­˜åœ¨ä¸€æŠŠä¸´é”®é”ï¼Œå½“æŸä¸ªäº‹åŠ¡æŒæœ‰è¯¥æ•°æ®è¡Œçš„ä¸´é”®é”æ—¶ï¼Œä¼šé”ä½ä¸€æ®µå·¦å¼€å³é—­åŒºé—´çš„æ•°æ®ã€‚éœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼ŒInnoDBä¸­è¡Œçº§é”æ˜¯åŸºäºç´¢å¼•å®ç°çš„ï¼Œä¸´é”®é”åªä¸éå”¯ä¸€ç´¢å¼•åˆ—æœ‰å…³ï¼Œåœ¨å”¯ä¸€ç´¢å¼•åˆ—ï¼ˆåŒ…æ‹¬ä¸»é”®åˆ—ï¼‰ä¸Šä¸å­˜åœ¨ä¸´é”®é”ã€‚
  + å¯¹äºè¡Œçš„æŸ¥è¯¢ï¼Œéƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚

## 2.5 äº‹åŠ¡éš”ç¦»
[å‚è€ƒé“¾æ¥](https://juejin.cn/post/6844903665367547918):https://juejin.cn/post/6844903665367547918  
[å‚è€ƒé“¾æ¥](https://cloud.tencent.com/developer/article/1450773):https://cloud.tencent.com/developer/article/1450773
### 2.5.1 æ•°æ®åº“äº‹åŠ¡ç‰¹å¾
æ•°æ®åº“äº‹åŠ¡ç‰¹å¾ï¼Œå³ ACID :   
+ A Atomicity åŸå­æ€§  
äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ€§è´¨çš„æ“ä½œå•å…ƒï¼Œäº‹åŠ¡é‡Œé¢çš„å¯¹æ•°æ®åº“çš„æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œ
+ C Consistent ä¸€è‡´æ€§  
åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œå®Œæˆä¹‹åï¼Œæ•°æ®éƒ½å¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ï¼Œå¿…é¡»ä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®å¿…é¡»ç¬¦åˆæ•°æ®åº“çš„è§„åˆ™ã€‚
+ I Isolation éš”ç¦»æ€§  
æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒäº‹å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œéš”ç¦»æ€§ä¿è¯å„ä¸ªäº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº‹åŠ¡å¤„ç†æ—¶çš„ä¸­é—´çŠ¶æ€å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ï¼Œä»¥æ­¤é˜²æ­¢å‡ºç°æ•°æ®ä¸ä¸€è‡´çŠ¶æ€ã€‚å¯é€šè¿‡äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ï¼šåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰
+ D Durable æŒä¹…æ€§  
ä¸€ä¸ªäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå…¶å¯¹æ•°æ®åº“çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

### 2.5.2 MySQL æ•°æ®éš”ç¦»çº§åˆ«
+ MySQL é‡Œæœ‰å››ä¸ªéš”ç¦»çº§åˆ«ï¼šRead uncommttiedï¼ˆå¯ä»¥è¯»å–æœªæäº¤æ•°æ®ï¼‰ã€Read committedï¼ˆå¯ä»¥è¯»å–å·²æäº¤æ•°æ®ï¼‰ã€Repeatable readï¼ˆå¯é‡å¤è¯»ï¼‰ã€Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰ã€‚ä½¿ç”¨ select @@tx_isolation; å¯ä»¥æŸ¥çœ‹ MySQL é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚è¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚
+ åœ¨ InnoDB ä¸­ï¼Œé»˜è®¤ä¸º Repeatable çº§åˆ«ï¼ŒInnoDB ä¸­ä½¿ç”¨ä¸€ç§æˆ‘ä»¬åœ¨[2.4.4 mysql-Innodbé”å®ç°](#244-mysql-innodbé”å®ç°)ä¸­è¢«ç§°ä¸º next-key locking çš„ç­–ç•¥æ¥é¿å…å¹»è¯»ï¼ˆphantomï¼‰ç°è±¡çš„äº§ç”Ÿã€‚  
+ ä¸ºäº†è§£å†³ä¸å¯é‡å¤è¯»ï¼Œinnodbé‡‡ç”¨äº†MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚MVCCæ˜¯åˆ©ç”¨åœ¨æ¯æ¡æ•°æ®åé¢åŠ äº†éšè—çš„ä¸¤åˆ—ï¼ˆåˆ›å»ºç‰ˆæœ¬å·å’Œåˆ é™¤ç‰ˆæœ¬å·ï¼‰ï¼Œæ¯ä¸ªäº‹åŠ¡åœ¨å¼€å§‹çš„æ—¶å€™éƒ½ä¼šæœ‰ä¸€ä¸ªé€’å¢çš„ç‰ˆæœ¬å·ã€‚æ³¨æ„, è¿™ç§æ–¹å¼æ˜¯è‡ªåŠ¨çš„ã€‚
![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/27/1657927364adccc5~tplv-t2oaga2asx-watermark.awebp)

1. Read uncommitted è¯»æœªæäº¤

    å…¬å¸å‘å·¥èµ„äº†ï¼Œé¢†å¯¼æŠŠ5000å…ƒæ‰“åˆ°singoçš„è´¦å·ä¸Šï¼Œä½†æ˜¯è¯¥äº‹åŠ¡å¹¶æœªæäº¤ï¼Œè€Œsingoæ­£å¥½å»æŸ¥çœ‹è´¦æˆ·ï¼Œå‘ç°å·¥èµ„å·²ç»åˆ°è´¦ï¼Œæ˜¯5000å…ƒæ•´ï¼Œéå¸¸é«˜ å…´ã€‚å¯æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œé¢†å¯¼å‘ç°å‘ç»™singoçš„å·¥èµ„é‡‘é¢ä¸å¯¹ï¼Œæ˜¯2000å…ƒï¼Œäºæ˜¯è¿…é€Ÿå›æ»šäº†äº‹åŠ¡ï¼Œä¿®æ”¹é‡‘é¢åï¼Œå°†äº‹åŠ¡æäº¤ï¼Œæœ€åsingoå®é™…çš„å·¥èµ„åªæœ‰ 2000å…ƒï¼Œsingoç©ºæ¬¢å–œä¸€åœºã€‚

    å‡ºç°ä¸Šè¿°æƒ…å†µï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„è„è¯» ï¼Œä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡ï¼Œâ€œäº‹åŠ¡Aï¼šé¢†å¯¼ç»™singoå‘å·¥èµ„â€ã€â€œäº‹åŠ¡Bï¼šsingoæŸ¥è¯¢å·¥èµ„è´¦æˆ·â€ï¼Œäº‹åŠ¡Bè¯»å–äº†äº‹åŠ¡Aå°šæœªæäº¤çš„æ•°æ®ã€‚

    å½“éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRead uncommitted æ—¶ï¼Œå°±å¯èƒ½å‡ºç°è„è¯»ï¼Œå¦‚ä½•é¿å…è„è¯»ï¼Œè¯·çœ‹ä¸‹ä¸€ä¸ªéš”ç¦»çº§åˆ«ã€‚

2. Read committed è¯»æäº¤

    singoæ‹¿ç€å·¥èµ„å¡å»æ¶ˆè´¹ï¼Œç³»ç»Ÿè¯»å–åˆ°å¡é‡Œç¡®å®æœ‰2000å…ƒï¼Œè€Œæ­¤æ—¶å¥¹çš„è€å©†ä¹Ÿæ­£å¥½åœ¨ç½‘ä¸Šè½¬è´¦ï¼ŒæŠŠsingoå·¥èµ„å¡çš„2000å…ƒè½¬åˆ°å¦ä¸€è´¦æˆ·ï¼Œå¹¶åœ¨ singoä¹‹å‰æäº¤äº†äº‹åŠ¡ï¼Œå½“singoæ‰£æ¬¾æ—¶ï¼Œç³»ç»Ÿæ£€æŸ¥åˆ°singoçš„å·¥èµ„å¡å·²ç»æ²¡æœ‰é’±ï¼Œæ‰£æ¬¾å¤±è´¥ï¼Œsingoååˆ†çº³é—·ï¼Œæ˜æ˜å¡é‡Œæœ‰é’±ï¼Œä¸ºä½•......

    å‡ºç°ä¸Šè¿°æƒ…å†µï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„ä¸å¯é‡å¤è¯» ï¼Œä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡ï¼Œâ€œäº‹åŠ¡Aï¼šsingoæ¶ˆè´¹â€ã€â€œäº‹åŠ¡Bï¼šsingoçš„è€å©†ç½‘ä¸Šè½¬è´¦â€ï¼Œäº‹åŠ¡Aäº‹å…ˆè¯»å–äº†æ•°æ®ï¼Œäº‹åŠ¡Bç´§æ¥äº†æ›´æ–°äº†æ•°æ®ï¼Œå¹¶æäº¤äº†äº‹åŠ¡ï¼Œè€Œäº‹åŠ¡Aå†æ¬¡è¯»å–è¯¥æ•°æ®æ—¶ï¼Œæ•°æ®å·²ç»å‘ç”Ÿäº†æ”¹å˜ã€‚

    å½“éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRead committed æ—¶ï¼Œé¿å…äº†è„è¯»ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆä¸å¯é‡å¤è¯»ã€‚

    å¤§å¤šæ•°æ•°æ®åº“çš„é»˜è®¤çº§åˆ«å°±æ˜¯Read committedï¼Œæ¯”å¦‚Sql Server , Oracleã€‚å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»è¿™ä¸€é—®é¢˜ï¼Œè¯·çœ‹ä¸‹ä¸€ä¸ªéš”ç¦»çº§åˆ«ã€‚

3. Repeatable read é‡å¤è¯»

    åœ¨å¯¹äºæ•°æ®åº“ä¸­çš„æŸä¸ªæ•°æ®ï¼Œä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…å¤šæ¬¡æŸ¥è¯¢å´è¿”å›äº†ä¸åŒçš„æ•°æ®å€¼ï¼Œè¿™æ˜¯ç”±äºåœ¨æŸ¥è¯¢é—´éš”ï¼Œè¢«å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹å¹¶æäº¤äº†ã€‚

    å½“éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRepeatable read æ—¶ï¼Œå¯ä»¥é¿å…ä¸å¯é‡å¤è¯»ã€‚å½“singoæ‹¿ç€å·¥èµ„å¡å»æ¶ˆè´¹æ—¶ï¼Œä¸€æ—¦ç³»ç»Ÿå¼€å§‹è¯»å–å·¥èµ„å¡ä¿¡æ¯ï¼ˆå³äº‹åŠ¡å¼€å§‹ï¼‰ï¼Œsingoçš„è€å©†å°±ä¸å¯èƒ½å¯¹è¯¥è®°å½•è¿›è¡Œä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯singoçš„è€å©†ä¸èƒ½åœ¨æ­¤æ—¶è½¬è´¦ã€‚

    è™½ç„¶Repeatable readé¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œä½†è¿˜æœ‰å¯èƒ½å‡ºç°å¹»è¯» ã€‚

    singoçš„è€å©†å·¥ä½œåœ¨é“¶è¡Œéƒ¨é—¨ï¼Œå¥¹æ—¶å¸¸é€šè¿‡é“¶è¡Œå†…éƒ¨ç³»ç»ŸæŸ¥çœ‹singoçš„ä¿¡ç”¨å¡æ¶ˆè´¹è®°å½•ã€‚æœ‰ä¸€å¤©ï¼Œå¥¹æ­£åœ¨æŸ¥è¯¢åˆ°singoå½“æœˆä¿¡ç”¨å¡çš„æ€»æ¶ˆè´¹é‡‘é¢ ï¼ˆselect sum(amount) from transaction where month = æœ¬æœˆï¼‰ä¸º80å…ƒï¼Œè€Œsingoæ­¤æ—¶æ­£å¥½åœ¨å¤–é¢èƒ¡åƒæµ·å¡ååœ¨æ”¶é“¶å°ä¹°å•ï¼Œæ¶ˆè´¹1000å…ƒï¼Œå³æ–°å¢äº†ä¸€æ¡1000å…ƒçš„æ¶ˆè´¹è®°å½•ï¼ˆinsert transaction ... ï¼‰ï¼Œå¹¶æäº¤äº†äº‹åŠ¡ï¼Œéšåsingoçš„è€å©†å°†singoå½“æœˆä¿¡ç”¨å¡æ¶ˆè´¹çš„æ˜ç»†æ‰“å°åˆ°A4çº¸ä¸Šï¼Œå´å‘ç°æ¶ˆè´¹æ€»é¢ä¸º1080å…ƒï¼Œsingoçš„è€å©†å¾ˆè¯§å¼‚ï¼Œä»¥ä¸ºå‡º ç°äº†å¹»è§‰ï¼Œå¹»è¯»å°±è¿™æ ·äº§ç”Ÿäº†ã€‚

    æ³¨ï¼šMysqlçš„é»˜è®¤éš”ç¦»çº§åˆ«å°±æ˜¯Repeatable readã€‚

    ä¸å¯é‡å¤è¯»å’Œè„è¯»çš„åŒºåˆ«æ˜¯ï¼šè„è¯»æ˜¯æŸä¸€äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„è„æ•°æ®ï¼Œè€Œä¸å¯é‡å¤è¯»åˆ™æ˜¯è¯»å–äº†å‰ä¸€äº‹åŠ¡æäº¤çš„æ•°æ®ã€‚

    å¹»è¯»å’Œä¸å¯é‡å¤è¯»éƒ½æ˜¯è¯»å–äº†å¦ä¸€æ¡å·²ç»æäº¤çš„äº‹åŠ¡ï¼ˆè¿™ç‚¹å°±è„è¯»ä¸åŒï¼‰ï¼Œæ‰€ä¸åŒçš„æ˜¯ä¸å¯é‡å¤è¯»æŸ¥è¯¢çš„éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®é¡¹ï¼Œè€Œå¹»è¯»é’ˆå¯¹çš„æ˜¯ä¸€æ‰¹æ•°æ®æ•´ä½“ï¼ˆæ¯”å¦‚æ•°æ®çš„ä¸ªæ•°ï¼‰ã€‚

4. Serializable åºåˆ—åŒ–ï¼ˆä¸²è¡ŒåŒ–ï¼‰

    Serializable æ˜¯æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒåŒæ—¶ä»£ä»·ä¹ŸèŠ±è´¹æœ€é«˜ï¼Œæ€§èƒ½å¾ˆä½ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ï¼Œåœ¨è¯¥çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡é¡ºåºæ‰§è¡Œï¼Œä¸ä»…å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œè¿˜é¿å…äº†å¹»è¯»ã€‚

### 2.5.3 è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»çš„æ¦‚å¿µ
1. è„è¯»ï¼ˆè¯»å–æœªæäº¤æ•°æ®ï¼‰  
Aäº‹åŠ¡è¯»å–Bäº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœBäº‹åŠ¡å‘ç”Ÿé”™è¯¯å¹¶æ‰§è¡Œå›æ»šæ“ä½œï¼Œé‚£ä¹ˆAäº‹åŠ¡è¯»å–åˆ°çš„æ•°æ®å°±æ˜¯è„æ•°æ®ã€‚å°±å¥½åƒåŸæœ¬çš„æ•°æ®æ¯”è¾ƒå¹²å‡€ã€çº¯ç²¹ï¼Œæ­¤æ—¶ç”±äºBäº‹åŠ¡æ›´æ”¹äº†å®ƒï¼Œè¿™ä¸ªæ•°æ®å˜å¾—ä¸å†çº¯ç²¹ã€‚è¿™ä¸ªæ—¶å€™Aäº‹åŠ¡ç«‹å³è¯»å–äº†è¿™ä¸ªè„æ•°æ®ï¼Œä½†äº‹åŠ¡Bè‰¯å¿ƒå‘ç°ï¼Œåˆç”¨å›æ»šæŠŠæ•°æ®æ¢å¤æˆåŸæ¥å¹²å‡€ã€çº¯ç²¹çš„æ ·å­ï¼Œè€Œäº‹åŠ¡Aå´ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯äº‹åŠ¡Aè¯»å–äº†æ­¤æ¬¡çš„è„æ•°æ®ï¼Œç§°ä¸ºè„è¯»ã€‚è¿™ç§æƒ…å†µå¸¸å‘ç”Ÿäºè½¬è´¦ä¸å–æ¬¾æ“ä½œä¸­ã€‚
2. å¹»è¯»ï¼ˆå‰åå¤šæ¬¡è¯»å–ï¼Œæ•°æ®æ€»é‡ä¸ä¸€è‡´ï¼‰  
äº‹åŠ¡Aåœ¨æ‰§è¡Œè¯»å–æ“ä½œï¼Œéœ€è¦ä¸¤æ¬¡ç»Ÿè®¡æ•°æ®çš„æ€»é‡ï¼Œå‰ä¸€æ¬¡æŸ¥è¯¢æ•°æ®æ€»é‡åï¼Œæ­¤æ—¶äº‹åŠ¡Bæ‰§è¡Œäº†æ–°å¢æ•°æ®çš„æ“ä½œå¹¶æäº¤åï¼Œè¿™ä¸ªæ—¶å€™äº‹åŠ¡Aè¯»å–çš„æ•°æ®æ€»é‡å’Œä¹‹å‰ç»Ÿè®¡çš„ä¸ä¸€æ ·ï¼Œå°±åƒäº§ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œå¹³ç™½æ— æ•…çš„å¤šäº†å‡ æ¡æ•°æ®ï¼Œæˆä¸ºå¹»è¯»ã€‚
3. ä¸å¯é‡å¤è¯»ï¼ˆå‰åå¤šæ¬¡è¯»å–ï¼Œæ•°æ®å†…å®¹ä¸ä¸€è‡´ï¼‰  
äº‹åŠ¡Aåœ¨æ‰§è¡Œè¯»å–æ“ä½œï¼Œç”±æ•´ä¸ªäº‹åŠ¡Aæ¯”è¾ƒå¤§ï¼Œå‰åè¯»å–åŒä¸€æ¡æ•°æ®éœ€è¦ç»å†å¾ˆé•¿çš„æ—¶é—´ã€‚è€Œåœ¨äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–æ•°æ®ï¼Œäº‹åŠ¡Bæ‰§è¡Œæ›´æ”¹æ“ä½œï¼Œæ­¤æ—¶äº‹åŠ¡Aç¬¬äºŒæ¬¡è¯»å–, å’Œä¹‹å‰çš„æ•°æ®ä¸ä¸€æ ·äº†ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸é‡å¤äº†ï¼Œç³»ç»Ÿä¸å¯ä»¥è¯»å–åˆ°é‡å¤çš„æ•°æ®ï¼Œæˆä¸ºä¸å¯é‡å¤è¯»ã€‚

## 2.6 èŒƒå¼
è¦æƒ³è®¾è®¡ä¸€ä¸ªç»“æ„åˆç†çš„å…³ç³»å‹æ•°æ®åº“ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„èŒƒå¼ã€‚
ç›®å‰å…³ç³»æ•°æ®åº“æœ‰å…­ç§èŒƒå¼ï¼šç¬¬ä¸€èŒƒå¼(1NF)ã€ç¬¬äºŒèŒƒå¼(2NF)ã€ç¬¬ä¸‰èŒƒå¼(3NF)ã€å·´æ–¯-ç§‘å¾·èŒƒå¼(BCNF)ã€ç¬¬å››èŒƒå¼(4NF)å’Œç¬¬äº”èŒƒå¼(5NFï¼Œåˆç§°å®Œç¾èŒƒå¼)ã€‚  
+ ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªåˆ—éƒ½ä¸å¯ä»¥å†æ‹†åˆ†ã€‚è¦æ±‚æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ã€‚(ç¡®ä¿æ¯åˆ—ä¿æŒåŸå­æ€§)  
+ ç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸èƒ½æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚éœ€è¦ç¡®ä¿æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å’Œä¸»é”®ç›¸å…³ï¼Œè€Œä¸èƒ½åªä¸ä¸»é”®çš„æŸä¸€éƒ¨åˆ†ç›¸å…³(ä¸»è¦é’ˆå¯¹è”åˆä¸»é”®è€Œè¨€)ã€‚  
+ ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—åªä¾èµ–äºä¸»é”®ï¼Œä¸ä¾èµ–äºå…¶ä»–éä¸»é”®ã€‚ç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—æ•°æ®éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸èƒ½é—´æ¥ç›¸å…³ã€‚  

## 2.7 Mysqlç»éªŒ
1. resultMapå¯ä»¥è®©ä¸‹åˆ’çº¿å‘½åçš„mysqlè½¬ä¹‰åˆ°ä¸‹åˆ’çº¿å‘½åçš„JavaBean
2. ObjectUtil.isNotEmptyå¯ä»¥ç”¨Iterableåˆ¤æ–­é›†åˆ
3. var(String... args) ä¸å®šé•¿å‚æ•°é›†ï¼Œæˆ–è€…å«å˜é•¿å‚æ•° 
4.  left join åœ¨ on ååŠ æ¡ä»¶ å’Œwhere ååŠ æ¡ä»¶çš„å½±å“
on åé¢ ç›´æ¥åŠ æ¡ä»¶çš„è¯ï¼Œä¸ä¼šå¯¹å·¦è¾¹çš„è¡¨äº§ç”Ÿå½±å“ï¼Œonæ¡ä»¶æ˜¯åœ¨å·¦å…³è”æ—¶å€™çš„æ¡ä»¶ï¼Œä¸ç®¡å¦‚ä½•éƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­çš„è®°å½•;
where åŠ æ¡ä»¶ æ‰ä¼šå¯¹å·¦è¾¹çš„è¡¨ ç”Ÿæ•ˆã€‚whereæ¡ä»¶æ˜¯å…³è”æŸ¥è¯¢ä¹‹åçš„æ¡ä»¶
on æ¡ä»¶æ˜¯åœ¨ç”Ÿæˆä¸´æ—¶è¡¨æ—¶ä½¿ç”¨çš„æ¡ä»¶ï¼Œå®ƒä¸ç®¡ on ä¸­çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œéƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­çš„è®°å½•ã€‚where æ¡ä»¶æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆå¥½åï¼Œå†å¯¹ä¸´æ—¶è¡¨è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶ã€‚è¿™æ—¶å·²ç»æ²¡æœ‰ left join çš„å«ä¹‰ï¼ˆå¿…é¡»è¿”å›å·¦è¾¹è¡¨çš„è®°å½•ï¼‰äº†ï¼Œæ¡ä»¶ä¸ä¸ºçœŸçš„å°±å…¨éƒ¨è¿‡æ»¤æ‰ã€‚
5. åšå†—ä½™çš„åªæœ‰ä¸¤ç§, 1æ˜¯ä¸ä¼šå˜çš„å­—æ®µ  2æ˜¯éœ€è¦è®°å½•å½“æ—¶çŠ¶æ€çš„å­—æ®µ
6. å¦‚éœ€è€ƒè™‘æ•°ç™¾ä¸‡çº§çš„å¤§æ•°æ®æœˆç»Ÿè®¡çš„éœ€æ±‚, 
   + æ–¹æ¡ˆ1: 
        + ä½¿ç”¨è‡ªå¢id, å…ˆæŸ¥å¼€å§‹æ—¥æœŸçš„id, å†æŸ¥ç»“æŸæ—¥æœŸçš„id, æœ€åæ ¹æ®idèŒƒå›´å†æ¥æŸ¥æ•°æ®, ç¼©å°è¡¨çš„æ‰«æèŒƒå›´
        + å¹¶åˆ©ç”¨redisè‡ªå¢åºåˆ—ç­‰æŠ€æœ¯æ§åˆ¶åˆ†å¸ƒå¼çš„è‡ªå¢é•¿
   + æ–¹æ¡ˆ2: åœ¨è€è¡¨é‡Œ, æ–°å¢ä¸€ä¸ªå­—æ®µ, ä½¿ç”¨æ—¶é—´æˆ³æŸ¥æ‰¾
   + æ–¹æ¡ˆ3: ä½¿ç”¨r-treeäºŒç»´æŸ¥è¯¢ https://ruby-china.org/topics/34571
   è¿™ä¸‰ä¸ªæ–¹æ¡ˆéƒ½æ˜¯åŸºäºsqlçº¿æ€§æŸ¥æ‰¾è¾ƒå¤šç»´æŸ¥æ‰¾æ›´å¿«
   + æ–¹æ¡ˆ4: likeRight æœˆä»½
7. mybatis listè¿”å›nullå…ƒç´ , æ˜¯å› ä¸ºmysqlæŸ¥å‡ºäº†nullå€¼
8. MyBatisSystemException: nested exception is org.apache.ibatis.binding.BindingException: Parameter 'paramType_Gr8re1Ee' not found. Available parameters are [ew, param1]


9.  updateå’Œdeleteè¯­å¥éƒ½ä¸èƒ½åŠ è¡¨åˆ«å, å³ä¸èƒ½ä½¿ç”¨c.xxxçš„å½¢å¼
10. mysql dateæ ¼å¼åŒ–
```
æ—¥æœŸ->å­—ç¬¦ä¸²: DATE_FORMAT(start_time,'%Y-%m-%d %h:%i:%s')
ä»»æ„æ—¥æœŸæ ¼å¼å­—ç¬¦ä¸²->date: date(start_time_str)
æ—¥æœŸæ ¼å¼å­—ç¬¦ä¸²æŒ‰æ ¼å¼->dateTime: str_to_date(start_time_str, '%Y-%m-%d')
```
1.  <where></where> æ ‡ç­¾ä¼šè‡ªåŠ¨æ‹¼æ¥åˆé€‚çš„andæ¡ä»¶
2.  delFlag é˜¿é‡Œè§„èŒƒ
```
`del_flag` tinyint unsigned DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯† 0/æœªåˆ é™¤ï¼Œ1/å·²åˆ é™¤',
```
1.  mysql andä¸onåŒºåˆ«
```
# andå†™åœ¨ONåé¢ å·¦è¿æ¥, ä¸å­˜åœ¨åˆ™è¿”å›null
SELECT
    yc.id,
    yc.id2,
    DATE_ADD(
            IFNULL(t2.end_time, now()), INTERVAL t2.add_day DAY
        ) AS `time`
FROM table1 yc
         LEFT JOIN table2 t2
        ON t2.hid = yc.id AND t2.t2_type = '0'
WHERE yc.id IN ('key1', 'key2', 'key3')
ORDER BY yc.id2 DESC;

# andå†™åœ¨whereä¸­, ä¸å­˜åœ¨åˆ™æ•´æ¡è®°å½•ä¸è¿”å›
SELECT
    yc.id,
    yc.id2,
    DATE_ADD(
            IFNULL(t2.end_time, now()), INTERVAL t2.add_day DAY
        ) AS `time`
FROM table1 yc
         LEFT JOIN table2 t2
        ON t2.hid = yc.id
WHERE yc.id IN ('key1', 'key2', 'key3')
    AND t2.t2_type = '0'
ORDER BY yc.id2 DESC;
```
13. æ’åº+å»é‡
```
#å¹¶ä¸ä¼šæ’åº, å› ä¸ºå–çš„æ˜¯tè¡¨çš„å­—æ®µ
SELECT DISTINCT t.*
FROM (SELECT s.msg
      FROM table1 s
      WHERE s.id1 = #{userId}
      ORDER BY s.time DESC) t
LIMIT 0,10

# è¿™æ ·ç»“æœæ‰ä¼šæ’åº
SELECT DISTINCT *
FROM (SELECT s.msg
      FROM table1 s
      WHERE s.id1 = #{userId}
      ORDER BY s.time DESC) t
LIMIT 0,10
```
14. å¼€å¯mysqlæ—¥å¿—å—, è®°å¾—äº‹åå…³é—­
```
SHOW VARIABLES LIKE 'general%'; set GLOBAL general_log='ON';
```
15. åœ¨ä½¿ç”¨mysqlçš„8.0.xä»¥ä¸Šçš„jarçš„æ—¶å€™ï¼Œéœ€è¦åœ¨ä»£ç urlçš„é“¾æ¥é‡Œé¢æŒ‡å®šserverTimezone; è€Œidea-maven mysql-connectoråœ¨ä¾èµ–æ—¶ä¼šè‡ªåŠ¨ä¾èµ–æœ€æ–°ç‰ˆçš„mysql-connector, æ•…, http://www.yayihouse.com/yayishuwu/chapter/1604; 
å¤„ç†æ–¹æ³•: ä½¿ç”¨<optional>true</optional>éš”ç¦»maven  
a. å¹¶ä¸”druid ä½¿ç”¨ 1.1.21ä»¥ä¸Š   å¦åˆ™druidä¼šæŠ¥åºåˆ—åŒ–å¼‚å¸¸  
b. Java.time.LocalDateTime cannot be cast to Java.util.Date  -> mysql-connector-Java 8.0.22 
16. mysql è§£é”
```
# é”è¡¨, æ‹¼æ¥è§£é”è¯­å¥
SELECT concat('KILL ',id,';')
FROM information_schema.processlist p
         INNER JOIN  information_schema.INNODB_TRX x
                     ON p.id=x.trx_mysql_thread_id;
```
17. mysql-plus apply ä¼šè‡ªåŠ¨åŠ andæ¡ä»¶
18. ä¸€å¯¹å¤šæŸ¥è¯¢, ä½¿ç”¨json_array(group_concat(json_object('course_name',course_name))), è€Œä¸è¦ç”¨ä½¿ç”¨for-i-sqlæŸ¥è¯¢, å› ä¸ºé¢‘ç¹çš„jdbcè¿æ¥ä¸æ–­å¼€ååˆ†æ¶ˆè€—æ€§èƒ½
19. mysqlæ”¹å˜æ—¶åŒº, éœ€è¦é‡å¯Javaåº”ç”¨å’Œmysql, å¦åˆ™å†…ç½®å‡½æ•°now()ä¸ç”Ÿæ•ˆ
20. ä¸è¦ä½¿ç”¨count(*), ä»–ä¼šç»Ÿè®¡nullçš„åˆ—
21. sum()éœ€è¦æ³¨æ„ NPE çš„é—®é¢˜

# ç¬¬ä¸‰ç«  ä¸­é—´ä»¶
## 3.1 redis
### 3.1.1 å¸¸ç”¨çš„æ•°æ®ç±»å‹
String
Hash
List
Set
Sorted Set

### 3.1.2 æœåŠ¡é›ªå´©ä¸å‡»ç©¿

### 3.1.3 å“¨å…µ

### 3.1.4 æ¶ˆæ¯è®¢é˜…

## 3.x ä¸­é—´ä»¶ç»éªŒ
1. å·¥ä½œæµèŠ‚ç‚¹ä¸­çš„è¡¨å•key,è¢«ç”¨æ¥å½“ä½œè§’è‰²Codeè¿›è¡Œä½¿ç”¨
2. æœ¬åœ°è¿ç”Ÿäº§websocketå‡ºç°é—®é¢˜å, ä¼šå¯¼è‡´å„åº”ç”¨å¡æ­», éœ€è¦é‡å¯çº¿ä¸Šåº”ç”¨; æ‰€ä»¥åˆ‡è®°ä¸å¯è®©æœ¬åœ°ç›´æ¥è¿æ¥ç”Ÿäº§çš„å„ä¸­é—´ä»¶
3. rediså¦‚æœç”¨hsetåštoken, hsetçš„è¿‡æœŸæ—¶é—´æ˜¯å¯¹é¡¶å±‚keyè®¾ç½®çš„, ä¹Ÿå°±æ˜¯è¯´, åªè¦æœ€åä¸€ä¸ªhashæ²¡æœ‰å¤±æ•ˆ, åˆ™å…¨éƒ¨ä¸ä¼šå¤±æ•ˆ; ç›®å‰å…¶å®åœ¨ä¸€å®šç¨‹åº¦ä¸Šç±»ä¼¼è®¾ç½®äº†tokenæ°¸ä¹…ç”Ÿæ•ˆ; å¯¹æ—¶é—´æ•æ„Ÿçš„tokenä¸å¯ä½¿ç”¨hset
4. ç¼“å­˜, å°æ•°æ®å¯ä»¥ç”¨cacheableæ ‡ç­¾, å¤§æ•°æ®ä¸Šä¸‡æ¡çš„è¯·ç›´æ¥ä½¿ç”¨redis

# ç¬¬å››ç«  Linux

## 4.x Linuxç»éªŒ
1. test=$(expr "$filename" : "$libsReg")çš„è¿”å›å€¼æ˜¯false; å¦‚éœ€ä½¿ç”¨è¯¥
2. expr match "$file" "rfty"; expr: syntax error
åŸå› : macosä¸æ”¯æŒexpr matchè¯­æ³•, è¯·ä½¿ç”¨ expr "$file" : "rfty"ä»£æ›¿
1. å¿«æ·è·¯å¾„/usr/local/bin/redis-server; /usr/local/Cellar/dex2jar/2.0

# ç¬¬äº”ç«  Spring-Boot
## 5.1 Spring-Bootç»éªŒ



## 5.2 Spring ä¸­çš„ maven å†²çªä¸ç®¡ç†
### 5.2.1 SpringBoot ä¸­çš„ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨ä»²è£æœºåˆ¶

```
<!-- example -->
        <dependency>
            <groupId>com.squareup.okhttp3</groupId>
            <artifactId>okhttp</artifactId>
            <version>${okhttp3.version}</version>
            <scope>compile</scope>
            <optional>true</optional>
        </dependency>
```



å‚è€ƒèµ„æ–™:
1. https://www.cxyzjd.com/article/MrYushiwen/111866287
2. https://cloud.tencent.com/developer/article/1676041

ä¹Ÿè®¸æ‚¨è®¤ä¸ºè¿™ä¸ªé—®é¢˜æ— å…³ç´§è¦, ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­, å„ä¸ªæ’ä»¶çš„ç‰ˆæœ¬å¹¶ä¸èƒ½ç”±æ‚¨æ‰€å†³å®š, maven ç‰ˆæœ¬å†²çªå¯¼è‡´å„ç§ç¥å¥‡é—®é¢˜, ä¼šè®©æ‚¨çš„å¼€å‘æ€è·¯èµ°å‘å´©æºƒ

> è¿™æ˜¯ä¸€ä¸ªå®é™…çš„åœºæ™¯: 
> 1. ä¾‹å¦‚åœ¨æ‚¨çš„é¡¹ç›®ä¸­å¼•å…¥åä¸ºObs  `esdk-obs-Java` çš„ç›¸å…³ä¾èµ–, ä»–ä½¿ç”¨çš„`okhttp`ä¾èµ–ä¸º`4.xx`, 
ä½†æ˜¯åœ¨`Spring 2.3.x`çš„é»˜è®¤ä¾èµ–ç®¡ç†ä¸­, `okhttp`çš„é»˜è®¤ä¾èµ–ä¸º`3.xx`, 
è¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±æ˜¯, ä»£ç ç¼–å†™æ—¶æ²¡æœ‰é—®é¢˜, ä½†æ˜¯åœ¨ä»£ç è¿è¡Œå, å°±ä¼šå‡ºç° `class not found` æˆ– `method not found` ä¹‹ç±»çš„å¼‚å¸¸
> 2. åœ¨å¤æ‚é¡¹ç›®ä¸­, æ‚¨å¾€å¾€ä¼šä½¿ç”¨å¤šæ¨¡å—è¿›è¡Œå¼€å‘, æ‰€ä»¥å³ä½¿æ‚¨ä½¿ç”¨äº†åä¸ºå®˜æ–¹æ¨èçš„ `esdk-obs-Java-bundle`, ä¾ç„¶ä¼šå­˜åœ¨ä¸Šè¿°é—®é¢˜
> 3. è€Œåœ¨å¦ä¸€ç§æƒ…å½¢ä¸­, å³ä½¿æ‚¨ä½¿ç”¨äº†å¾®æœåŠ¡æ¶æ„è¿›è¡Œéƒ¨ç½², ä½†æ˜¯åœ¨æŸäº›æ—¶å€™, æ‚¨ä»ç„¶ä¸å¯é¿å…çš„ä¼šé‡åˆ° maven ä¾èµ–å†²çªçš„é—®é¢˜
> æ‰€ä»¥, ä»¥ä¸‹æ˜¯æˆ‘çš„æ€»ç»“: 

spring mavenç®¡ç†ä¸»è¦æ˜¯ä¸¤ä¸ªæ ‡ç­¾ `scope` ä¸ `optional` 
1. scope: compile, provide, runtime, test...
  + compile: é»˜è®¤å€¼, å­é¡¹ç›®ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–
  + provide: å­é¡¹ç›®ä¸ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–, å„è‡ªé…ç½® maven ç‰ˆæœ¬
  + runtime: å­é¡¹ç›®ä¸ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–ä¸”ä»…åœ¨ runtime æœŸé—´å¯ç”¨
  + test: ä»… test dir å¯ä½¿ç”¨

2. optional: true, false
  + false: é»˜è®¤å€¼, å­é¡¹ç›®ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–, ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨ spring boot çš„è‡ªåŠ¨ç‰ˆæœ¬ä»²è£æœºåˆ¶, æˆ–è€…æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬
  + true: å­é¡¹ç›®ä¸ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–ä¸”ç‰ˆæœ¬ä¸å½“å‰é¡¹ç›®ä¿æŒä¸€è‡´

3. æ³¨æ„, å•ä½“åº”ç”¨å¯åŠ¨å, åŒåä¾èµ–åªä¼šåŠ è½½ä¸€ä¸ªç‰ˆæœ¬
mavenå¤„ç†é‡å¤ä¾èµ–ä¸åŒç‰ˆæœ¬çš„æ–¹å¼å¦‚é“¾æ¥æ‰€ç¤º, https://blog.csdn.net/lishe9452/article/details/119146586

åœ¨å®é™…ä½¿ç”¨ä¸­, æˆ‘æ¨èæ‚¨ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªç»„åˆ
```
<!--
å­é¡¹ç›®ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–, 
å­é¡¹ç›®ä¾èµ–ç‰ˆæœ¬ä¸å½“å‰é¡¹ç›®ä¿æŒä¸€è‡´
ä»…åœ¨  <dependencies> ä¸­ç”Ÿæ•ˆ, ä½¿ç”¨æœ¬ç»„åˆ, å­é¡¹ç›®æ— éœ€å†å¼•å…¥, ç”¨äºå…¨å±€ä¾èµ–
-->
            <scope>compile</scope>
            <optional>true</optional>
```

```
<!--
åœ¨å­é¡¹ç›®æŒ‡å®šç‰ˆæœ¬

å½“å‰ä¸ç»§æ‰¿çˆ¶é¡¹ç›®ä¾èµ–, 
ä»…åœ¨å½“å‰é¡¹ç›®ä¸­ä½¿ç”¨è¯¥ä¾èµ–
-->
            <scope>provide</scope>
```
```
æ–¹æ¡ˆä¸‰:
æ”¾åœ¨é¡¶å±‚é¡¹ç›®çš„
    <dependencyManagement>
        <dependencies>
ä¸­, ç›´æ¥æ›¿æ¢ spring ä¾èµ–
```

> è¯·æ‚¨åƒä¸‡ä¸è¦å›¾çœäº‹, ä½¿ç”¨ spring çš„é»˜è®¤é…ç½®, é‚£æ ·çš„ç›´æ¥åæœå°±æ˜¯
> search `google.com` -> 3:00 am



## Spring yml

å·²çŸ¥ spring boot yml é…ç½®å¦‚ä¸‹
```yaml
thread-pool:
    # æœ€å¤§çº¿ç¨‹æ•°
    max-size: 20
    # æ ¸å¿ƒçº¿ç¨‹æ•°
    core-size: 10
    # å­˜æ´»æ—¶é—´
    keep-alive: 60
    # é˜Ÿåˆ—å¤§å°
    queue-capacity: 200
    # æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶
    allow-core-thread-timeout: true
    # çº¿ç¨‹åç§°å‰ç¼€
    thread-name-prefix: taskExecutor-
    # å…³é—­è¿›ç¨‹å‰æ‰§è¡Œå®Œçº¿ç¨‹
    await-termination: true
    # ç­‰å¾…æ—¶é—´
    await-termination-period: 60
    # æ‹’ç»æ”¿ç­–
    rejected-execution-handle: 'Java.util.concurrent.ThreadPoolExecutor$CallerRunsPolicy'
```

å¸®æˆ‘ç”Ÿæˆ Configuration, å¹¶ä½¿ç”¨ @Configuration å’Œ @Data ä»¥åŠ @Value @ConfigurationProperties(prefix = "thread-pool.thread-oss") æ³¨è§£, å„å˜é‡ä½¿ç”¨åŒ…è£…ç±»å‹, ç”Ÿæˆç»“æœå¦‚ä¸‹

```java
@Configuration
@ConfigurationProperties(prefix = "thread-pool.thread-oss") //å‰ç¼€
@Data
public class ThreadPoolOssConfig {

    private Integer maxSize;

    private Integer coreSize;

    private Integer keepAlive;

    private Integer queueCapacity;

    private Boolean allowCoreThreadTimeout;

    private String threadNamePrefix;

    private Boolean awaitTermination;

    private Integer awaitTerminationPeriod;

    private String rejectedExecutionHandler;
}
```

## Spring åŠ¨æ€ä»£ç†

#### 1. ä»€ä¹ˆæ˜¯ Spring åŠ¨æ€ä»£ç†

- **åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰** = **åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡**ï¼Œæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œåœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•å‰åå¢åŠ ä¸€äº›â€œå¢å¼ºé€»è¾‘â€ï¼ˆAdviceï¼‰ã€‚
- Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„æ ¸å¿ƒå°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ã€‚

ä½ å†™çš„ä»£ç é‡Œç±»ä¼¼ï¼š

```
@Service
public class UserService {
    public void createUser(String name) {
        System.out.println("Creating user: " + name);
    }
}
```

å¦‚æœåŠ äº†ä¸€ä¸ªåˆ‡é¢ï¼ˆ@Aspectï¼‰ï¼ŒSpring æœ€ç»ˆä¼šç»™ä½ è¿”å›ä¸€ä¸ª **ä»£ç†å¯¹è±¡**ï¼Œè€Œä¸æ˜¯åŸå§‹çš„ `UserService`ã€‚

------

#### 2. Spring åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼

##### 2.1 JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰

- ä¾èµ– `java.lang.reflect.Proxy` å’Œ `InvocationHandler`ã€‚
- è¦æ±‚ç›®æ ‡ç±» **å¿…é¡»å®ç°æ¥å£**ã€‚
- æ ¸å¿ƒæœºåˆ¶ï¼š
  - `Proxy.newProxyInstance()` ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚
  - æ–¹æ³•è°ƒç”¨è¢« `InvocationHandler.invoke()` æ‹¦æˆªã€‚

ç¤ºä¾‹ï¼š

```
public interface UserService {
    void createUser(String name);
}

public class UserServiceImpl implements UserService {
    public void createUser(String name) {
        System.out.println("Creating user: " + name);
    }
}

public class LogInvocationHandler implements InvocationHandler {
    private Object target;

    public LogInvocationHandler(Object target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("Before method: " + method.getName());
        Object result = method.invoke(target, args);
        System.out.println("After method: " + method.getName());
        return result;
    }
}

// ä½¿ç”¨
UserService target = new UserServiceImpl();
UserService proxy = (UserService) Proxy.newProxyInstance(
        target.getClass().getClassLoader(),
        target.getClass().getInterfaces(),
        new LogInvocationHandler(target));

proxy.createUser("Alice");
```

------

##### 2.2 CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºç»§æ‰¿ï¼‰

- ä¸ä¾èµ–æ¥å£ï¼Œç›´æ¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ã€‚
- ä½¿ç”¨å­—èŠ‚ç å¢å¼ºåº“ **CGLIBï¼ˆCode Generation Libraryï¼‰**ã€‚
- é€šè¿‡ç»§æ‰¿æ–¹å¼è¦†ç›–æ–¹æ³•ï¼Œå®ç°æ‹¦æˆªã€‚

ç¤ºä¾‹ï¼š

```
public class UserService {
    public void createUser(String name) {
        System.out.println("Creating user: " + name);
    }
}

public class LogMethodInterceptor implements MethodInterceptor {
    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("Before method: " + method.getName());
        Object result = proxy.invokeSuper(obj, args);
        System.out.println("After method: " + method.getName());
        return result;
    }
}

// ä½¿ç”¨ Enhancer åˆ›å»ºä»£ç†
Enhancer enhancer = new Enhancer();
enhancer.setSuperclass(UserService.class);
enhancer.setCallback(new LogMethodInterceptor());
UserService proxy = (UserService) enhancer.create();
proxy.createUser("Alice");
```

------

#### 3. Spring å¦‚ä½•é€‰æ‹© JDK / CGLIB

- å¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼ŒSpring é»˜è®¤ä½¿ç”¨ **JDK åŠ¨æ€ä»£ç†**ã€‚

- å¦‚æœç›®æ ‡ç±»æ²¡æœ‰æ¥å£ï¼ŒSpring è‡ªåŠ¨å¯ç”¨ **CGLIB**ã€‚

- ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®å¼ºåˆ¶æŒ‡å®šï¼š

  ```
  spring:
    aop:
      proxy-target-class: true   # å¼ºåˆ¶ä½¿ç”¨ CGLIB
  ```

------

#### 4. Spring åŠ¨æ€ä»£ç†çš„åº”ç”¨

- **AOP åˆ‡é¢**ï¼š`@Aspect @Around @Before @After`ã€‚
- **äº‹åŠ¡ç®¡ç†**ï¼š`@Transactional`ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ä»£ç†å¢å¼ºå®ç°çš„ã€‚
- **å®‰å…¨æ§åˆ¶**ï¼š`@PreAuthorize`ï¼Œæ–¹æ³•æ‰§è¡Œå‰é‰´æƒã€‚
- **è¿œç¨‹è°ƒç”¨**ï¼šSpring Cloud/OpenFeign ä¹Ÿæ˜¯åŸºäºåŠ¨æ€ä»£ç†ç”Ÿæˆå®¢æˆ·ç«¯ã€‚

------

#### 5. åŠ¨æ€ä»£ç† vs é™æ€ä»£ç†

| ç‰¹ç‚¹            | é™æ€ä»£ç†               | åŠ¨æ€ä»£ç†               |
| --------------- | ---------------------- | ---------------------- |
| ä»£ç†ç±»ç”Ÿæˆ      | ç¼–è¯‘æ—¶å†™æ­»             | è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆ         |
| çµæ´»æ€§          | ä½                     | é«˜                     |
| å¼€å‘æˆæœ¬        | éœ€è¦ä¸ºæ¯ä¸ªç›®æ ‡ç±»å†™ä»£ç† | ä¸€å¥—é€šç”¨é€»è¾‘ï¼Œè‡ªåŠ¨ä»£ç† |
| Spring ä½¿ç”¨åœºæ™¯ | å‡ ä¹ä¸ç”¨               | æ ¸å¿ƒæœºåˆ¶               |

------

#### 6. æ€»ç»“

- Spring AOP æœ¬è´¨ä¸Šæ˜¯ **åŠ¨æ€ä»£ç† + åˆ‡é¢ç¼–ç¨‹**ã€‚
- **æœ‰æ¥å£ â†’ JDK Proxy**ï¼Œ**æ— æ¥å£ â†’ CGLIB**ã€‚
- åŠ¨æ€ä»£ç†çš„å…³é”®åœ¨äºï¼š**æ–¹æ³•è°ƒç”¨è¢«æ‹¦æˆª â†’ å¢å¼ºé€»è¾‘ç»‡å…¥ â†’ å†è°ƒç”¨ç›®æ ‡æ–¹æ³•**ã€‚

## Spring AOP ä¸ AspectJ åŒºåˆ«

#### ğŸŒ± ä¾‹å­ 1ï¼šæ‹¦æˆª **æ™®é€šå¯¹è±¡**ï¼ˆé Spring Beanï¼‰

**Spring AOPï¼š**
 åªèƒ½æ‹¦æˆª **Spring å®¹å™¨ç®¡ç†çš„ Bean**ã€‚å¦‚æœä½ è‡ªå·± `new` ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯æ‹¦ä¸ä½çš„ï¼š

```
@Service
public class UserService {
    public void createUser() {
        System.out.println("create user");
    }
}

public class TestApp {
    public static void main(String[] args) {
        UserService userService = new UserService(); // ç›´æ¥ new å‡ºæ¥
        userService.createUser(); // âŒ Spring AOP æ‹¦ä¸ä½
    }
}
```

**AspectJï¼š**
 å› ä¸ºå®ƒç›´æ¥ä¿®æ”¹å­—èŠ‚ç ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯ Spring ç®¡ç†çš„å¯¹è±¡ï¼Œéƒ½èƒ½æ‹¦æˆªï¼š

```
@Aspect
public class LogAspect {
    @Before("execution(* com.example.UserService.createUser(..))")
    public void before() {
        System.out.println(">>> Before createUser");
    }
}
```

ğŸ‘‰ è¿è¡Œåï¼š`>>> Before createUser` ä¼šæ‰“å°å‡ºæ¥ã€‚

------

#### ğŸŒ± ä¾‹å­ 2ï¼šæ‹¦æˆª **æ„é€ å‡½æ•°**

**Spring AOPï¼š**
 åªèƒ½æ‹¦æˆªæ–¹æ³•ï¼Œæ„é€ å‡½æ•°æ— èƒ½ä¸ºåŠ›ã€‚

**AspectJï¼š**
 å¯ä»¥ç›´æ¥æ‹¦æˆª `new`ï¼š

```
@Aspect
public class ConstructorAspect {
    @Before("execution(com.example.UserService.new(..))")
    public void beforeConstructor() {
        System.out.println(">>> Before UserService constructor");
    }
}
```

ğŸ‘‰ åªè¦æ‰§è¡Œ `new UserService()`ï¼ŒAspectJ å°±èƒ½åˆ‡å…¥ï¼Œè€Œ Spring AOP ä¸è¡Œã€‚

------

#### ğŸŒ± ä¾‹å­ 3ï¼šæ‹¦æˆª **å­—æ®µè®¿é—®**

**Spring AOPï¼š**
 ä¸èƒ½æ‹¦æˆª `obj.field` çš„è¯»å†™ã€‚

**AspectJï¼š**
 å¯ä»¥æ‹¦æˆªå­—æ®µ `get/set` æ“ä½œï¼š

```
@Aspect
public class FieldAspect {
    @Before("get(int com.example.UserService.age)")
    public void beforeGet() {
        System.out.println(">>> Before get age");
    }

    @Before("set(int com.example.UserService.age)")
    public void beforeSet() {
        System.out.println(">>> Before set age");
    }
}
```

ğŸ‘‰ æ¯æ¬¡è¯»/å†™ `userService.age` æ—¶ï¼Œéƒ½ä¼šè§¦å‘åˆ‡é¢é€»è¾‘ã€‚

------

#### ğŸŒ± æ€»ç»“å·®å¼‚ï¼ˆç»“åˆä¾‹å­ï¼‰

| èƒ½åŠ›                    | Spring AOP            | AspectJ                 |
| ----------------------- | --------------------- | ----------------------- |
| æ‹¦æˆª Spring Bean æ–¹æ³•   | âœ…                     | âœ…                       |
| æ‹¦æˆªé Spring Bean æ–¹æ³• | âŒ                     | âœ…                       |
| æ‹¦æˆªæ„é€ å‡½æ•°            | âŒ                     | âœ…                       |
| æ‹¦æˆªå­—æ®µè®¿é—®            | âŒ                     | âœ…                       |
| å®ç°æ–¹å¼                | åŠ¨æ€ä»£ç†ï¼ˆJDK/CGLIBï¼‰ | ç¼–è¯‘æœŸ/åŠ è½½æœŸä¿®æ”¹å­—èŠ‚ç  |

## åŠ¨æ€æ–¹è¨€: å†™ä¸€ä¸ªâ€œåŠ¨æ€æ–¹è¨€â€ï¼Œè®©ä¸€ä¸ªåˆ†é¡µæ’ä»¶é€‚é… Oracle + Postgres

ä½ ç°åœ¨çš„è¯‰æ±‚æ˜¯ï¼š

- ç”¨ `@DS("postgres")` / `@DS("oracle")` åˆ‡åº“ï¼ˆåŠ¨æ€æ•°æ®æºï¼‰
- ä¸¤ä¸ªåº“éƒ½è¦ç”¨ MyBatis-Plus åˆ†é¡µ
- åªæœ‰ä¸€ä¸ª SqlSessionFactoryï¼ˆèµ°åŠ¨æ€æ•°æ®æºï¼‰

**æ­£ç¡®å§¿åŠ¿å°±æ˜¯ï¼š**

> âœ” åªæ³¨å†Œä¸€ä¸ª `MybatisPlusInterceptor` + ä¸€ä¸ª `PaginationInnerInterceptor`
>  âœ” ç„¶åç»™å®ƒä¸€ä¸ªâ€œä¼šçœ‹å½“å‰æ•°æ®æºâ€çš„ `IDialect` å®ç°

### 1. è‡ªå®šä¹‰ä¸€ä¸ªåŠ¨æ€æ–¹è¨€ `DynamicRoutingDialect`

```
package tech.ynfy.oracle.mybatis;

import com.baomidou.dynamic.datasource.toolkit.DynamicDataSourceContextHolder;
import com.baomidou.mybatisplus.extension.plugins.pagination.DialectModel;
import com.baomidou.mybatisplus.extension.plugins.pagination.dialects.IDialect;
import com.baomidou.mybatisplus.extension.plugins.pagination.dialects.OracleDialect;
import com.baomidou.mybatisplus.extension.plugins.pagination.dialects.PostgreDialect;

public class DynamicRoutingDialect implements IDialect {

    private final IDialect oracleDialect = new OracleDialect();
    private final IDialect postgresDialect = new PostgreDialect();

    @Override
    public DialectModel buildPaginationSql(String originalSql, long offset, long limit) {
        // å½“å‰æ•°æ®æºåç§°ï¼Œæ¯”å¦‚ "postgres" / "oracle"
        String ds = DynamicDataSourceContextHolder.peek();

        if ("postgres".equalsIgnoreCase(ds)) {
            // èµ° PG çš„åˆ†é¡µï¼ˆLIMIT/OFFSETï¼‰
            return postgresDialect.buildPaginationSql(originalSql, offset, limit);
        } else {
            // é»˜è®¤èµ° Oracleï¼ˆROWNUMï¼‰
            return oracleDialect.buildPaginationSql(originalSql, offset, limit);
        }
    }
}
```

> âš  æ³¨æ„ï¼š
>
> - è¿™é‡Œç”¨çš„æ˜¯ä½ è´´å‡ºæ¥çš„é‚£ä¸ª `IDialect` ç‰ˆæœ¬ï¼šåªå®ç° `buildPaginationSql`ï¼Œè¿”å› `DialectModel`ã€‚
> - **ä¸ç”¨å†™ `buildCountSql`ï¼Œä½ çš„ç‰ˆæœ¬æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿä¸éœ€è¦ã€‚**

------

### 2. å…¨å±€åªä¿ç•™ä¸€ä¸ª MybatisPlusInterceptorï¼ˆä¸è¦å†åˆ† Pg / Oracle ä¸¤ä¸ª Beanï¼‰

æ¥ä¸€ä¸ªç»Ÿä¸€é…ç½®ç±»ï¼Œæ¯”å¦‚ï¼š

```
package tech.ynfy.oracle.mybatis;

import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
// Mapper æ‰«æå¯ä»¥åœ¨åˆ«çš„é…ç½®ç±»é‡Œåˆ†åŒ…æ‰«ï¼Œè¿™é‡Œéšæ„
public class MybatisPlusConfig {

    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();

        PaginationInnerInterceptor paginationInnerInterceptor = new PaginationInnerInterceptor();
        // â˜… æŠŠæˆ‘ä»¬è‡ªå·±å†™çš„åŠ¨æ€æ–¹è¨€å¡è¿›å»
        paginationInnerInterceptor.setDialect(new DynamicRoutingDialect());

        interceptor.addInnerInterceptor(paginationInnerInterceptor);

        return interceptor;
    }
}
```

> é‡è¦ï¼š
>
> - **æŠŠä½ ä¹‹å‰çš„ `MybatisPlusPgConfig` å’Œ `MybatisPlusOracleConfig` é‡Œé‚£äº› `MybatisPlusInterceptor` Bean å…¨éƒ¨åˆ æ‰ / æ³¨é‡Šæ‰**
>    ç•™ç€åªä¼šäº’ç›¸å½±å“ã€‚
> - `@MapperScan` å¯ä»¥ä¿ç•™ï¼Œåªè¦ä¸å†åœ¨é‚£ä¿©é…ç½®ç±»é‡Œ new è‡ªå·±çš„æ‹¦æˆªå™¨å°±è¡Œã€‚

------

### 3. ç»§ç»­ç”¨ @DSï¼Œä¸€åˆ‡ç…§æ—§

ä½ åŸæ¥çš„ä»£ç ï¼š

```
@GetMapping("/profile/test")
@DS("postgres")
public Page<CustomerTag> test() {
    Page<CustomerTag> page = new Page<>(2, 20);
    LambdaQueryWrapper<CustomerTag> wrapper = new LambdaQueryWrapper<>();
    Page<CustomerTag> result = customerTagMapper.selectPage(page, wrapper);
    return result;
}
```

æ”¹å®Œé…ç½®ä¹‹åï¼Œæ•ˆæœåº”è¯¥æ˜¯ï¼š

- æ—¥å¿—é‡Œå‡ºç°ä¸¤æ¡ SQLï¼š
  1. `SELECT COUNT(1) FROM (...) TOTAL` è¿™ç§ count è¯­å¥
  2. ä¸€æ¡å¸¦ `LIMIT ? OFFSET ?` çš„çœŸæ­£æŸ¥è¯¢è¯­å¥ï¼ˆå› ä¸ºå½“å‰ @DS æ˜¯ `postgres`ï¼‰
- è¿”å› JSON é‡Œï¼š
  - `total` å˜æˆçœŸå®æ€»æ•°ï¼Œè€Œä¸æ˜¯ 0
  - `pages` = `ceil(total / size)`
  - `records` æœ€å¤š size æ¡ï¼ˆä½ ç»™çš„æ˜¯ 20ï¼‰

å¦å¤–ä½ åœ¨ Oracle é‚£è¾¹æ¯”å¦‚ï¼š

```
@DS("oracle")
public Page<XXX> queryOracle(...) { ... }
```

å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä½ ä¹‹å‰çœ‹åˆ°é‚£ç§ï¼š

```
SELECT * FROM (
  SELECT TMP.*, ROWNUM ROW_ID
  FROM (
    åŸå§‹SQL
  ) TMP
  WHERE ROWNUM <= ?
) WHERE ROW_ID > ?
```

## é™æµç®¡ç†å™¨

### ä¸€ã€æœ€ç®€å•ï¼šåŸºäºæ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨ + Guava RateLimiterï¼ˆå•æœºé™æµï¼‰

é€‚åˆï¼š

- å•æœºé¡¹ç›®
- ç®€å•æ¥å£é™æµ
- ä¸è¦æ±‚ç‰¹åˆ«ç²¾ç¡®çš„åˆ†å¸ƒå¼é™æµ

#### 1. å¼•å…¥ä¾èµ–

ç”¨ Guava çš„ `RateLimiter`ï¼ˆä»¤ç‰Œæ¡¶ï¼‰æ¥åš QPS é™åˆ¶ï¼š

```
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>32.1.1-jre</version>
</dependency>
```

#### 2. å†™ä¸€ä¸ªé™æµç®¡ç†å™¨ï¼ˆæ ¹æ®æ¥å£ç»´åº¦é™æµï¼‰

```
import com.google.common.util.concurrent.RateLimiter;
import org.springframework.stereotype.Component;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

@Component
public class ApiRateLimiterManager {

    // key: æ¥å£è·¯å¾„, value: è¯¥æ¥å£çš„é™æµå™¨
    private final Map<String, RateLimiter> limiterMap = new ConcurrentHashMap<>();

    /**
     * ä¸ºæŸä¸ªæ¥å£é…ç½® QPS
     */
    public void initLimiter(String apiKey, double permitsPerSecond) {
        limiterMap.put(apiKey, RateLimiter.create(permitsPerSecond));
    }

    /**
     * å°è¯•è·å–ä»¤ç‰Œï¼Œä¸é˜»å¡ï¼Œè¿”å›æ˜¯å¦å…è®¸é€šè¿‡
     */
    public boolean tryAcquire(String apiKey) {
        RateLimiter limiter = limiterMap.get(apiKey);
        if (limiter == null) {
            // æ²¡é…ç½®å°±é»˜è®¤ä¸é™åˆ¶
            return true;
        }
        return limiter.tryAcquire();
    }
}
```

#### 3. åœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆå§‹åŒ–å„æ¥å£é™æµè§„åˆ™

```
import jakarta.annotation.PostConstruct;
import org.springframework.stereotype.Component;

@Component
public class RateLimiterConfig {

    private final ApiRateLimiterManager apiRateLimiterManager;

    public RateLimiterConfig(ApiRateLimiterManager apiRateLimiterManager) {
        this.apiRateLimiterManager = apiRateLimiterManager;
    }

    @PostConstruct
    public void init() {
        // ä¾‹å¦‚ï¼š/api/user/login æ¯ç§’æœ€å¤š 5 æ¬¡
        apiRateLimiterManager.initLimiter("/api/user/login", 5.0);
        // /api/order/create æ¯ç§’ 10 æ¬¡
        apiRateLimiterManager.initLimiter("/api/order/create", 10.0);
    }
}
```

#### 4. ç”¨æ‹¦æˆªå™¨å¯¹æ¯æ¬¡è¯·æ±‚åšé™æµåˆ¤æ–­

```
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;

@Component
public class RateLimitInterceptor implements HandlerInterceptor {

    private final ApiRateLimiterManager apiRateLimiterManager;

    public RateLimitInterceptor(ApiRateLimiterManager apiRateLimiterManager) {
        this.apiRateLimiterManager = apiRateLimiterManager;
    }

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        String path = request.getRequestURI();

        // æ ¹æ®è·¯å¾„é™æµï¼Œä¹Ÿå¯ä»¥åšæ›´ç»†ï¼Œä¾‹å¦‚ path + ç”¨æˆ·ID / IP ç­‰
        boolean allowed = apiRateLimiterManager.tryAcquire(path);

        if (!allowed) {
            response.setStatus(429); // Too Many Requests
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write("{\"code\":429,\"msg\":\"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\"}");
            return false;
        }

        return true;
    }
}
```

#### 5. æ³¨å†Œæ‹¦æˆªå™¨

```
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Autowired
    private RateLimitInterceptor rateLimitInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(rateLimitInterceptor)
                .addPathPatterns("/api/**"); // åªæ‹¦æˆªä¸šåŠ¡æ¥å£
    }
}
```

> è¿™æ ·å°±å®ç°äº†ï¼š**æŒ‰æ¥å£è·¯å¾„é™æµï¼Œè¶…å‡ºå°±è¿”å› 429**

------

### äºŒã€æŒ‰ IP / ç”¨æˆ·ç»´åº¦çš„æ¥å£é™æµ

å¦‚æœä½ å¸Œæœ›ï¼š

- åŒä¸€ IP æ¯ç§’æœ€å¤šè®¿é—® 10 æ¬¡
- åŒä¸€ç”¨æˆ· ID æ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚ 30 æ¬¡

å¯ä»¥åœ¨ `tryAcquire` æ—¶æŠŠ key æ¢æˆ `path + ip` æˆ– `path + userId`ã€‚

ç¤ºä¾‹ï¼šåœ¨æ‹¦æˆªå™¨é‡Œæ„é€  keyï¼š

```
String path = request.getRequestURI();
String ip = request.getRemoteAddr(); // ç®€å•å–IPï¼Œç”Ÿäº§å¯ä»¥åšä»£ç†å¤´è§£æ

String key = path + ":" + ip;

boolean allowed = apiRateLimiterManager.tryAcquire(key);
```

ç„¶ååˆå§‹åŒ–æ—¶å¯ä»¥ä¸ºæŸäº›ã€Œç»´åº¦ã€è®¾ç½®é»˜è®¤é™æµï¼Œæ¯”å¦‚æ¯ä¸ª key å…±ç”¨åŒä¸€ä¸ªé€Ÿç‡ï¼ˆåœ¨ `getLimiter` æ—¶å¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ï¼‰ã€‚

------

### ä¸‰ã€ç”¨æ³¨è§£ + AOP åšæ›´ä¼˜é›…çš„æ¥å£é™æµ

å¦‚æœä½ ä¸æƒ³æŠŠé™æµé€»è¾‘å’Œ URL å¼ºç»‘å®šï¼Œå¯ä»¥ç»™æ–¹æ³•åŠ æ³¨è§£ï¼Œæ¯”å¦‚ï¼š

```
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RateLimit {
    double permitsPerSecond() default 5.0;
    String key() default "";
}
```

ç„¶ååœ¨ AOP é‡Œï¼š

- ä»¥æ–¹æ³•ä¸Šçš„ `@RateLimit` ä¸ºé…ç½®
- ä½¿ç”¨ `æ–¹æ³•å + è‡ªå®šä¹‰ key` ä½œä¸ºé™æµ key
- è¿™æ ·ä¸åŒ controller æ–¹æ³•å¯ä»¥æ–¹ä¾¿é…ç½®é™æµè§„åˆ™

å¦‚æœä½ æƒ³æˆ‘å¯ä»¥ä¸‹ä¸€æ­¥å¸®ä½ æŠŠ AOP ç‰ˆæœ¬ä¹Ÿå†™å®Œæ•´ã€‚

------

### å››ã€åˆ†å¸ƒå¼é™æµï¼šRedis + Luaï¼ˆå¤šå®ä¾‹éƒ¨ç½²å¿…çœ‹ï¼‰

å¦‚æœéƒ¨ç½²æ˜¯å¤šèŠ‚ç‚¹ï¼ˆå¤šå°æœºå™¨ï¼‰ï¼ŒGuava è¿™ç§æœ¬åœ°é™æµ**ä¸ç²¾ç¡®**ã€‚
 å¸¸ç”¨åšæ³•ï¼š**Redis + Lua è„šæœ¬è®¡æ•°**ï¼Œæ¯”å¦‚ã€ŒæŸæ¥å£æ¯åˆ†é’Ÿæœ€å¤š 100 æ¬¡ã€ï¼š

### ç®€å•æ€è·¯ï¼š

1. æ‹¦æˆªå™¨é‡Œç”Ÿæˆ keyï¼š`rate_limit:{apiPath}:{currentMinute}`
2. æ¯æ¬¡è¯·æ±‚ï¼š
   - Redis INCR è¿™ä¸ª key
   - ç¬¬ä¸€æ¬¡è®¾ç½® EXPIRE 60 ç§’
   - è¶…è¿‡é™åˆ¶å°±æ‹’ç»

è¿™éƒ¨åˆ†ä»£ç ç•¥å¾®é•¿ï¼Œå¦‚æœä½ éœ€è¦ Redis ç‰ˆæœ¬ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»™ä½ ä¸€ä»½å¯ä»¥ç›´æ¥ç”¨çš„ç¤ºä¾‹ï¼ˆå¸¦ Lua è„šæœ¬ï¼Œä¿è¯æ“ä½œåŸå­æ€§ï¼‰ã€‚

------

### äº”ã€ä½¿ç”¨æˆç†Ÿæ¡†æ¶ï¼šBucket4j / Resilience4j / Spring Cloud Gateway

# ç¬¬å…­ç«  Spring-cloud-alibaba

[ç›¸å…³é“¾æ¥](https://github.com/hsiong/spring-cloud-alibaba-base): https://github.com/hsiong/spring-cloud-alibaba-base

# ç¬¬ä¸ƒç«  æ•°æ®ç»“æ„ä¸ç®—æ³•

# ç¬¬å…«ç«  å¸¸è§çš„é”åŠå…¶å®ç°

# ç¬¬ä¹ç«  ç¨‹åºè®¾è®¡

## 9.1 é¢å‘å¯¹è±¡è®¾è®¡
[å‚è€ƒé“¾æ¥](https://github.com/hsiong/my-note/tree/main/oop): https://github.com/hsiong/my-note/tree/main/oop

## 9.2 è®¾è®¡æ€æƒ³
### 9.2.1 è‡ªé¡¶å‘ä¸‹
### 9.2.2 æ•æ·å¼€å‘
### 9.2.3 é¢†åŸŸé©±åŠ¨

## 9.3 è®¾è®¡æ¨¡å¼
[ç›¸å…³é“¾æ¥](https://github.com/hsiong/design-pattern-Java): https://github.com/hsiong/design-pattern-Java

## å¹‚ç­‰&ä¸€è‡´æ€§&ACID&SOLID

### æ¨¡å¼é€‰æ‹©

- **å•åº“å•è¡¨å…±äº« + tenant_id åˆ—ï¼ˆæœ€å¸¸è§ï¼‰**
  - ä¼˜ç‚¹ï¼šæˆæœ¬ä½ã€æ‰©å®¹ç®€å•ï¼›åŠ£åŠ¿ï¼šéš”ç¦»æ€§ä¾èµ–åº”ç”¨ä¸æƒé™ç­–ç•¥ã€‚
  - å…³é”®ï¼šæ‰€æœ‰è¡¨åŠ  `tenant_id`ã€**è”åˆå”¯ä¸€ç´¢å¼•**å« `tenant_id`ã€è¡Œçº§æƒé™ï¼ˆRLSï¼‰æˆ–åº”ç”¨å±‚è¿‡æ»¤ã€‚
- **åº“/æ¨¡å¼ï¼ˆschemaï¼‰çº§éš”ç¦»**
  - ä¼˜ç‚¹ï¼šæ›´å¼ºéš”ç¦»ï¼ˆå¤‡ä»½ã€è¿ç§»ã€é…é¢ã€æ€§èƒ½ï¼‰ï¼›åŠ£åŠ¿ï¼šè¿ç»´å¤æ‚ã€‚
  - é€‚åˆå¤§å®¢æˆ·æˆ–æœ‰åˆè§„è¦æ±‚çš„è¡Œä¸šå®¢æˆ·ã€‚
- **å®ä¾‹çº§éš”ç¦»**
  - é‡‘è/æ”¿ä¼æé«˜å®‰å…¨è¦æ±‚ï¼›æˆæœ¬æœ€é«˜ï¼Œé€‚é‡ä½¿ç”¨ã€‚

### å¹‚ç­‰è®¾è®¡

åŒä¸€ä¸ªæ“ä½œï¼Œæ— è®ºæ‰§è¡Œä¸€æ¬¡è¿˜æ˜¯å¤šæ¬¡ï¼Œ**å¯¹ç³»ç»Ÿäº§ç”Ÿçš„æ•ˆæœç›¸åŒ**ã€‚

+ æ•°æ®åº“å”¯ä¸€çº¦æŸ
+ ä¸šåŠ¡çŠ¶æ€æœº + é‡è¯•æœºåˆ¶
+ æ¶ˆè´¹æ¶ˆæ¯æ—¶è¦åŠ å¹‚ç­‰æ§åˆ¶

### æ•°æ®ä¸€è‡´æ€§

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªæ•°æ®å‰¯æœ¬ / å¤šä¸ªæœåŠ¡ä¹‹é—´ï¼Œæ•°æ®å¿…é¡»ä¿æŒä¸€è‡´

+ æœ€ç»ˆä¸€è‡´æ€§: åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
+ æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹
+ è¡¥å¿æœºåˆ¶: é‡è¯•æœºåˆ¶/æ­»ä¿¡é˜Ÿåˆ—/CDC è®¢é˜…åŒæ­¥

ä¸¾ä¾‹ï¼šå¼€ç¥¨æˆåŠŸ -> è®°è´¦ -> æ¨é€ç¨å±€ï¼›è‹¥ç¨å±€å¤±è´¥ï¼Œè§¦å‘â€œå†²çº¢/æ’¤é”€ + è®°è´¦å›æ»šâ€è¡¥å¿ã€‚

### ACID

**é¢†åŸŸ**ï¼šæ•°æ®åº“ï¼ˆå°¤å…¶æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼‰ã€‚
 **ç›®æ ‡**ï¼šä¿è¯æ•°æ®çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚

- **A (Atomicity, åŸå­æ€§)**ï¼šäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚
- **C (Consistency, ä¸€è‡´æ€§)**ï¼šæ‰§è¡Œå‰åï¼Œæ•°æ®å¿…é¡»ä¿æŒä¸€è‡´ã€‚
- **I (Isolation, éš”ç¦»æ€§)**ï¼šå¹¶å‘äº‹åŠ¡äº’ä¸å¹²æ‰°ã€‚
- **D (Durability, æŒä¹…æ€§)**ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤å°±ä¸ä¼šä¸¢å¤±ã€‚

### SOLID

ğŸ”¹ 2. SOLID â€”â€” é¢å‘å¯¹è±¡ç¼–ç¨‹è®¾è®¡åŸåˆ™

**é¢†åŸŸ**ï¼šè½¯ä»¶å·¥ç¨‹ / é¢å‘å¯¹è±¡ç¼–ç¨‹ (OOP)ã€‚
 **ç›®æ ‡**ï¼šè®©ä»£ç æ›´æ˜“ç»´æŠ¤ã€æ‰©å±•ï¼Œé™ä½è€¦åˆã€‚

- **S (Single Responsibility)**ï¼šå•ä¸€èŒè´£åŸåˆ™ã€‚

  ```
  ä¸€ä¸ªæœåŠ¡/æ¨¡å—åªåšä¸€ä»¶äº‹ï¼Œå˜åŒ–çš„åŸå› è¦å•ä¸€ã€‚
  ä¸€ä¸ªç±»/æœåŠ¡æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•çš„ï¼Œåªè¦è¿™äº›æ–¹æ³•çš„å˜åŒ–åŸå› æ˜¯ä¸€è‡´çš„ã€‚
  
  ä¸¾ä¾‹ï¼š
  
  InvoiceService é‡Œæœ‰ generateInvoice()ã€calculateTax()ã€formatInvoiceNumber() â€”â€”å®ƒä»¬éƒ½æ˜¯â€œå‘ç¥¨ç”Ÿæˆâ€é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æ”¾åœ¨ä¸€èµ·åˆç†ã€‚
  
  ä½†å¦‚æœå†åŠ  sendNotification()ï¼ˆæ¶ˆæ¯æ¨é€é€»è¾‘ï¼‰ï¼Œé‚£å°±æ¶‰åŠâ€œé€šçŸ¥ç³»ç»Ÿâ€çš„å˜åŒ–åŸå› ï¼Œä¸å†æ˜¯â€œå‘ç¥¨â€æœ¬èº«çš„èŒè´£ã€‚
  ```

- **O (Open/Closed)**ï¼šå¼€é—­åŸåˆ™ã€‚

  ```
  ç³»ç»Ÿåº”å½“ å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚
  
  âœ… Kafka æ¶ˆè´¹åœºæ™¯
  
  âŒ åä¾‹ï¼š
  ä¸€ä¸ª Kafka æ¶ˆè´¹è€…å†™æ­»äº†ï¼š
  
  if (msg.type.equals("invoice")) { ... }  
  else if (msg.type.equals("payment")) { ... }  
  
  
  ä»¥åæ–°åŠ æ¶ˆæ¯ç±»å‹å°±å¾—æ”¹ä»£ç ã€‚
  
  âœ… æ”¹è¿›ï¼š
  
  å®šä¹‰æ¥å£ MessageHandlerã€‚
  
  æ¯ç§æ¶ˆæ¯ç±»å‹éƒ½å®ç°ä¸€ä¸ª Handlerï¼ˆå‘ç¥¨æ¶ˆæ¯ã€æ”¯ä»˜æ¶ˆæ¯ã€ç¨ç‡æ›´æ–°æ¶ˆæ¯ï¼‰ã€‚ => å·¥å‚æ¨¡å¼
  
  æ¶ˆè´¹ç«¯åªåš handlerRegistry.get(msg.type).handle(msg)ã€‚
  
  æ–°åŠ ä¸šåŠ¡ï¼Œåªéœ€è¦æ–°å¢ç±»ï¼Œä¸ç”¨æ”¹åŸæœ‰é€»è¾‘ã€‚
  ```

  

- **L (Liskov Substitution)**ï¼šé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚

  ```
  å­ç±»å¿…é¡»èƒ½æ›¿æ¢çˆ¶ç±»ï¼Œä¸ç ´ååŸæœ‰é€»è¾‘ã€‚
  â¡ï¸ LSP ä¸æ˜¯è¯´â€œæœ‰æ¥å£å°±è¡Œâ€ï¼Œè€Œæ˜¯å¼ºè°ƒï¼šå­ç±»/å®ç°å¿…é¡»å®Œå…¨éµå®ˆçˆ¶ç±»/æ¥å£å®šä¹‰çš„å¥‘çº¦ï¼Œä¸ç ´åé¢„æœŸè¡Œä¸ºã€‚
  
  âœ… ç¼“å­˜ç­–ç•¥åœºæ™¯
  
  æŠ½è±¡æ¥å£ï¼š
  
  interface Cache {
      String get(String key);
      void put(String key, String value);
  }
  
  
  å®ç°ï¼š
  
  RedisCacheï¼šåŸºäº Redisã€‚
  
  LocalCacheï¼šåŸºäº Caffeineã€‚
  
  è°ƒç”¨æ–¹ï¼š
  
  class InvoiceVerify {
      private Cache cache;
      InvoiceVerify(Cache cache) { this.cache = cache; }
      void verify(String invoice) { ... cache.put(invoice, result); }
  }
  
  
  ä»»ä½•åœ°æ–¹éƒ½èƒ½éšæ„æ›¿æ¢æœ¬åœ°ç¼“å­˜/Redis ç¼“å­˜ï¼Œä¸ä¼šç ´åè¡Œä¸ºã€‚
  
  ğŸ‘‰ åä¾‹ï¼šå¦‚æœå­ç±»åœ¨ put() æ—¶å·å·åŠ äº†ã€Œåªç¼“å­˜å¥‡æ•° Keyã€çš„é™åˆ¶ï¼Œå°±ç ´åäº†å¥‘çº¦ï¼Œè°ƒç”¨æ–¹å°±ä¸èƒ½é€æ˜ä½¿ç”¨äº†ã€‚
  è¿™é‡Œè™½ç„¶è¯­æ³•ä¸Šå®ç°äº†æ¥å£ï¼Œä½†è¡Œä¸ºä¸Šå·²ç»ä¸ç¬¦åˆâ€œput() å°±æ˜¯å­˜å‚¨ key-valueâ€çš„å¥‘çº¦äº†ï¼Œè°ƒç”¨æ–¹åŸæœ¬å†™çš„ cache.put("2","value") åœ¨å…¶ä»–å®ç°èƒ½è·‘é€šï¼Œåœ¨è¿™ä¸ªå®ç°å´ç‚¸äº†ã€‚â¡ï¸ è¿™å°±æ˜¯è¿èƒŒ LSPã€‚
  å¦‚æœçœŸçš„éœ€è¦ä¸åŒçš„è¡Œä¸ºï¼ˆæ¯”å¦‚â€œåªç¼“å­˜å¥‡æ•° keyâ€ï¼‰ï¼Œé‚£å°±åº”è¯¥å®šä¹‰æ–°çš„æ¥å£æˆ–æ‰©å±•æœºåˆ¶ï¼Œè€Œä¸æ˜¯å·å·æ”¹è€æ¥å£çš„è¯­ä¹‰ã€‚
  ```

  

- **I (Interface Segregation)**ï¼šæ¥å£éš”ç¦»åŸåˆ™ã€‚

  ```
  å°è€Œä¸“ä¸€çš„æ¥å£
  
  ğŸ‘‰ ä¸è¦è®¾è®¡ã€Œå¤§è€Œå…¨ã€çš„æ¥å£ï¼Œåº”è¯¥ç»†åˆ†ã€‚
  æ­£ç¡®ç†è§£æ˜¯ï¼šæ¥å£è¦æŒ‰èƒ½åŠ›è¾¹ç•Œæ¥æ‹†åˆ†ï¼Œè€Œä¸æ˜¯æŒ‰æ¨¡å—æ¥åˆ†
  
  âœ… æ–‡ä»¶å­˜å‚¨åœºæ™¯
  
  âŒ åä¾‹ï¼š
  
  interface Storage {
      void saveFile();
      void getFile();
      void compress();
      void encrypt();
  }
  
  
  å¦‚æœ MinIO åªæ”¯æŒå­˜å–ï¼Œä¸æ”¯æŒå‹ç¼©å’ŒåŠ å¯†ï¼Œå°±å¾—å®ç°ä¸€å †ç©ºæ–¹æ³•ã€‚
  
  âœ… æ”¹è¿›ï¼š
  
  interface FileReadable { void getFile(); }
  interface FileWritable { void saveFile(); }
  interface Compressible { void compress(); }
  interface Encryptable { void encrypt(); }
  
  
  S3 å­˜å‚¨åªå®ç°è¯»å†™ã€‚
  
  HDFS å®ç°è¯»å†™ + å‹ç¼©ã€‚
  
  åŠ å¯†å­˜å‚¨å®ç°è¯»å†™ + åŠ å¯†ã€‚
  
  ğŸ‘‰ å¥½å¤„ï¼šä¸åŒä¸­é—´ä»¶æŒ‰éœ€å®ç°ï¼Œä¸è¢«è¿«ã€Œå¤šä½™ä¾èµ–ã€ã€‚
  ```

- **D (Dependency Inversion)**ï¼šä¾èµ–å€’ç½®åŸåˆ™ã€‚

  ```
  ğŸ‘‰ é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œè€Œæ˜¯ä¾èµ–æŠ½è±¡ã€‚
  
  âœ… æ¶ˆæ¯é˜Ÿåˆ—åœºæ™¯
  
  æŠ½è±¡æ¥å£ï¼š
  
  interface MessageBus {
      void publish(String topic, String msg);
      void subscribe(String topic, Consumer<String> handler);
  }
  
  
  å®ç°ç±»ï¼š
  
  KafkaBus
  
  RabbitMQBus
  
  RedisStreamBus
  
  ä¸Šå±‚ä¸šåŠ¡ï¼ˆå¦‚å‘ç¥¨æœåŠ¡ï¼‰ï¼š
  
  class InvoiceService {
      private MessageBus bus;
      InvoiceService(MessageBus bus) { this.bus = bus; }
      void createInvoice(String data) {
          bus.publish("invoice", data);
      }
  }
  
  
  ä¸šåŠ¡å±‚å®Œå…¨ä¸ç”¨å…³å¿ƒåº•å±‚æ˜¯ Kafka è¿˜æ˜¯ RabbitMQ â†’ å¯æ’æ‹”ã€‚
  
  ğŸ‘‰ å¥½å¤„ï¼šä¾¿äºåˆ‡æ¢ä¸­é—´ä»¶ï¼ˆæ¯”å¦‚æµ‹è¯•ç¯å¢ƒç”¨ Redisï¼Œç”Ÿäº§ç”¨ Kafkaï¼‰ã€‚
  ```

  

# ç¬¬åç«  DevOps

## 10.1 Jenkins
## 10.2 Docker
## 10.3 k8s


# ç¬¬åä¸€ç«  Android

# ç¬¬åäºŒç«  Vue
## 12.1 Vueç”Ÿå‘½å‘¨æœŸ
1. beforeCreateï¼ˆåˆ›å»ºå‰ï¼‰  
   åœ¨å®ä¾‹åˆå§‹åŒ–ä¹‹åï¼Œæ•°æ®è§‚æµ‹(data observer) å’Œ event/watcher äº‹ä»¶é…ç½®ä¹‹å‰è¢«è°ƒç”¨ã€‚
2. createdï¼ˆåˆ›å»ºåï¼‰  
   å®ä¾‹å·²ç»åˆ›å»ºå®Œæˆä¹‹åè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹å·²å®Œæˆä»¥ä¸‹çš„é…ç½®ï¼šæ•°æ®è§‚æµ‹(data observer)ï¼Œå±æ€§å’Œæ–¹æ³•çš„è¿ç®—ï¼Œ watch/event äº‹ä»¶å›è°ƒã€‚ç„¶è€Œï¼ŒæŒ‚è½½é˜¶æ®µè¿˜æ²¡å¼€å§‹ï¼Œ$el å±æ€§ç›®å‰ä¸å¯è§ã€‚
3. beforeMountï¼ˆæŒ‚è½½å‰ï¼‰  
   åœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼šç›¸å…³çš„ render å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨ã€‚
4. mountedï¼ˆæŒ‚è½½åï¼‰  
   el è¢«æ–°åˆ›å»ºçš„ vm.$el æ›¿æ¢ï¼Œå¹¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå»ä¹‹åè°ƒç”¨è¯¥é’©å­ã€‚
5. beforeUpdateï¼ˆæ›´æ–°å‰ï¼‰  
   æ•°æ®æ›´æ–°æ—¶è°ƒç”¨ï¼Œå‘ç”Ÿåœ¨è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹å‰ã€‚ ä½ å¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­è¿›ä¸€æ­¥åœ°æ›´æ”¹çŠ¶æ€ï¼Œè¿™ä¸ä¼šè§¦å‘é™„åŠ çš„é‡æ¸²æŸ“è¿‡ç¨‹ã€‚
6. updatedï¼ˆæ›´æ–°åï¼‰  
   ç”±äºæ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ï¼Œåœ¨è¿™ä¹‹åä¼šè°ƒç”¨è¯¥é’©å­ã€‚å½“è¿™ä¸ªé’©å­è¢«è°ƒç”¨æ—¶ï¼Œç»„ä»¶ DOM å·²ç»æ›´æ–°ï¼Œæ‰€ä»¥ä½ ç°åœ¨å¯ä»¥æ‰§è¡Œä¾èµ–äº DOM çš„æ“ä½œã€‚ç„¶è€Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥é¿å…åœ¨æ­¤æœŸé—´æ›´æ”¹çŠ¶æ€ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´æ–°æ— é™å¾ªç¯ã€‚è¯¥é’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚
7. beforeDestoryï¼ˆé”€æ¯å‰ï¼‰  
   å®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹ä»ç„¶å®Œå…¨å¯ç”¨ã€‚
8. destoryedï¼ˆé”€æ¯åï¼‰  
   Vue å®ä¾‹é”€æ¯åè°ƒç”¨ã€‚è°ƒç”¨åï¼ŒVue å®ä¾‹æŒ‡ç¤ºçš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šè§£ç»‘å®šï¼Œæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ä¼šè¢«ç§»é™¤ï¼Œæ‰€æœ‰çš„å­å®ä¾‹ä¹Ÿä¼šè¢«é”€æ¯ã€‚ è¯¥é’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚

## 12.x Vueç»éªŒ
1. vueé¡¹ç›® npmå‡ºä¸æ¥, çœ‹çœ‹vueæ’ä»¶æ˜¯ä¸æ˜¯æ²¡å¯ç”¨
2. ifåˆ¤æ–­çš„and è¦å°å†™;queryDateDTO.submitTime_begin != null and queryDateDTO.submitTime_begin != '' 
3. å‰ç«¯405, postæˆ–getè¯·æ±‚æ–¹å¼ä¸å¯¹

# ç¬¬åä¸‰ç«  å¸¸ç”¨å·¥å…·
|å·¥å…·|åŠŸèƒ½|
|:-:|:-:|
|visual VM|å®šä½å †æ ˆ/OOM|
|jmap|å®šä½OOM|
|jmeter|æ¥å£æµ‹è¯•, å¹¶å‘æµ‹è¯•|
|postman|æ¥å£æµ‹è¯•|
|XMind|æ€ç»´å¯¼å›¾|
|drawIo|å·¥ä½œæµå›¾|
|finalShell|è¿œç¨‹é“¾æ¥|
|||
|||

# ç¬¬åå››ç«  ç½‘ç»œå¼€å‘
## 14.1 OSIä¸ƒå±‚æ¨¡å‹
å‚è€ƒèµ„æ–™: [OSIä¸ƒå±‚æ¨¡å‹](https://wenku.baidu.com/view/f8a3e498824d2b160b4e767f5acfa1c7ab008202.html)

|åè®®|ä»‹ç»|ç‰¹ç‚¹|ç‰©ç†è®¾å¤‡|åè®®|
|:-:|:-:|:-:|:-:|:-:|
|ç‰©ç†å±‚|ç‰©ç†å±‚çš„ä»»åŠ¡å°±æ˜¯ä¸ºå®ƒçš„ä¸Šä¸€å±‚æä¾›ä¸€ä¸ªç‰©ç†è¿æ¥ï¼Œä»¥åŠå®ƒä»¬çš„æœºæ¢°ã€ç”µæ°”ã€åŠŸèƒ½å’Œè§„ç¨‹ç‰¹æ€§|åœ¨è¿™ä¸€å±‚ï¼Œæ•°æ®è¿˜æ²¡æœ‰è¢«ç»„ç»‡ï¼Œä»…ä½œä¸ºåŸå§‹çš„ä½æµæˆ–ç”µæ°”ç”µå‹å¤„ç†ï¼Œå•ä½æ˜¯bitæ¯”ç‰¹|ç‰©ç†è¿ç½‘åª’ä»‹|ç”µæ°”ç”µå‹ å•ä½bit|
|æ•°æ®é“¾è·¯å±‚|åœ¨ç‰©ç†å±‚æä¾›æ¯”ç‰¹æµæœåŠ¡çš„åŸºç¡€ä¸Šï¼Œå»ºç«‹ç›¸é‚»ç»“ç‚¹ä¹‹é—´çš„æ•°æ®é“¾è·¯ï¼Œé€šè¿‡å·®é”™æ§åˆ¶æä¾›æ•°æ®å¸§(Frame)åœ¨ä¿¡é“ä¸Šæ— å·®é”™çš„ä¼ è¾“ï¼Œå¹¶è¿›è¡Œå„ç”µè·¯ä¸Šçš„åŠ¨ä½œç³»åˆ—ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯å¦‚ä½•åœ¨ä¸å¯é çš„ç‰©ç†çº¿è·¯ä¸Šè¿›è¡Œæ•°æ®çš„å¯é ä¼ é€’|ä¸ºäº†ä¿è¯ä¼ è¾“ï¼Œä»ç½‘ç»œå±‚æ¥æ”¶åˆ°çš„æ•°æ®è¢«åˆ†å‰²æˆç‰¹å®šçš„å¯è¢«ç‰©ç†å±‚ä¼ è¾“çš„å¸§ã€‚å¸§æ˜¯ç”¨æ¥ç§»åŠ¨æ•°æ®çš„ç»“æ„åŒ…ï¼Œå®ƒä¸ä»…åŒ…æ‹¬åŸå§‹æ•°æ®ï¼Œè¿˜åŒ…æ‹¬å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„ç‰©ç†åœ°å€ä»¥åŠæ£€é”™å’Œæ§åˆ¶ä¿¡æ¯ã€‚å…¶ä¸­çš„åœ°å€ç¡®å®šäº†å¸§å°†å‘é€åˆ°ä½•å¤„ï¼Œè€Œçº é”™å’Œæ§åˆ¶ä¿¡æ¯åˆ™ç¡®ä¿å¸§æ— å·®é”™åˆ°è¾¾ã€‚å¦‚æœåœ¨ä¼ é€æ•°æ®æ—¶ï¼Œæ¥æ”¶ç‚¹æ£€æµ‹åˆ°æ‰€ä¼ æ•°æ®ä¸­æœ‰å·®é”™ï¼Œå°±è¦é€šçŸ¥å‘é€æ–¹é‡å‘è¿™ä¸€å¸§ã€‚|äº¤æ¢æœº|SDLCã€HDLCã€PPPã€STPã€å¸§ä¸­ç»§ç­‰|
|ç½‘ç»œå±‚|å…¶ä¸»è¦åŠŸèƒ½æ˜¯å°†ç½‘ç»œåœ°å€ç¿»è¯‘æˆå¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¹¶å†³å®šå¦‚ä½•å°†æ•°æ®ä»å‘é€æ–¹è·¯ç”±åˆ°æ¥æ”¶æ–¹|ç½‘ç»œå±‚é€šè¿‡ç»¼åˆè€ƒè™‘å‘é€ä¼˜å…ˆæƒã€ç½‘ç»œæ‹¥å¡ç¨‹åº¦ã€æœåŠ¡è´¨é‡ä»¥åŠå¯é€‰è·¯ç”±çš„èŠ±è´¹æ¥å†³å®šä»ä¸€ä¸ªç½‘ç»œä¸­èŠ‚ç‚¹A%2Båˆ°å¦ä¸€ä¸ªç½‘ç»œä¸­èŠ‚ç‚¹B%2Bçš„æœ€ä½³è·¯å¾„ã€‚ç”±äºç½‘ç»œå±‚å¤„ç†ï¼Œå¹¶æ™ºèƒ½æŒ‡å¯¼æ•°æ®ä¼ é€ï¼Œè·¯ç”±å™¨è¿æ¥ç½‘ç»œå„æ®µï¼Œæ‰€ä»¥è·¯ç”±å™¨å±äºç½‘ç»œå±‚ã€‚åœ¨ç½‘ç»œä¸­ï¼Œâ€œè·¯ç”±â€æ˜¯åŸºäºç¼–å€æ–¹æ¡ˆã€ä½¿ç”¨æ¨¡å¼ä»¥åŠå¯è¾¾æ€§æ¥æŒ‡å¼•æ•°æ®çš„å‘é€|è·¯ç”±å™¨|IPã€Novellå…¬å¸çš„IPXä»¥åŠAppleTalkåè®®|
|ä¼ è¾“å±‚|ä¼ è¾“åè®®åŒæ—¶è¿›è¡Œæµé‡æ§åˆ¶æˆ–æ˜¯åŸºäºæ¥æ”¶æ–¹å¯æ¥æ”¶æ•°æ®çš„å¿«æ…¢ç¨‹åº¦è§„å®šé€‚å½“çš„å‘é€é€Ÿç‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¼ è¾“å±‚æŒ‰ç…§ç½‘ç»œèƒ½å¤„ç†çš„æœ€å¤§å°ºå¯¸å°†è¾ƒé•¿çš„æ•°æ®åŒ…è¿›è¡Œå¼ºåˆ¶åˆ†å‰²ã€‚|||TCP/IPåè®®å¥—ä¸­çš„TCP(ä¼ è¾“æ§åˆ¶åè®®)ï¼Œå¦ä¸€é¡¹ä¼ è¾“å±‚æœåŠ¡æ˜¯IPX%2FSPXåè®®é›†çš„SPX(åºåˆ—åŒ…äº¤æ¢)|
|ä¼šè¯å±‚|OSIå‚è€ƒæ¨¡å‹çš„ç¬¬äº”å±‚ã€‚è´Ÿè´£åœ¨ç½‘ç»œä¸­çš„ä¸¤èŠ‚ç‚¹ä¹‹é—´å»ºç«‹ã€ç»´æŒå’Œç»ˆæ­¢é€šä¿¡ã€‚|ä¼šè¯å±‚çš„åŠŸèƒ½åŒ…æ‹¬ï¼šå»ºç«‹é€šä¿¡é“¾æ¥ï¼Œä¿æŒä¼šè¯è¿‡ç¨‹é€šä¿¡é“¾æ¥çš„ç•…é€šï¼ŒåŒæ­¥ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å¯¹è¯ï¼Œå†³å®šé€šä¿¡æ˜¯å¦è¢«ä¸­æ–­ä»¥åŠé€šä¿¡ä¸­æ–­æ—¶å†³å®šä»ä½•å¤„é‡æ–°å‘é€|||
|è¡¨ç¤ºå±‚|åœ¨è¡¨ç¤ºå±‚ï¼Œæ•°æ®å°†æŒ‰ç…§ç½‘ç»œèƒ½ç†è§£çš„æ–¹æ¡ˆè¿›è¡Œæ ¼å¼åŒ–|è¡¨ç¤ºå±‚ç®¡ç†æ•°æ®çš„è§£å¯†ä¸åŠ å¯†, è¡¨ç¤ºå±‚åè®®è¿˜å¯¹å›¾ç‰‡å’Œæ–‡ä»¶æ ¼å¼ä¿¡æ¯è¿›è¡Œè§£ç å’Œç¼–ç |||
|åº”ç”¨å±‚|ä¸»è¦è´Ÿè´£å¯¹è½¯ä»¶æä¾›æ¥å£ä»¥ä½¿ç¨‹åºèƒ½ä½¿ç”¨ç½‘ç»œæœåŠ¡ã€‚æŸä¸ªç‰¹åˆ«åº”ç”¨ç¨‹åºï¼Œåº”ç”¨å±‚æä¾›çš„æœåŠ¡åŒ…æ‹¬æ–‡ä»¶ä¼ è¾“ã€æ–‡ä»¶ç®¡ç†ä»¥åŠç”µå­é‚®ä»¶çš„ä¿¡æ¯å¤„ç†|åº”ç”¨å±‚ä¹Ÿç§°ä¸ºåº”ç”¨å®ä½“(AE)ï¼Œå®ƒç”±è‹¥å¹²ä¸ªç‰¹å®šåº”ç”¨æœåŠ¡å…ƒç´ (SASEï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªå…¬å…±åº”ç”¨æœåŠ¡å…ƒç´ (CASE)ç»„æˆã€‚æ¯ä¸ªSASEæä¾›ç‰¹å®šçš„åº”ç”¨æœåŠ¡ï¼Œä¾‹å¦‚æ–‡ä»¶è¿è¾“è®¿é—®å’Œç®¡ç†(FTAM)ã€ç”µå­æ–‡ç”µå¤„ç†(MHS)ã€è™šæ‹Ÿç»ˆç«¯åè®®(VAP)ç­‰ã€‚CASEæä¾›ä¸€ç»„å…¬å…±çš„åº”ç”¨æœåŠ¡ï¼Œä¾‹å¦‚è”ç³»æ§åˆ¶æœåŠ¡å…ƒç´ (ACSE)ã€å¯é è¿è¾“æœåŠ¡å…ƒç´ (RTSE)å’Œè¿œç¨‹æ“ä½œæœåŠ¡å…ƒç´ (ROSE)ç­‰|||

## 14.2 ç½‘ç»œåè®®
|åè®®|ç‰¹ç‚¹|åŒºåˆ«|
|:-:|:-:|:-:|
|HTTP|||
|HTTPS|||
|MQTT|||
|TCPIP|||
|UDP|||
|è“ç‰™BLE4.0|||
||||

## æ’åº/æŸ¥æ‰¾ç®—æ³•

é”
æŸ¥æ‰¾
æ’åº
KMP
æ•°æ®ç»“æ„
nop rl dl slam

## é›¶æ‹·è´/DMA
https://juejin.cn/post/7016498891365302302

+ 

# 
1. ä½œä¸ºæ¶æ„å¸ˆ  è¦æœ‰ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç† <= Github: dependBot
  + [spring 2.4 config change](https://spring.io/blog/2020/08/14/config-file-processing-in-spring-boot-2-4)
2. å­¦ä¼š github ci/cd 
3. å­¦ä¼š github pr/cr
4. é¢†åŸŸé©±åŠ¨è®¾è®¡
5. microservices
6. devops
7. cloud native
8. ç†Ÿç»ƒä½¿ç”¨è‹±æ–‡è·å–èµ„æ–™
9.  å­¦ä¼šç”¨è‹±æ–‡æŸ¥æ‰¾
10. åˆ¶å®šä»£ç è§„èŒƒå’Œæ¥å£è§„èŒƒ
    + åˆ†é¡µæ¥å£å¿…é¡»è¿”å›ä»¥ä¸‹å­—æ®µ: åˆ†é¡µç»“æœ, å½“å‰é¡µ, æ€»ç»“æœæ•°, æ€»é¡µæ•°
    + å½»åº•åºŸå¼ƒä»£ç å¿…é¡»åˆ é™¤, æˆ–è€…æ³¨é‡Šåå¹¶æ ‡è®° @Deprecated
    + å‰ç«¯é¡¹ç›®å frontend ç»“å°¾, åç«¯ backend ç»“å°¾
    + æ•°æ®åº“ä¸¥ç¦ä½¿ç”¨ enum, å› ä¸º enum é»˜è®¤å­˜å…¥æ•°æ®åº“çš„å€¼ä¸ºè¯¥ enum åœ¨æšä¸¾ç±»ä¸­çš„æ’åº; å®åœ¨éœ€è¦ä½¿ç”¨æ—¶, éœ€è¦ä½¿ç”¨ @Enumerated(EnumType.STRING) ä¹‹ç±»çš„æ³¨è§£, æŒ‡å®šå­˜å‚¨ä¸º string
    + åç«¯å¿…é¡»åœ¨æ¥å£æ–‡æ¡£ä¸­æ˜ç¡®è¿”å›ç±»ä»¥åŠè¿”å›å€¼çš„æè¿°
    + ç¦æ­¢ç”¨ map, è€Œæ˜¯ç”¨å¯¹è±¡æ¥æ¥æ”¶ç±»
    + æ–¹æ³•å¿…é¡»å†™æ³¨é‡Š, æ•°æ®åº“å­—æ®µå¿…é¡»å†™æ³¨é‡Š, 
    + ä»£ç å¿…é¡»é¿å…å†—ä½™/é‡å¤/æ¶å¿ƒçš„ä»£ç , å¿…é¡»ç®€æ´, ç¦æ­¢ä¸€å¤„åŠŸèƒ½å¤šå¤„å®šä¹‰
    + å¿…é¡»ä½¿ç”¨ lombok æ¥å‡å°‘è€¦åˆ
    + ä»£ç è§„èŒƒåŒ…æ‹¬: å‘½åè§„èŒƒ, æ³¨é‡Šè§„èŒƒ, 
    + è€¦åˆåŒ…æ‹¬: é€»è¾‘è€¦åˆ, ä»£ç è€¦åˆ, è®¾è®¡è€¦åˆ, è¡¨ç»“æ„è€¦åˆ
    + å¿…é¡»é€»è¾‘åˆ é™¤, ä¸¥ç¦ç‰©ç†åˆ é™¤
    + æ¥å£å¿…é¡» public å£°æ˜
11. ci å‡ºé”™è€ƒè™‘ä»£ç å¼‚å¸¸å¯¼è‡´çš„å›é€€
12. [ä¸€ç¯‡å¸¦ä½ äº†è§£OLTP vs. OLAP](https://www.51cto.com/article/701725.html)
13. [Propertieså’ŒYmlæœ‰ä»€ä¹ˆåŒºåˆ«](https://wangxiao.xisaiwang.com/ucenter2/zhibo/list.html)

 ##  ä¿æŒå¥½çš„å¯¹æ¥ä¹ æƒ¯
+ ä¿æŒä»£ç è§„èŒƒ
+ æ—¶åˆ»æ€è€ƒè½¯ä»¶å·¥ç¨‹

+ åšå¥½å•å…ƒæµ‹è¯•
+ æ¥å£ä»¥ swagger åœ°å€çš„å½¢å¼ç»™åˆ°å‰ç«¯, å…·å¤‡å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹å’Œæ¥å£æ–‡æ¡£è¯´æ˜; å¦‚ä½¿ç”¨åˆ°ç½‘å…³, å¦ç»™å‡ºç½‘å…³è°ƒç”¨å½¢å¼

é¡¹ç›®è®¾è®¡ -> UIè®¾è®¡ -> å®šä¹‰æ¥å£ -> å¼€å‘ -> äº¤ä»˜æ¥å£æ–‡æ¡£ -> æµ‹è¯• -> äº¤ä»˜; 

+ å¤šå¯¹å¤š: ä¸­é—´è¡¨; ä¸€å¯¹å¤š, key-value
+ åˆ©ç”¨ jekins æ‰“åŒ…çš„å¥½å¤„, åˆ©ç”¨æœåŠ¡å™¨æ€§èƒ½, è€Œä¸æ˜¯å—æœ¬æœºæ€§èƒ½æŸè€—



# é«˜å¹¶å‘

https://cloud.tencent.com/developer/article/2131980

## å¹¶å‘åŸç†

### tomcat çš„å¹¶å‘  æœ¬è´¨æ˜¯å¤šçº¿ç¨‹å— 

å¯¹ âœ…ï¼ŒTomcat çš„å¹¶å‘**æœ¬è´¨å°±æ˜¯åŸºäºå¤šçº¿ç¨‹**ï¼Œä¸è¿‡è¿˜è¦åˆ†å‡ ç§ä¸åŒçš„ Connectorï¼ˆè¿æ¥å™¨ï¼‰å®ç°æ¨¡å‹æ¥ç†è§£ï¼š

------

#### 1. Tomcat çš„æ ¸å¿ƒå¹¶å‘æ¨¡å‹

- **æ¯ä¸ª HTTP è¯·æ±‚ â†’ äº¤ç»™ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†**ï¼ˆå…¸å‹çš„é˜»å¡ I/O / BIO æˆ– NIO + çº¿ç¨‹æ± æ¨¡å‹ï¼‰ã€‚
- è¿™äº›çº¿ç¨‹æ¥è‡ª **Tomcat çš„çº¿ç¨‹æ± ï¼ˆExecutorï¼‰**ã€‚
- æ‰€ä»¥ Tomcat çš„å¹¶å‘èƒ½åŠ›ï¼Œå–å†³äºï¼š
  - å¯ç”¨çº¿ç¨‹æ•°ï¼ˆ`maxThreads`ï¼Œé»˜è®¤ 200ï¼‰
  - è¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼ˆå¦‚æœçº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡ï¼Œå°±å‡å°‘äº†å¯ç”¨çº¿ç¨‹ï¼‰

ğŸ‘‰ æœ¬è´¨å°±æ˜¯ **çº¿ç¨‹å¹¶å‘**ã€‚

------

#### 2. Tomcat çš„ä¸åŒ I/O æ¨¡å¼

Tomcat æä¾›äº†ä¸åŒçš„ Connector å®ç°ï¼š

1. **BIOï¼ˆé˜»å¡ I/Oï¼‰**
   - ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ã€‚
   - å¦‚æœçº¿ç¨‹é˜»å¡ï¼Œä¸èƒ½å¤„ç†åˆ«çš„è¯·æ±‚ã€‚
   - æ€§èƒ½å·®ï¼Œç°ä»£å‡ ä¹ä¸ç”¨ã€‚
2. **NIOï¼ˆéé˜»å¡ I/Oï¼‰** â† é»˜è®¤
   - åº•å±‚ç”¨ `Selector` å¤šè·¯å¤ç”¨ socketã€‚
   - ä½†å½“è¯·æ±‚è¿›å…¥åº”ç”¨å±‚ï¼ˆServletï¼‰ï¼Œè¿˜æ˜¯ä¼šäº¤ç»™ **çº¿ç¨‹æ± é‡Œçš„ä¸€ä¸ªçº¿ç¨‹** æ¥è·‘ã€‚
   - æ‰€ä»¥åº”ç”¨ä»£ç é‡Œä¾ç„¶æ˜¯â€œè¯·æ±‚çº¿ç¨‹æ¨¡å‹â€ã€‚
3. **NIO2ï¼ˆåŸºäº JDK7 AIOï¼‰**
   - æ”¯æŒå¼‚æ­¥ I/Oï¼Œå’Œ Servlet 3.1 çš„å¼‚æ­¥å¤„ç†é…åˆã€‚
   - ä½†åº”ç”¨å±‚å¦‚æœä¸ç”¨ Servlet å¼‚æ­¥ç‰¹æ€§ï¼Œä¾ç„¶æ˜¯â€œä¸€è¯·æ±‚ä¸€çº¿ç¨‹â€ã€‚

------

#### 3. ä¸ `@Async` / Servlet 3.0+ Async çš„å…³ç³»

- é»˜è®¤ï¼šè¯·æ±‚çº¿ç¨‹è¦ä¸€ç›´ç­‰é€»è¾‘è·‘å®Œï¼Œæ‰èƒ½è¿”å›ã€‚
- å¦‚æœä½ ç”¨ Servlet 3.0+ çš„ **å¼‚æ­¥ Servlet** æˆ– Spring çš„ **`@Async`**ï¼š
  - è¯·æ±‚çº¿ç¨‹å¯ä»¥æå‰é‡Šæ”¾å›çº¿ç¨‹æ± ï¼›
  - çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘äº¤ç»™åå°çº¿ç¨‹æ± å»è·‘ã€‚
  - è¿™å°±è®© Tomcat æ›´å¥½åœ°åˆ©ç”¨çº¿ç¨‹ï¼Œé¿å…çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡ã€‚

------

#### 4. å¯¹æ¯” Python WSGI / ASGI

- **Tomcat å¹¶å‘ = çº¿ç¨‹æ± æ¨¡å‹**ï¼ˆä¸€è¯·æ±‚ä¸€çº¿ç¨‹ï¼Œé™¤éç”¨å¼‚æ­¥ Servletï¼‰ã€‚
- **WSGIï¼ˆFlask + gunicornï¼‰= è¿›ç¨‹/çº¿ç¨‹æ± æ¨¡å‹**ï¼Œå‡ ä¹ä¸€æ ·ï¼Œé  worker æ•°é‡æ”¯æ’‘å¹¶å‘ã€‚
- **ASGIï¼ˆFastAPI + uvicornï¼‰= åç¨‹æ¨¡å‹**ï¼Œä¸æ˜¯â€œè¯·æ±‚çº¿ç¨‹â€ï¼Œè€Œæ˜¯â€œè¯·æ±‚åç¨‹â€ï¼ŒæŒ‚èµ·æ—¶ä¸å çº¿ç¨‹ã€‚

------

âœ… ç»“è®ºï¼š
 Tomcat çš„å¹¶å‘æ¨¡å‹**æ ¸å¿ƒå°±æ˜¯çº¿ç¨‹æ± **ã€‚å³ä¾¿åº•å±‚æ˜¯ NIO/AIOï¼Œåˆ°äº† Servlet å±‚è¿˜æ˜¯â€œä¸€è¯·æ±‚ä¸€çº¿ç¨‹â€ã€‚å¦‚æœè¦çªç ´è¿™ä¸ªé™åˆ¶ï¼Œéœ€è¦ç”¨ **å¼‚æ­¥ Servlet API** æˆ– **WebFlux(Netty)** æ‰èƒ½è¿›å…¥äº‹ä»¶å¾ªç¯/å›è°ƒå¼æ¨¡å‹ã€‚

## åç«¯æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡

å“åº”æ—¶é—´ å¹¶å‘æ•°ç›® ååé‡ã€‚

å¸¸ç”¨çš„ååé‡æŒ‡æ ‡ï¼š â€ƒâ€ƒâ‘ TPS(æ¯ç§’äº‹åŠ¡æ•°)ã€

â‘¡HPS(æ¯ç§’Httpè¯·æ±‚æ•°)ã€

â‘¢QPS(æ¯ç§’æŸ¥è¯¢æ•°ï¼Œ)

å¸¸ç”¨çš„æ€§èƒ½è®¡æ•°å™¨æœ‰ï¼šSystem Loadã€å¯¹è±¡å’Œçº¿ç¨‹æ•°ã€CPUä½¿ç”¨ã€å†…å­˜ä½¿ç”¨ã€ç£ç›˜å’Œç½‘ç»œIOç­‰æŒ‡æ ‡ã€‚ 

æ€§èƒ½æµ‹è¯•çš„å‡ ä¸ªå‚è€ƒç‚¹ï¼š æ€§èƒ½æµ‹è¯• 

è´Ÿè½½æµ‹è¯•ï¼šç³»ç»Ÿçš„æŸé¡¹æˆ–è€…å¤šæƒ³æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°å®‰å…¨ä¸´ç•Œå€¼æ—¶çš„å¹¶å‘æ•° 

å‹åŠ›æµ‹è¯• 

ç¨³å®šæ€§æµ‹è¯•ã€‚ç¨³å®šæ€§æµ‹è¯•ä¸»è¦æ˜¯é•¿æ—¶é—´ç»™ç³»ç»Ÿä¸€å®šçš„å‹åŠ›ï¼Œçœ‹ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ ç½‘ç«™çš„æ€§èƒ½ä¼˜åŒ–ä¸‰ç»´åº¦

## **åå°æœåŠ¡å™¨å¸¸ç”¨çš„ä¼˜åŒ–æ–¹å¼**

ç¼“å­˜ é›†ç¾¤ å¼‚æ­¥ ä»£ç ä¼˜åŒ– å­˜å‚¨ä¼˜åŒ– ç¼“å­˜ç›¸å…³çŸ¥è¯†

## ç¼“å­˜

**åå°æ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€å®šå¾‹ï¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æ€§èƒ½ã€‚**

#### **ç¼“å­˜çš„æœ¬è´¨**

ç¼“å­˜çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå†…å­˜Hashè¡¨ï¼Œæ•°æ®ä»¥ä¸€å¯¹KeyValueé”®å€¼å¯¹å­˜å‚¨åœ¨å†…å­˜Hashè¡¨ä¸­ã€‚ä¸»è¦ç”¨æˆ·å­˜æ”¾è¯»å†™æ¯”å¾ˆé«˜ã€å¾ˆå°‘å˜åŒ–çš„æ•°æ®ï¼Œç½‘ç«™æ•°æ®é€šå¸¸éµå¾ªâ€œäºŒå…«å®šå¾‹â€ï¼Œå³80%çš„è®¿é—®è½åœ¨20%çš„æ•°æ®ä¸Šï¼Œå› æ­¤ï¼Œå°†è¿™20%çš„æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œå¯ä»¥å¾ˆå¥½çš„æ”¹å–„ç³»ç»Ÿæ€§èƒ½ã€‚

##### **åˆç†çš„ä½¿ç”¨ç¼“å­˜**

åˆç†çš„ä½¿ç”¨ç¼“å­˜å¯¹æé«˜ç³»ç»Ÿæ€§èƒ½æœ‰å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯ä¸åˆç†çš„ä½¿ç”¨ç¼“å­˜åè€Œä¼šæˆä¸ºç³»ç»Ÿçš„ç´¯èµ˜ç”šè‡³é£é™©ã€‚æ»¥ç”¨ç¼“å­˜çš„ä¸‰ç§æƒ…å†µå¦‚ä¸‹ï¼š

##### **é¢‘ç¹ä¿®æ”¹çš„æ•°æ®** â€ƒâ€ƒ

æ•°æ®çš„è¯»å†™æ¯”è‡³å°‘åº”è¯¥æ˜¯2:1ä»¥ä¸Šï¼Œå³å†™å…¥ä¸€æ¬¡ç¼“å­˜ï¼Œåœ¨æ•°æ®æ›´æ–°å‰è‡³å°‘è¯»å†™ä¸¤æ¬¡ï¼Œç¼“å­˜æ‰æœ‰æ„ä¹‰ã€‚çœŸæ­£å®è·µä¸­è¿™ä¸ªæ¯”ä¾‹å¯èƒ½ä¼šæ›´é«˜ã€‚

##### **æ²¡æœ‰çƒ­ç‚¹çš„è®¿é—®** â€ƒâ€ƒ

å¦‚æœåº”ç”¨ç³»ç»Ÿè®¿é—®æ•°æ®æ²¡æœ‰çƒ­ç‚¹ï¼Œä¸éµå¾ªäºŒå…«å®šå¾‹ï¼Œå³å¤§éƒ¨åˆ†æ•°æ®è®¿é—®å¹¶æ²¡æœ‰é›†ä¸­åœ¨å°éƒ¨åˆ†æ•°æ®ä¸­ï¼Œé‚£ä¹ˆç¼“å­˜ä¹Ÿæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ•°æ®è¿˜æ²¡æœ‰è¢«å†æ¬¡è®¿é—®å°±å·²ç»è¢«æŒ¤å‡ºç¼“å­˜äº†ã€‚

##### **æ•°æ®çš„ä¸ä¸€è‡´ä¸è„è¯»** â€ƒâ€ƒ

å†™å…¥ç¼“å­˜çš„æ•°æ®æœ€å¥½èƒ½å®¹å¿ä¸€å®šæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æœ€å¥½å¯¹ç¼“å­˜çš„æ•°æ®è®¾ç½®å¤±æ•ˆæ—¶é—´(å›ºå®šå€¼+ä¸€å®šèŒƒå›´çš„éšæœºå€¼)ã€‚å¦‚æœä¸èƒ½å®¹å¿æ•°æ®çš„ä¸ä¸€è‡´ï¼Œå¿…é¡»åœ¨æ•°æ®æ›´æ–°æ—¶ï¼Œåˆ é™¤å¯¹åº”çš„ç¼“å­˜(æ€è€ƒï¼šä¸ºä»€ä¹ˆä¸æ˜¯æ›´æ–°ç¼“å­˜)[å¯ä»¥å‚è€ƒè¿™ä¸ªæ–‡æ¡£](https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.cnblogs.com/llzhang123/p/9037346.html)ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µåªé’ˆå¯¹è¯»å†™æ¯”éå¸¸é«˜çš„æƒ…å†µã€‚

#### ç¼“å­˜çš„å¸¸è§é—®é¢˜ä¼˜åŒ–æ‰‹æ®µ

##### ç¼“å­˜é›ªå´©

 â€ƒâ€ƒç¼“å­˜é›ªå´©æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼šç”±äºåŸæœ‰ç¼“å­˜å¤±æ•ˆï¼Œæ–°ç¼“å­˜æœªåˆ°æœŸé—´(ä¾‹å¦‚ï¼šæˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨åŒä¸€æ—¶åˆ»å‡ºç°å¤§é¢ç§¯çš„ç¼“å­˜è¿‡æœŸ)ï¼Œæ‰€æœ‰åŸæœ¬åº”è¯¥è®¿é—®ç¼“å­˜çš„è¯·æ±‚éƒ½å»æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œè€Œå¯¹æ•°æ®åº“CPUå’Œå†…å­˜é€ æˆå·¨å¤§å‹åŠ›ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºã€‚ä»è€Œå½¢æˆä¸€ç³»åˆ—è¿é”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚

è¯¥ç±»é—®é¢˜çš„è§£å†³æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š

â‘ åŠ é”æ’é˜Ÿã€‚å¤§æ¦‚åŸç†æ˜¯åœ¨å»æ•°æ®åº“å–æ•°æ®çš„æ—¶å€™åŠ é”æ’é˜Ÿï¼Œè¯¥æ–¹æ³•ä»…ä»…é€‚ç”¨äºå¹¶å‘é‡ä¸é«˜çš„æƒ…å†µã€‚

â‘¡åœ¨åŸæœ‰å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸ŠåŠ ä¸€ä¸ªåˆç†çš„éšæœºå€¼(0-5åˆ†é’Ÿ)ã€‚åˆ†å¸ƒå¼åœºæ™¯ä¸‹æœ€å¸¸è§çš„æ–¹å¼(å•æœºä¹Ÿå¯ä»¥)ã€‚

â‘¢ç»™ç¼“å­˜åŠ æ ‡è®°ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆä¹‹åæ›´æ–°ç¼“å­˜æ•°æ®ã€‚

##### ç¼“å­˜ç©¿é€

 â€ƒâ€ƒç¼“å­˜ç©¿é€æ˜¯æŒ‡ç”¨æˆ·æŸ¥è¯¢æ•°æ®ï¼Œåœ¨æ•°æ®åº“æ²¡æœ‰ï¼Œè‡ªç„¶åœ¨ç¼“å­˜ä¸­ä¹Ÿä¸ä¼šæœ‰ã€‚è¿™æ ·å°±å¯¼è‡´ç”¨æˆ·æŸ¥è¯¢çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°ï¼Œæ¯æ¬¡éƒ½è¦å»æ•°æ®åº“å†æŸ¥è¯¢ä¸€éï¼Œç„¶åè¿”å›ç©ºï¼ˆç›¸å½“äºè¿›è¡Œäº†ä¸¤æ¬¡æ— ç”¨çš„æŸ¥è¯¢ï¼‰ã€‚

è¯¥ç±»é—®é¢˜çš„ä¸»è¦è§£å†³æ–¹å¼ã€‚

â‘ ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšè¿‡æ»¤ã€‚è¯¥æ–¹æ³•ä»…ä»…ç”¨äºæŸ¥è¯¢ä¸€ä¸ªä¸å¯èƒ½å­˜åœ¨çš„æ•°æ®ã€‚

â‘¡æŠŠä¸å­˜åœ¨çš„æ•°æ®ä¹Ÿç¼“å­˜èµ·æ¥ã€‚æœ€ä½³å®è·µï¼šå•ç‹¬è®¾ç½®æ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚è¯´äº”åˆ†é’Ÿã€‚

##### ç¼“å­˜é¢„çƒ­

 â€ƒâ€ƒç¼“å­˜ä¸­å­˜æ”¾çš„æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œçƒ­ç‚¹æ•°æ®åˆæ˜¯ç¼“å­˜ç³»ç»Ÿåˆ©ç”¨æŸç§ç®—æ³•å¯¹ä¸æ–­è®¿é—®çš„æ•°æ®ç­›é€‰æ·˜æ±°å‡ºæ¥çš„ï¼Œåœ¨é‡å»ºç¼“å­˜æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿçš„æ€§èƒ½å’Œæ•°æ®åº“è´Ÿè½½éƒ½ä¸å¤ªå¥½ï¼Œé‚£ä¹ˆå¤šå¥½çš„æ–¹å¼å°±æ˜¯åœ¨ç¼“å­˜ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™å°±æŠŠçƒ­ç‚¹æ•°æ®åŠ è½½å¥½ï¼Œè¿™ä¸ªç¼“å­˜é¢„åŠ è½½çš„æ‰‹æ®µå«åšç¼“å­˜é¢„çƒ­ã€‚å¯¹äºä¸€äº›å…ƒæ•°æ®å¦‚çœå¸‚åŒºåˆ—è¡¨ï¼Œç±»ç›®ä¿¡æ¯ï¼Œå°±å¯ä»¥åœ¨å¯åŠ¨çš„åŠ è½½æ•°æ®åº“ä¸­çš„å…¨éƒ¨æ•°æ®ã€‚

#### **åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„**

åˆ†å¸ƒå¼ç¼“å­˜æ˜¯æŒ‡ç¼“å­˜éƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤ä¸­ï¼Œä»¥é›†ç¾¤æ–¹å¼æä¾›ç¼“å­˜æœåŠ¡ï¼Œå…¶æ¶æ„æ–¹å¼æœ‰ä¸¤ç§ï¼š

â‘ ä»¥JBosss Cacheä¸ºä»£è¡¨çš„éœ€è¦æ›´æ–°åŒæ­¥çš„åˆ†å¸ƒå¼ç¼“å­˜(åœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸­ä¿å­˜ç›¸åŒçš„ç¼“å­˜æ•°æ®)ã€‚

â‘¡ä»¥Memcacheä¸ºä»£è¡¨çš„äº’ä¸é€šä¿¡çš„åˆ†å¸ƒå¼ç¼“å­˜(åº”ç”¨ç¨‹åºé€šè¿‡ä¸€è‡´æ€§Hashç­‰è·¯ç”±ç®—æ³•é€‰æ‹©ç¼“å­˜æœåŠ¡å™¨è¿œç¨‹è®¿é—®è¿œç¨‹æ•°æ®ï¼Œå¯ä»¥ä¼šå®¹æ˜“çš„æ‰©å®¹ï¼Œå…·æœ‰è‰¯å¥½çš„å¯ä¼¸ç¼©æ€§)ã€‚

### å›è¡¨

## å¼‚æ­¥

ä½¿ç”¨å¼‚æ­¥æ“ä½œï¼Œå¯ä»¥å¤§å¹…åº¦æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼Œä½¿ç”¨å¼‚æ­¥çš„ä¸¤ç§åœºæ™¯ï¼Œé«˜å¹¶å‘ã€å¾®æœåŠ¡ï¼›

â‘ é«˜å¹¶å‘ï¼Œåœ¨ä¸ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„è¯·æ±‚æ•°æ®ç›´æ¥å†™å…¥æ•°æ®åº“ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¼šå¯¹æ•°æ®åº“é€ æˆä¸€å®šçš„å‹åŠ›ï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—å“åº”å»¶è¿ŸåŠ å‰§ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰å¾ˆå¥½çš„å‰Šå³°ä½œç”¨ï¼Œåœ¨ç”µå­å•†åŠ¡ç½‘ç«™ä¿ƒé”€æ´»åŠ¨ä¸­ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¸¸è§çš„æŠ€æœ¯æ‰‹æ®µã€‚

â‘¡å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ï¼Œåœ¨å¾®æœåŠ¡æµè¡Œçš„å½“ä¸‹ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è°ƒç”¨å…¶ä»–ç³»ç»Ÿçš„å¾®æœåŠ¡æ¥å£ï¼Œåªæ˜¯ä¸ºäº†é€šçŸ¥å…¶ä»–ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¸å…³å¿ƒç»“æœï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ± å¼‚æ­¥è°ƒç”¨å…¶ä»–ç³»ç»Ÿçš„å¾®æœåŠ¡ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¨‹åºçš„å“åº”æ—¶é—´ã€‚

ä»»ä½•å¯ä»¥æ™šç‚¹çš„äº‹æƒ…éƒ½åº”è¯¥æ™šç‚¹å†åšã€‚

## é›†ç¾¤

åœ¨ç½‘ç«™é«˜å¹¶å‘è®¿é—®çš„åœºæ™¯æ´—ä¸‹ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯ä¸ºä¸€ä¸ªåº”ç”¨æ„å»ºä¸€ä¸ªç”±å¤šå°æœåŠ¡å™¨ç»„æˆçš„æœåŠ¡å™¨é›†ç¾¤ï¼Œå¯ä»¥é¿å…å•ä¸€æœåŠ¡å™¨å› è´Ÿè½½å‹åŠ›è¿‡å¤§è€Œå“åº”ç¼“æ…¢ã€‚å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡æŠ€æœ¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š

â‘ HTTPé‡å®šå‘è´Ÿè½½å‡è¡¡ï¼Œä¸åˆ©äºSEOï¼Œä¸æ¨èã€‚

â‘¡DNSåŸŸåè§£æè´Ÿè½½å‡è¡¡ï¼Œè®¸å¤šDNSæœåŠ¡å™¨è¿˜æ”¯æŒåŸºäºåœ°ç†ä½ç½®çš„åŸŸåè§£æï¼Œä¼šå°†åŸŸåè§£ææˆè·ç¦»ç”¨æˆ·åœ°ç†æœ€è¿‘çš„ä¸€ä¸ªæœåŠ¡å™¨åœ°å€ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚å¤§å…¬å¸å¸¸ç”¨çš„æ‰‹æ®µã€‚

â‘¢åå‘ä»£ç†è´Ÿè½½å‡è¡¡(åº”ç”¨å±‚è´Ÿè½½å‡è¡¡)ï¼Œå¸¸è§äº§å“ï¼šNginx,åå‘ä»£ç†æœåŠ¡å™¨çš„æ€§èƒ½å¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚

â‘£IPè´Ÿè½½å‡è¡¡ï¼Œåœ¨å†…æ ¸è¿›ç¨‹å®Œæˆæ•°æ®åˆ†å‘ï¼Œå«åå‘ä»£ç†è´Ÿè½½å‡è¡¡æœ‰æ›´å¥½çš„å¤„ç†æ€§èƒ½ï¼Œç½‘å¡å’Œå¸¦å®½ä¼šæˆä¸ºä¸»è¦çš„ç“¶é¢ˆã€‚

â‘¤æ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡(ä¸‰è§’ä¼ è¾“æ¨¡å¼)ï¼ŒåˆåDR(ç›´æ¥è·¯ç”±æ¨¡å¼)ï¼Œä¹Ÿæ˜¯å¤§å‹ç½‘ç«™æ˜Œè¿å®«çš„è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œåœ¨Linuxå¹³å°ä¸Šæœ€å¥½çš„é“¾è·¯å±‚è´Ÿè½½å‡è¡¡äº§å“æ˜¯LVSã€‚

## ä»£ç ä¼˜åŒ–

ç½‘ç«™çš„ä¸šåŠ¡é€»è¾‘å®ç°ä»£ç ä¸»è¦éƒ¨ç½²åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œåˆç†çš„ä¼˜åŒ–ä»£ç ä¹Ÿå¯ä»¥å¾ˆå¥½çš„æ”¹å–„ç½‘ç«™æ€§èƒ½ã€‚å‡ ç§å¸¸ç”¨çš„å‡ ç§ä»£ç ä¼˜åŒ–æ–¹å¼ï¼š

â‘ åˆç†ä½¿ç”¨å¤šçº¿ç¨‹ï¼ŒæœåŠ¡å™¨çš„å¯åŠ¨çš„çº¿ç¨‹æ•°å‚è€ƒå€¼ï¼š[ä»»åŠ¡æ‰§è¡Œæ—¶é—´/(ä»»åŠ¡æ‰§è¡Œæ—¶é—´-IOç­‰å¾…æ—¶é—´)]CPUå†…æ ¸æ•°ã€‚

â‘¡èµ„æºå¤ç”¨ï¼Œè¦å°½é‡å‡å°‘é‚£äº›å¼€é”€å¾ˆå¤§çš„ç³»ç»Ÿèµ„æºçš„åˆ›å»ºå’Œé”€æ¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ï¼Œç½‘ç»œé€šä¿¡è¿æ¥ã€çº¿ç¨‹ã€å¤æ‚å¯¹è±¡ï¼Œä»ç¼–ç¨‹è§’åº¦ï¼Œèµ„æºå¤ç”¨ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œå•ä¾‹ã€å¯¹è±¡æ± ã€‚

â‘¢æ•°æ®ç»“æ„ï¼Œå‰é¢ç¼“å­˜éƒ¨åˆ†å°±å·²ç»æåˆ°äº†Hashè¡¨çš„åŸºæœ¬åŸç†ï¼ŒHashè¡¨çš„è¯»å†™æ€§èƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºHashCodeçš„éšæœºæ€§ï¼Œå³HashCodeè¶Šæ•£åˆ—ï¼ŒHashè¡¨çš„å†²çªå°±è¶Šå°‘ï¼Œç›®å‰æ¯”è¾ƒå¥½çš„Hashæ•£åˆ—ç®—æ³•æ˜¯Time33ç®—æ³•ï¼Œç®—æ³•åŸå‹ä¸ºï¼šhash(i) = hash(i-1)33+str[i]ã€‚

â‘£åƒåœ¾å›æ”¶ï¼Œæ¯”å¦‚è¯´åœ¨JVMé‡Œï¼Œåˆç†è®¾ç½®Young Generationå’ŒOld Generationçš„å¤§å°ï¼Œå°½é‡å‡å°‘Full GCï¼Œå¦‚æœè®¾ç½®åˆç†çš„è¯ï¼Œå¯ä»¥åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´åšåˆ°ä»ä¸è¿›è¡ŒFull GCã€‚

## å­˜å‚¨ä¼˜åŒ–

åœ¨ç½‘ç«™åº”ç”¨ä¸­ï¼Œæµ·é‡æ˜¯çš„æ•°æ®è¯»å†™å¯¹ç£ç›˜è®¿é—®ä¼šé€ æˆä¸€å®šçš„å‹åŠ›ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡Cacheè§£å†³ä¸€éƒ¨åˆ†æ•°æ®è¯»å‹åŠ›ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œç£ä»ç„¶æ˜¯ç³»ç»Ÿæœ€ä¸¥é‡çš„ç“¶é¢ˆã€‚

æœºæ¢°ç¡¬ç›˜VSå›ºæ€ç¡¬ç›˜
 â€ƒâ€ƒè¿™ä¸¤ä¸ªçš„åŒºåˆ«æˆ‘ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“äº†å§ï¼Œæœºæ¢°ç¡¬ç›˜æ˜¯é€šè¿‡é©¬è¾¾é©±åŠ¨ç£å¤´è‡‚å¸¦åŠ¨ç£å¤´åˆ°æŒ‡å®šçš„ç£ç›˜ä½ç½®è®¿é—®æ•°æ®ï¼Œè¿™ä¸ªæ•ˆç‡æˆ‘å°±ä¸ç”¨å¤šè¯´äº†å§ï¼Œç›¸åï¼Œå›ºæ€ç¡¬ç›˜çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨å¯ä»¥æŒä¹…è®°å¿†çš„ç¡…æ™¶ä½“ä¸Šï¼Œå› æ­¤å¯ä»¥åƒå†…å­˜ä¸€æ ·éšæœºè®¿é—®ï¼Œè€Œä¸”åŠŸè€—æ›´å°ã€‚

B+æ ‘VS. LSMæ ‘
 â€ƒâ€ƒB+æ ‘æ˜¯ä¸€ç§ä¸“é—¨é’ˆå¯¹ç£ç›˜å­˜å‚¨è€Œä¼˜åŒ–çš„Nå‰æ’åºæ ‘ï¼Œä»¥æ ‘èŠ‚ç‚¹ä¸ºå•ä½å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œä»æ ¹å¼€å§‹æŸ¥æ‰¾æ‰€éœ€çš„èŠ‚ç‚¹ç¼–å·å’Œç£ç›˜ä½ç½®ï¼Œå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åç»§ç»­æŸ¥æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°æ‰€éœ€æ•°æ®ï¼Œç›®å‰å¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“å¤šé‡‡ç”¨ä¸¤çº§ç´¢å¼•çš„B+æ ‘ï¼Œæ ‘çš„å±‚æ¬¡æœ€å¤šä¸º3å±‚ã€‚

ç›®å‰å¾ˆå¤šNoSQLäº§å“é‡‡ç”¨LSMæ ‘ä½œä¸ºä¸»è¦çš„æ•°æ®ç»“æ„ï¼ŒLSMæ ‘å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªNé˜¶åˆå¹¶æ ‘ï¼Œæ•°æ®çš„å†™æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå¹¶ä¸”éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°è®°å½•ï¼Œè¿™äº›æ•°æ®åœ¨å†…å­˜ä¸­ä»ç„¶è¿˜æ˜¯ä¸€é¢—æ’åºæ ‘ã€‚åœ¨éœ€è¦è¯»çš„æ—¶å€™ï¼Œæ€»æ˜¯ä»å†…å­˜ä¸­çš„æ’åºæ ‘å¼€å§‹æœç´¢ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä»ç£ç›˜çš„æ’åºæ ‘ä¸­æŸ¥æ‰¾ã€‚

åœ¨LSMæ ‘ä¸Šè¿›è¡Œä¸€æ¬¡æ•°æ®æ›´æ–°ä¸éœ€è¦ç£ç›˜è®¿é—®ï¼Œåœ¨å†…å­˜ä¸­å³å¯å®Œæˆï¼Œé€Ÿåº¦è¿œå¿«äºB+æ ‘ï¼Œå½“æ•°æ®è®¿é—®ä»¥å†™æ“ä½œä¸ºä¸»ï¼Œè€Œè¯»æ“ä½œåˆ™é›†ä¸­åœ¨æœ€è¿‘å†™å…¥çš„æ•°æ®ä¸Šæ—¶ï¼Œä½¿ç”¨LSMæ ‘å¯ä»¥æå¤§ç¨‹åº¦çš„å‡å°‘ç£ç›˜çš„è®¿é—®æ¬¡æ•°ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚

# æ»¤æ³¢å™¨

ä½¿ç”¨ä¸åŒçš„æ»¤æ³¢å™¨çŸ©é˜µå¯ä»¥å®ç°ä¸åŒçš„æ•ˆæœã€‚ä»¥ä¸‹æ˜¯å‡ ç§ä¸åŒçš„æ»¤æ³¢å™¨çŸ©é˜µç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥å°è¯•å®ƒä»¬ä»¥è·å¾—ä¸åŒçš„æ¨¡ç³Šæ•ˆæœï¼š

é«˜æ–¯æ¨¡ç³Šï¼šé«˜æ–¯æ¨¡ç³Šæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¨¡ç³Šæ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ»¤æ³¢å™¨çŸ©é˜µæ¥å®ç°ï¼š
java
Copy code
float[] matrix = {
    1.0f, 2.0f, 1.0f,
    2.0f, 4.0f, 2.0f,
    1.0f, 2.0f, 1.0f
};
è¾¹ç¼˜å¢å¼ºï¼šè¾¹ç¼˜å¢å¼ºæ»¤æ³¢å™¨å¯ä»¥çªå‡ºå›¾åƒä¸­çš„è¾¹ç¼˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ»¤æ³¢å™¨çŸ©é˜µæ¥å®ç°ï¼š
java
Copy code
float[] matrix = {
    -1.0f, -1.0f, -1.0f,
    -1.0f,  9.0f, -1.0f,
    -1.0f, -1.0f, -1.0f
};
æµ®é›•æ•ˆæœï¼šæµ®é›•æ•ˆæœå¯ä»¥ä½¿å›¾åƒçœ‹èµ·æ¥åƒæµ®é›•ä¸€æ ·å‡¸å‡ºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ»¤æ³¢å™¨çŸ©é˜µæ¥å®ç°ï¼š
java
Copy code
float[] matrix = {
    -2.0f, -1.0f,  0.0f,
    -1.0f,  1.0f,  1.0f,
     0.0f,  1.0f,  2.0f
};
å‡å€¼æ¨¡ç³Šï¼šå‡å€¼æ¨¡ç³Šæ˜¯ä¸€ç§ç®€å•çš„æ¨¡ç³Šæ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ»¤æ³¢å™¨çŸ©é˜µæ¥å®ç°ï¼š
java
Copy code
float[] matrix = {
    0.111f, 0.111f, 0.111f,
    0.111f, 0.111f, 0.111f,
    0.111f, 0.111f, 0.111f
};
æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©è¿™äº›æ»¤æ³¢å™¨çŸ©é˜µï¼Œæˆ–è€…å°è¯•å…¶ä»–çŸ©é˜µæ¥è·å¾—ä¸åŒçš„æ•ˆæœã€‚è¦åº”ç”¨ç‰¹å®šçš„æ»¤æ³¢å™¨çŸ©é˜µï¼Œåªéœ€å°†æ‰€é€‰çŸ©é˜µæ›¿æ¢ç¤ºä¾‹ä»£ç ä¸­çš„çŸ©é˜µå³å¯ã€‚ä¸åŒçš„çŸ©é˜µå°†äº§ç”Ÿä¸åŒçš„å›¾åƒå¤„ç†æ•ˆæœã€‚



# æ–°ç‰¹æ€§

## JDK 21

### è™šæ‹Ÿçº¿ç¨‹

ç”¨äº† **try-with-resources**ï¼Œæ–¹æ³•æ•´ä½“**ä¸ä¼šâ€œå¼‚æ­¥ç›´æ¥è¿”å›â€**â€”â€”å®ƒä¼šåœ¨ `try` ç»“æŸæ—¶ **`close()` é˜»å¡ç­‰å¾…ä»»åŠ¡åšå®Œ**ã€‚

```
try (var es = Executors.newVirtualThreadPerTaskExecutor()) {
    es.submit(() -> parseImgMsg(entities, profileId)); // è¿™é‡Œå¾ˆå¿«å°±è¿”å›ï¼ˆæäº¤å®Œæˆï¼‰
} // try ç»“æŸ -> è°ƒç”¨ es.close() -> ä¼šç­‰å¾…å·²æäº¤ä»»åŠ¡å…¨éƒ¨ç»“æŸ
```

Oracle çš„è™šæ‹Ÿçº¿ç¨‹æ–‡æ¡£æ˜ç¡®è¯´äº†ï¼š`try` å—æœ«å°¾éšå¼è°ƒç”¨çš„ `ExecutorService.close()` **ä¼šç­‰å¾…æ‰€æœ‰å·²æäº¤ä»»åŠ¡ç»ˆæ­¢**ã€‚
 `ExecutorService.close()` çš„é»˜è®¤å®ç°ä¹Ÿæ˜¯ **shutdown + awaitTermination ç­‰å¾…å®Œæˆ**ã€‚

æ‰€ä»¥ä½ è¿™æ®µå†™æ³•çš„æ•ˆæœæ›´åƒæ˜¯ï¼š

- ä»»åŠ¡ç¡®å®åœ¨**å¦ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹**é‡Œè·‘
- ä½†å½“å‰çº¿ç¨‹é©¬ä¸Šä¼šåœ¨ `close()` å¤„**ç­‰å®ƒè·‘å®Œå†è¿”å›**
- ç”±äº `try` é‡Œæ²¡æœ‰åˆ«çš„å·¥ä½œå¯å¹¶è¡Œï¼Œæ•´ä½“æ”¶ç›Šæ¥è¿‘ **â€œåŒæ­¥è°ƒç”¨ + é¢å¤–å¼€é”€â€**

------

å¦‚æœä½ æƒ³â€œå¼‚æ­¥ç›´æ¥è¿”å›â€ï¼Œæ€ä¹ˆå†™ï¼Ÿ

1) çœŸÂ·fire-and-forgetï¼ˆä¸ç­‰ç»“æœï¼‰

```
Thread.startVirtualThread(() -> parseImgMsg(entities, profileId));
return;
```

æ³¨æ„ï¼š**è™šæ‹Ÿçº¿ç¨‹æ°¸è¿œæ˜¯ daemon çº¿ç¨‹**ï¼Œä¸ä¼šé˜»æ­¢ JVM é€€å‡ºï¼›å¦‚æœä½ çš„ç¨‹åºå¾ˆå¿«ç»“æŸï¼ˆæ¯”å¦‚ main è·‘å®Œï¼‰ï¼Œä»»åŠ¡å¯èƒ½æ¥ä¸åŠè·‘å®Œã€‚
 ï¼ˆåœ¨æœåŠ¡ç«¯åº”ç”¨ä¸€èˆ¬æ²¡é—®é¢˜ï¼Œå› ä¸º JVM ä¼šä¸€ç›´æ´»ç€ã€‚ï¼‰

2) è¿”å› `Future` ç»™è°ƒç”¨æ–¹å†³å®šç­‰ä¸ç­‰ï¼ˆæ›´å¯æ§ï¼‰

```
var es = Executors.newVirtualThreadPerTaskExecutor();
Future<?> f = es.submit(() -> parseImgMsg(entities, profileId));
return f; // è°ƒç”¨æ–¹éœ€è¦æ—¶ f.get()
```

ä½†è¿™ç§è¦æƒ³èµ„æºä¸æ³„éœ²ï¼Œä½ å¾—åœ¨åˆé€‚æ—¶æœº `close/shutdown`ï¼ˆé€šå¸¸ç”¨â€œå…±äº« executorâ€ï¼Œæˆ–åœ¨åº”ç”¨å…³é—­æ—¶ç»Ÿä¸€å…³ï¼‰ã€‚

------

å’Œâ€œå¤šçº¿ç¨‹ï¼ˆå¹³å°çº¿ç¨‹/çº¿ç¨‹æ± ï¼‰â€çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

**è™šæ‹Ÿçº¿ç¨‹ä¾ç„¶æ˜¯å¤šçº¿ç¨‹**ï¼ŒåŒºåˆ«ä¸»è¦åœ¨â€œæˆæœ¬â€å’Œâ€œé˜»å¡æ¨¡å‹â€ï¼š

- **å¹³å°çº¿ç¨‹ï¼ˆOS çº¿ç¨‹ï¼‰**ï¼šåˆ›å»º/åˆ‡æ¢æˆæœ¬é«˜ï¼Œæ•°é‡ä¸Šä¸å»ï¼›å¤§é‡ I/O é˜»å¡æ—¶å®¹æ˜“æŠŠçº¿ç¨‹æ± å æ»¡ã€‚
- **è™šæ‹Ÿçº¿ç¨‹ï¼ˆJDK 21 èµ·æ­£å¼ï¼‰**ï¼šéå¸¸è½»é‡ï¼Œé€‚åˆâ€œä¸€ä»»åŠ¡ä¸€çº¿ç¨‹â€çš„å†™æ³•ï¼›é‡åˆ°å¯æŒ‚èµ·çš„é˜»å¡ï¼ˆå¦‚å¾ˆå¤š I/Oï¼‰æ—¶ï¼ŒJVM å¯ä»¥æŠŠå®ƒæŒ‚èµ·ï¼Œè®©æ‰¿è½½çš„å°‘é‡å¹³å°çº¿ç¨‹å»è·‘åˆ«çš„ä»»åŠ¡ï¼Œä»è€Œæ”¯æŒæµ·é‡å¹¶å‘ã€‚

ä½†ä¹Ÿè¦è®°ä½ï¼š

- **CPU å¯†é›†å‹**ä»»åŠ¡ï¼ˆå¤§é‡è®¡ç®—ï¼‰ç”¨è™šæ‹Ÿçº¿ç¨‹ä¸ä¼šâ€œå˜å¿«â€ï¼Œç“¶é¢ˆä»æ˜¯ CPU æ ¸æ•°ï¼›è¿™ç±»æ›´çœ‹é‡åˆç†çš„å¹¶è¡Œåº¦/çº¿ç¨‹æ± å¤§å°ã€‚